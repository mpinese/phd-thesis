\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{lscape}
\geometry{verbose,tmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm,rmargin=2.5cm}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}




\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(flexsurv)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: survival\\\#\# Loading required package: splines}}\begin{alltt}
\hlkwd{library}\hlstd{(boot)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# \\\#\# Attaching package: 'boot'\\\#\# \\\#\# The following object is masked from 'package:survival':\\\#\# \\\#\#\ \ \ \  aml}}\begin{alltt}
\hlkwd{library}\hlstd{(randomForestSRC)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: parallel\\\#\# \\\#\#\ \ randomForestSRC 1.5.5 \\\#\#\ \ \\\#\#\ \ Type rfsrc.news() to see new features, changes, and bug fixes. \\\#\# }}\begin{alltt}
\hlkwd{library}\hlstd{(timeROC)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: pec\\\#\# Loading required package: mvtnorm\\\#\# Loading required package: timereg}}\begin{alltt}
\hlkwd{library}\hlstd{(risksetROC)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: MASS}}\begin{alltt}
\hlkwd{library}\hlstd{(ggplot2)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: methods}}\begin{alltt}
\hlkwd{library}\hlstd{(RColorBrewer)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlnum{4}\hlstd{,} \hlstr{"Dark2"}\hlstd{)}
\hlkwd{names}\hlstd{(pal)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"gg"}\hlstd{,} \hlstr{"km0"}\hlstd{,} \hlstr{"mskcc.post"}\hlstd{,} \hlstr{"mskcc.pre"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}


\section{Preparation}
Construct a *preoperative* function based on the Brennan nomogram.  The preoperative nature will mean that most prognostic components will need to be marginalized out.

\begin{table}[h]
\begin{tabular}{llll}
Variable            & Preoperative? & Available? & Marginals                                                                                     \\
Age                 & Yes           & Yes        & Linear.  90 =\textgreater 0, 30 =\textgreater 8.  Therefore $f(x) = -2/15(x-90) = -2/15x + 12$ \\
Sex                 & Yes           & Yes        & Male risk delta 3                                                                             \\
Portal Vein         & NO            &            & 14.4\% YES, risk delta 10, marginal 1.4                                                       \\
Splenectomy         & NO            &            & 9.9\% YES, risk delta 62, marginal 6.1                                                        \\
Margin of resection & NO            &            & 20.7\% POS, risk delta 4, marginal 0.8                                                        \\
Head.vs.Other       & Yes           & Yes        & Head risk delta 51                                                                            \\
Differentiation     & NO            &            & 14.2\% Well, risk delta 0, marginal 0                                                         \\
                    &               &            & 56.4\% Mod, risk delta 14, marginal 7.9                                                       \\
                    &               &            & 29.5\% Poor, risk delta 35, marginal 10.3.  Overall marginal 18.2                             \\
Posterior.margin    & NO            &            & 86.0\% POS, risk delta 22, marginal 18.9                                                      \\
Numb.pos.nodes      & NO            &            & Mean 2.1, approx marginal 15                                                                  \\
Numb.neg.nodes      & NO            &            & Mean 16.9, approx marginal 9                                                                  \\
Back.pain           & Yes           & NO         & 13.7\% YES, risk delta 15, marginal 2.0                                                       \\
T.stage             & Yes           & Yes        &                                                                                               \\
Weight Loss         & Yes           & NO         & 53.7\% YES, risk delta 3,  marginal 1.6                                                       \\
Max.path.axis       & Yes           & Yes        &                                                                                              
\end{tabular}
\end{table}

So the preoperative MSKCC score would be:
\begin{align}
S &= 1.4 + 6.1 + 0.8 + 18.2 + 18.9 + 15 + 9 + 15*Back.pain + 3*Weight.Loss + -2/15*Age + 12 + 3\left[Sex = M\right] + 51\left[Head.vs.Other = Head\right] + T.stage + Max.path.axis
  &= 81.4 + 15*Back.pain + 3*Weight.Loss + -2/15*Age + 3*\left[Sex = M\right] + 51\left[Head.vs.Other = Head\right] + fT(T.stage) + fS(Max.path.axis)
fT(T.stage) = 36\left[T.stage = T1\right] + 10\left[T.stage = T3\right] + 63\left[T.stage = T4\right]
\end{align}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{fit.mskcc} \hlkwb{=} \hlkwd{list}\hlstd{(}
        \hlkwc{inputs} \hlstd{=} \hlkwd{list}\hlstd{(}
        \hlkwc{History.Diagnosis.AgeAt} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlnum{65}\hlstd{,} \hlkwc{fraction} \hlstd{=} \hlnum{1}\hlstd{),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{ x} \hlkwb{=} \hlstd{x;} \hlopt{-}\hlnum{2}\hlopt{/}\hlnum{15}\hlopt{*}\hlkwd{pmin}\hlstd{(}\hlkwd{pmax}\hlstd{(x,} \hlnum{0}\hlstd{),} \hlnum{90}\hlstd{)} \hlopt{+} \hlnum{12} \hlstd{\}),}
        \hlkwc{Patient.Sex} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"M"}\hlstd{,} \hlstr{"F"}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.501}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.501}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{3}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlstr{"M"}\hlstd{) \}),}
        \hlkwc{Portal.Vein} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{FALSE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.144}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.144}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{10}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Splenectomy} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{FALSE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.099}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.099}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{62}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Treat.MarginPositive} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{FALSE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.207}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.207}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{4}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Path.LocationBody} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{FALSE}\hlstd{,} \hlnum{TRUE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.894}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.894}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{51}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Path.Differentiation} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"1"}\hlstd{,} \hlstr{"2"}\hlstd{,} \hlstr{"3"}\hlstd{,} \hlstr{"4"}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.142}\hlstd{,} \hlnum{0.564}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.142}\hlopt{-}\hlnum{0.564}\hlstd{,} \hlnum{0}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{14}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlstr{"2"}\hlstd{)} \hlopt{+} \hlnum{35}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlstr{"3"}\hlstd{)} \hlopt{+} \hlnum{35}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlstr{"4"}\hlstd{) \}),}          \hlcom{# Undifferentiated (4) not covered by the MSKCC nomogram; here assign the same score as poorly differentiated (3)}
        \hlkwc{Posterior.Margin} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{FALSE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.86}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.86}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{22}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Path.LN.Involved} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlnum{2.1}\hlstd{,} \hlkwc{fraction} \hlstd{=} \hlnum{1}\hlstd{),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{}
                        \hlstd{x} \hlkwb{=} \hlkwd{pmin}\hlstd{(}\hlnum{40}\hlstd{,} \hlkwd{pmax}\hlstd{(x,} \hlnum{0}\hlstd{))}
                        \hlstd{fitfun} \hlkwb{=} \hlkwd{splinefun}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{10}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{20}\hlstd{,} \hlnum{25}\hlstd{,} \hlnum{30}\hlstd{,} \hlnum{35}\hlstd{,} \hlnum{40}\hlstd{),} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{14.56}\hlstd{,} \hlnum{24.64}\hlstd{,} \hlnum{30.28}\hlstd{,} \hlnum{33.00}\hlstd{,} \hlnum{39.05}\hlstd{,} \hlnum{43.89}\hlstd{,} \hlnum{48.83}\hlstd{,} \hlnum{53.77}\hlstd{,} \hlnum{58.61}\hlstd{,} \hlnum{63.55}\hlstd{,} \hlnum{68.49}\hlstd{),} \hlkwc{method} \hlstd{=} \hlstr{"natural"}\hlstd{)}
                        \hlkwd{fitfun}\hlstd{(x)}
                \hlstd{\}),}
        \hlkwc{Path.LN.Negative} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlnum{16.9}\hlstd{,} \hlkwc{fraction} \hlstd{=} \hlnum{1}\hlstd{),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{ (}\hlkwd{pmin}\hlstd{(}\hlkwd{pmax}\hlstd{(x,} \hlnum{0}\hlstd{),} \hlnum{90}\hlstd{)}\hlopt{-}\hlnum{90}\hlstd{)}\hlopt{*-}\hlnum{11}\hlopt{/}\hlnum{90} \hlstd{\}),}
        \hlkwc{Back.pain} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{FALSE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.137}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.137}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{15}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Stage.pT.Simplified} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"T1"}\hlstd{,} \hlstr{"T2"}\hlstd{,} \hlstr{"T34"}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.037}\hlstd{,} \hlnum{0.119}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.037}\hlopt{-}\hlnum{0.119}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{36}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlstr{"T1"}\hlstd{)} \hlopt{+} \hlnum{11}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlstr{"T34"}\hlstd{) \}),}
                \hlcom{# The following matches the original Brennan nomogram, but was not used as there are too few T4}
                \hlcom{# tumours in either the NSWPCN *or* the MSKCC cohorts -- how the T4 coefficient was ever estimated,}
                \hlcom{# I'll never know.  The T34 coefficient of 11 was arrived at as (0.828*10+(1-0.037-0.119-0.828)*63)/(1-0.037-0.119),}
                \hlcom{# being a frequency-weighted average of the T3 and T4 coefficients.}
                \hlcom{# margins = data.frame(value = c("T1", "T2", "T3", "T4"), fraction = c(0.037, 0.119, 0.828, 1-0.037-0.119-0.828)),}
                \hlcom{# scorefunc = function(x) \{ 36*I(x == "T1") + 10*I(x == "T3") + 63*I(x == "T4") \}),}
        \hlkwc{Weight.loss} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{FALSE}\hlstd{),} \hlkwc{fraction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.537}\hlstd{,} \hlnum{1}\hlopt{-}\hlnum{0.537}\hlstd{)),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{} \hlnum{3}\hlopt{*}\hlkwd{I}\hlstd{(x} \hlopt{==} \hlnum{TRUE}\hlstd{) \}),}
        \hlkwc{Path.Size} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{margins} \hlstd{=} \hlkwd{data.frame}\hlstd{(),}
                \hlkwc{scorefunc} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) \{}
                        \hlstd{x} \hlkwb{=} \hlkwd{pmin}\hlstd{(}\hlnum{16}\hlstd{,} \hlkwd{pmax}\hlstd{(x,} \hlnum{0}\hlstd{))}
                        \hlstd{fitfun} \hlkwb{=} \hlkwd{splinefun}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{6}\hlstd{,} \hlnum{8}\hlstd{,} \hlnum{10}\hlstd{,} \hlnum{12}\hlstd{,} \hlnum{14}\hlstd{,} \hlnum{16}\hlstd{),} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{29.74}\hlstd{,} \hlnum{59.48}\hlstd{,} \hlnum{86.70}\hlstd{,} \hlnum{100}\hlstd{,} \hlnum{97.29}\hlstd{,} \hlnum{90.03}\hlstd{,} \hlnum{82.77}\hlstd{,} \hlnum{75.51}\hlstd{,} \hlnum{68.25}\hlstd{,} \hlnum{61.10}\hlstd{),} \hlkwc{method} \hlstd{=} \hlstr{"natural"}\hlstd{)}
                        \hlkwd{fitfun}\hlstd{(x)}
                \hlstd{\}) ),}
        \hlkwc{outputs} \hlstd{=} \hlkwd{list}\hlstd{(}
                \hlkwc{DSS12mo} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{s}\hlstd{) \{}
                        \hlstd{x} \hlkwb{=} \hlkwd{pmax}\hlstd{(}\hlnum{50}\hlstd{,} \hlkwd{pmin}\hlstd{(}\hlnum{350}\hlstd{, s))}
                        \hlstd{fitfun} \hlkwb{=} \hlkwd{splinefun}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{79.0323}\hlstd{,} \hlnum{115.02}\hlstd{,} \hlnum{165.524}\hlstd{,} \hlnum{197.278}\hlstd{,} \hlnum{221.774}\hlstd{,} \hlnum{242.339}\hlstd{,} \hlnum{261.089}\hlstd{,} \hlnum{279.839}\hlstd{,} \hlnum{299.194}\hlstd{,} \hlnum{323.992}\hlstd{,} \hlnum{337.298}\hlstd{),} \hlkwd{c}\hlstd{(}\hlnum{0.94}\hlstd{,} \hlnum{0.9}\hlstd{,} \hlnum{0.8}\hlstd{,} \hlnum{0.7}\hlstd{,} \hlnum{0.6}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.4}\hlstd{,} \hlnum{0.3}\hlstd{,} \hlnum{0.2}\hlstd{,} \hlnum{0.1}\hlstd{,} \hlnum{0.06}\hlstd{))}
                        \hlstd{y} \hlkwb{=} \hlkwd{fitfun}\hlstd{(x)}
                        \hlkwd{pmax}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{pmin}\hlstd{(}\hlnum{1}\hlstd{, y))}
                \hlstd{\},}
                \hlkwc{DSS24mo} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{s}\hlstd{) \{}
                        \hlstd{x} \hlkwb{=} \hlkwd{pmax}\hlstd{(}\hlnum{50}\hlstd{,} \hlkwd{pmin}\hlstd{(}\hlnum{350}\hlstd{, s))}
                        \hlstd{fitfun} \hlkwb{=} \hlkwd{splinefun}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{71.1694}\hlstd{,} \hlnum{97.7823}\hlstd{,} \hlnum{129.536}\hlstd{,} \hlnum{153.73}\hlstd{,} \hlnum{174.294}\hlstd{,} \hlnum{193.347}\hlstd{,} \hlnum{211.794}\hlstd{,} \hlnum{231.452}\hlstd{,} \hlnum{255.645}\hlstd{,} \hlnum{303.125}\hlstd{),} \hlkwd{c}\hlstd{(}\hlnum{0.86}\hlstd{,} \hlnum{0.8}\hlstd{,} \hlnum{0.7}\hlstd{,} \hlnum{0.6}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.4}\hlstd{,} \hlnum{0.3}\hlstd{,} \hlnum{0.2}\hlstd{,} \hlnum{0.1}\hlstd{,} \hlnum{0.01}\hlstd{))}
                        \hlstd{y} \hlkwb{=} \hlkwd{fitfun}\hlstd{(x)}
                        \hlkwd{pmax}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{pmin}\hlstd{(}\hlnum{1}\hlstd{, y))}
                \hlstd{\},}
                \hlkwc{DSS36mo} \hlstd{=} \hlkwa{function}\hlstd{(}\hlkwc{s}\hlstd{) \{}
                        \hlstd{x} \hlkwb{=} \hlkwd{pmax}\hlstd{(}\hlnum{50}\hlstd{,} \hlkwd{pmin}\hlstd{(}\hlnum{350}\hlstd{, s))}
                        \hlstd{fitfun} \hlkwb{=} \hlkwd{splinefun}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{69.3548}\hlstd{,} \hlnum{101.109}\hlstd{,} \hlnum{125.302}\hlstd{,} \hlnum{145.867}\hlstd{,} \hlnum{164.919}\hlstd{,} \hlnum{183.367}\hlstd{,} \hlnum{202.722}\hlstd{,} \hlnum{226.915}\hlstd{,} \hlnum{274.093}\hlstd{),} \hlkwd{c}\hlstd{(}\hlnum{0.8}\hlstd{,} \hlnum{0.7}\hlstd{,} \hlnum{0.6}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.4}\hlstd{,} \hlnum{0.3}\hlstd{,} \hlnum{0.2}\hlstd{,} \hlnum{0.1}\hlstd{,} \hlnum{0.01}\hlstd{))}
                        \hlstd{y} \hlkwb{=} \hlkwd{fitfun}\hlstd{(x)}
                        \hlkwd{pmax}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{pmin}\hlstd{(}\hlnum{1}\hlstd{, y))}
                \hlstd{\})}
        \hlstd{)}

\hlstd{applyNomogram} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{nomogram}\hlstd{,} \hlkwc{data}\hlstd{)}
\hlstd{\{}
        \hlstd{scores} \hlkwb{=} \hlkwd{rowSums}\hlstd{(}\hlkwd{sapply}\hlstd{(}\hlkwd{names}\hlstd{(nomogram}\hlopt{$}\hlstd{inputs),} \hlkwa{function}\hlstd{(}\hlkwc{input}\hlstd{) \{}
                \hlkwa{if} \hlstd{(input} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data)) \{}
                        \hlkwd{return}\hlstd{(nomogram}\hlopt{$}\hlstd{inputs[[input]]}\hlopt{$}\hlkwd{scorefunc}\hlstd{(data[,input]))}
                \hlstd{\}}
                \hlkwd{warning}\hlstd{(}\hlkwd{sprintf}\hlstd{(}\hlstr{"Marginalizing missing variable: %s"}\hlstd{, input))}
                \hlstd{margin_score} \hlkwb{=} \hlkwd{sum}\hlstd{(nomogram}\hlopt{$}\hlstd{inputs[[input]]}\hlopt{$}\hlkwd{scorefunc}\hlstd{(nomogram}\hlopt{$}\hlstd{inputs[[input]]}\hlopt{$}\hlstd{margins}\hlopt{$}\hlstd{value)} \hlopt{*} \hlstd{nomogram}\hlopt{$}\hlstd{inputs[[input]]}\hlopt{$}\hlstd{margins}\hlopt{$}\hlstd{fraction)}
                \hlkwd{return}\hlstd{(}\hlkwd{rep}\hlstd{(margin_score,} \hlkwd{nrow}\hlstd{(data)))}
        \hlstd{\}))}

        \hlstd{outputs} \hlkwb{=} \hlkwd{sapply}\hlstd{(nomogram}\hlopt{$}\hlstd{outputs,} \hlkwa{function}\hlstd{(}\hlkwc{f}\hlstd{)} \hlkwd{f}\hlstd{(scores))}
        \hlkwd{cbind}\hlstd{(}\hlkwc{Score} \hlstd{= scores, outputs)}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}


\section{Model and data loading}
Trained models:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp} \hlkwb{=} \hlkwd{readRDS}\hlstd{(}\hlstr{"05_final_model.rds"}\hlstd{)}
\hlstd{fit.gg} \hlkwb{=} \hlstd{temp}\hlopt{$}\hlstd{gg}
\hlstd{fit.km0} \hlkwb{=} \hlstd{temp}\hlopt{$}\hlstd{km0}
\hlstd{data.nswpcn} \hlkwb{=} \hlstd{temp}\hlopt{$}\hlstd{data.train}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{data.glasgow} \hlkwb{=} \hlkwd{readRDS}\hlstd{(}\hlstr{"06_Glasgow.rds"}\hlstd{)}
\hlstd{data.glasgow} \hlkwb{=} \hlstd{data.glasgow[data.glasgow}\hlopt{$}\hlstd{Path.Type} \hlopt{%in%} \hlkwd{c}\hlstd{(}\hlstr{"Pancreatic Adenocarcinoma"}\hlstd{,} \hlstr{"Pancreatic adenocarcinoma"}\hlstd{,} \hlstr{"Pancreatic Adenocarcinom"}\hlstd{),]}
\hlstd{data.glasgow}\hlopt{$}\hlstd{Path.LN.Negative} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Path.LN.Inspected} \hlopt{-} \hlstd{data.glasgow}\hlopt{$}\hlstd{Path.LN.Involved}
\hlstd{data.glasgow}\hlopt{$}\hlstd{History.Diagnosis.AgeAt} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{History.Diagnosis.AgeAt.Cent} \hlopt{+} \hlnum{68}
\hlstd{data.glasgow}\hlopt{$}\hlstd{Path.Size} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Path.Size.Cent} \hlopt{+} \hlnum{30}
\hlstd{data.glasgow}\hlopt{$}\hlstd{SexM} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Patient.Sex} \hlopt{==} \hlstr{"M"}
\hlstd{data.glasgow}\hlopt{$}\hlstd{AgeCent} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{History.Diagnosis.AgeAt.Cent}
\hlstd{data.glasgow}\hlopt{$}\hlstd{SizeCent} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Path.Size.Cent}
\hlstd{data.glasgow}\hlopt{$}\hlstd{A2} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Molec.S100A2.DCThresh}
\hlstd{data.glasgow}\hlopt{$}\hlstd{A4} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Molec.S100A4.DCThresh}
\hlstd{data.glasgow}\hlopt{$}\hlstd{LocBody} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{Path.Location} \hlopt{!=} \hlstr{"HOP"}
\hlstd{data.glasgow}\hlopt{$}\hlstd{Time} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{History.Death.EventTimeDays}
\hlstd{data.glasgow}\hlopt{$}\hlstd{DSD} \hlkwb{=} \hlstd{data.glasgow}\hlopt{$}\hlstd{History.DSDeath.Event}
\end{alltt}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{data.apgi} \hlkwb{=} \hlkwd{readRDS}\hlstd{(}\hlstr{"06_APGI.rds"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{data.dresden} \hlkwb{=} \hlkwd{readRDS}\hlstd{(}\hlstr{"06_Dresden.rds"}\hlstd{)}

\hlstd{data.dresden}\hlopt{$}\hlstd{History.Diagnosis.AgeAt} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{History.Surgery.AgeAtYears}
\hlstd{data.dresden}\hlopt{$}\hlstd{History.Diagnosis.AgeAt.Cent} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{History.Diagnosis.AgeAt} \hlopt{-} \hlnum{68}
\hlstd{data.dresden}\hlopt{$}\hlstd{Path.Size} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Path.TumourSizeMm}
\hlstd{data.dresden}\hlopt{$}\hlstd{Path.Size.Cent} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Path.Size} \hlopt{-} \hlnum{30}
\hlstd{data.dresden}\hlopt{$}\hlstd{Stage.pT.Simplified} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"T1"} \hlstd{=} \hlstr{"T1"}\hlstd{,} \hlstr{"T2"} \hlstd{=} \hlstr{"T2"}\hlstd{,} \hlstr{"T3"} \hlstd{=} \hlstr{"T34"}\hlstd{,} \hlstr{"T4"} \hlstd{=} \hlstr{"T34"}\hlstd{)[data.dresden}\hlopt{$}\hlstd{Staging.pT]}
\hlstd{data.dresden}\hlopt{$}\hlstd{Patient.Sex} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Patient.Gender}
\hlstd{data.dresden}\hlopt{$}\hlstd{SexM} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Patient.Sex} \hlopt{==} \hlstr{"M"}
\hlstd{data.dresden}\hlopt{$}\hlstd{AgeCent} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{History.Diagnosis.AgeAt.Cent}
\hlstd{data.dresden}\hlopt{$}\hlstd{SizeCent} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Path.Size.Cent}
\hlstd{data.dresden}\hlopt{$}\hlstd{A2} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Molec.S100A2.DCThresh}
\hlstd{data.dresden}\hlopt{$}\hlstd{A4} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Molec.S100A4.DCThresh}
\hlstd{data.dresden}\hlopt{$}\hlstd{Path.LocationBody} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Path.TumourLocation} \hlopt{!=} \hlstr{"Head"}
\hlstd{data.dresden}\hlopt{$}\hlstd{LocBody} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Path.LocationBody}
\hlstd{data.dresden}\hlopt{$}\hlstd{Time} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{History.Death.EventTimeDays}
\hlstd{data.dresden}\hlopt{$}\hlstd{DSD} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{History.DSDeath.Event}
\hlstd{data.dresden}\hlopt{$}\hlstd{Treat.MarginPositive} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Treat.Surgery.ExcisionStatus} \hlopt{!=} \hlstr{"R0"}
\hlstd{data.dresden}\hlopt{$}\hlstd{Path.Differentiation} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Path.Grade}

\hlstd{temp.sel} \hlkwb{=} \hlstd{data.dresden}\hlopt{$}\hlstd{Staging.pM} \hlopt{!=} \hlstr{"M1"} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{Staging.pM)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{A2)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{A4)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{DSD)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{SexM)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{LocBody)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{Treat.MarginPositive)} \hlopt{& !}\hlkwd{is.na}\hlstd{(data.dresden}\hlopt{$}\hlstd{Path.Differentiation)}
\hlstd{data.dresden} \hlkwb{=} \hlstd{data.dresden[temp.sel,]}
\end{alltt}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{summary}\hlstd{(data.nswpcn)}
\end{alltt}
\begin{verbatim}
##    Patient.ID   Patient.Sex Cohort.ICGC     History.PreviousMalignancy
##  Min.   :   4   F:120       Mode :logical   Mode :logical             
##  1st Qu.: 305   M:120       FALSE:240       FALSE:219                 
##  Median : 621               NA's :0         TRUE :21                  
##  Mean   : 618                               NA's :0                   
##  3rd Qu.:1030                                                         
##  Max.   :1453                                                         
##                                                                       
##  History.FdrWithPancCancer History.FdrWithAnyCancer History.Diagnosis.Date
##  Mode :logical             Mode :logical            Min.   :1994-03-09    
##  FALSE:230                 FALSE:202                1st Qu.:1998-06-26    
##  TRUE :8                   TRUE :38                 Median :2001-05-24    
##  NA's :2                   NA's :0                  Mean   :2000-12-19    
##                                                     3rd Qu.:2003-06-16    
##                                                     Max.   :2006-08-14    
##                                                                           
##  History.Diagnosis.AgeAt History.AlcoholLevel History.Smoking.Status
##  Min.   :28.0            0:151                Never  :140           
##  1st Qu.:62.0            1: 45                Ceased : 48           
##  Median :69.0            2: 22                Current: 52           
##  Mean   :67.5            3: 22                                      
##  3rd Qu.:75.0                                                       
##  Max.   :87.0                                                       
##                                                                     
##  History.Smoking.PackYears History.Comorbid.Diabetes
##  Min.   : 2.0              Mode :logical            
##  1st Qu.:20.0              FALSE:181                
##  Median :25.0              TRUE :59                 
##  Mean   :31.9              NA's :0                  
##  3rd Qu.:50.0                                       
##  Max.   :80.0                                       
##  NA's   :185                                        
##  History.Comorbid.ChronicPancreatitis History.Recurrence.Event
##  Mode :logical                        Min.   :0.000           
##  FALSE:229                            1st Qu.:1.000           
##  TRUE :11                             Median :1.000           
##  NA's :0                              Mean   :0.971           
##                                       3rd Qu.:1.000           
##                                       Max.   :1.000           
##                                                               
##  History.Recurrence.Date History.DSDeath.Event History.Death.Date  
##  Min.   :1994-07-21      Min.   :0.000         Min.   :1995-01-12  
##  1st Qu.:1999-09-16      1st Qu.:1.000         1st Qu.:1999-11-30  
##  Median :2002-06-03      Median :1.000         Median :2002-11-21  
##  Mean   :2002-03-05      Mean   :0.963         Mean   :2002-08-01  
##  3rd Qu.:2005-01-08      3rd Qu.:1.000         3rd Qu.:2005-04-21  
##  Max.   :2009-01-29      Max.   :1.000         Max.   :2011-10-03  
##  NA's   :79                                                        
##  History.Followup.Date History.Death.EventTimeDays Treat.Resected
##  Min.   :2009-10-24    Min.   :  26                Mode:logical  
##  1st Qu.:2009-10-24    1st Qu.: 274                TRUE:240      
##  Median :2009-10-24    Median : 476                NA's:0        
##  Mean   :2010-01-06    Mean   : 592                              
##  3rd Qu.:2010-02-12    3rd Qu.: 771                              
##  Max.   :2010-06-03    Max.   :2701                              
##  NA's   :237                                                     
##  Treat.ProcedureWhipple Treat.MarginPositive Treat.Chemo.Any
##  Mode :logical          Mode :logical        Mode :logical  
##  FALSE:44               FALSE:137            FALSE:97       
##  TRUE :196              TRUE :103            TRUE :117      
##  NA's :0                NA's :0              NA's :26       
##                                                             
##                                                             
##                                                             
##  Treat.Chemo.Adjuvant Treat.Chemo.Adjuvant.GE3Cycles
##  Mode :logical        Mode :logical                 
##  FALSE:169            FALSE:197                     
##  TRUE :71             TRUE :43                      
##  NA's :0              NA's :0                       
##                                                     
##                                                     
##                                                     
##  Treat.Chemo.Palliative Treat.Chemo.PalliativeDC Treat.Chemo.GEM
##  Mode :logical          Mode :logical            Mode :logical  
##  FALSE:1                FALSE:170                FALSE:151      
##  TRUE :65               TRUE :70                 TRUE :88       
##  NA's :174              NA's :0                  NA's :1        
##                                                                 
##                                                                 
##                                                                 
##  Treat.Radio     Path.LocationBody   Path.Size    Path.Bilirubin.Preop
##  Mode :logical   Mode :logical     Min.   : 8.0   Min.   : 0.06       
##  FALSE:197       FALSE:196         1st Qu.:25.0   1st Qu.: 0.69       
##  TRUE :43        TRUE :44          Median :30.0   Median : 3.63       
##  NA's :0         NA's :0           Mean   :33.6   Mean   : 7.31       
##                                    3rd Qu.:40.0   3rd Qu.:10.72       
##                                    Max.   :90.0   Max.   :45.03       
##                                                   NA's   :96          
##  Path.Ca199.Preop Path.Bilirubin.Postop Path.Ca199.Postop
##  Min.   :     1   Min.   : 0.12         Min.   :    1    
##  1st Qu.:    73   1st Qu.: 0.47         1st Qu.:   17    
##  Median :   218   Median : 0.70         Median :   77    
##  Mean   :  2803   Mean   : 1.95         Mean   : 1571    
##  3rd Qu.:   842   3rd Qu.: 1.30         3rd Qu.:  278    
##  Max.   :101075   Max.   :25.38         Max.   :31760    
##  NA's   :162      NA's   :100           NA's   :137      
##         Path.Subtype Path.Differentiation Path.LN.Involved
##  Adenosquamous: 18   1: 16                Min.   : 0.00   
##  Large Cell   :  0   2:157                1st Qu.: 0.00   
##  Mucinous     :  5   3: 67                Median : 1.00   
##  NotSpecified : 38   4:  0                Mean   : 1.76   
##  Papillary    :  2                        3rd Qu.: 2.00   
##  Tubular      :177                        Max.   :12.00   
##                                           NA's   :3       
##  Path.LN.Inspected Path.Invasion.Vascular Path.Invasion.Perineural
##  Min.   : 0.00     Mode :logical          Mode :logical           
##  1st Qu.: 5.00     FALSE:128              FALSE:58                
##  Median : 8.00     TRUE :112              TRUE :182               
##  Mean   : 9.68     NA's :0                NA's :0                 
##  3rd Qu.:13.00                                                    
##  Max.   :52.00                                                    
##  NA's   :20                                                       
##  Stage.pT  Stage.pN   Stage.pM   Molec.BNIP3.NucInt Molec.BNIP3.CytoInt
##  Tis:  0   N0  : 80   M0  :177   0   :  6           0   :  1           
##  T1 : 18   N1  :156   M1  :  8   1   :200           1   :125           
##  T2 : 32   NA's:  4   NA's: 55   2   : 21           2   : 74           
##  T3 :190                         3   :  2           3   : 29           
##  T4 :  0                         NA's: 11           NA's: 11           
##                                                                        
##                                                                        
##  Molec.CCND1.CytoLo Molec.CCND1.CytoHi Molec.CCND1.MembLo
##  0   :152           0   :71            0   :96           
##  1   : 34           1   :87            1   :68           
##  2   :  4           2   :32            2   :18           
##  3   :  1           3   : 1            3   : 9           
##  NA's: 49           NA's:49            NA's:49           
##                                                          
##                                                          
##  Molec.CCND1.MembHi Molec.Grb7.Int Molec.Grb7.Percent Molec.HCNT3PlusHENT1
##  0   :29            0   :49        Min.   :  0.0      Mode :logical       
##  1   :86            1   :90        1st Qu.:  3.0      FALSE:93            
##  2   :45            2   :42        Median : 18.0      TRUE :94            
##  3   :31            3   : 7        Mean   : 31.6      NA's :53            
##  NA's:49            NA's:52        3rd Qu.: 58.5                          
##                                    Max.   :100.0                          
##                                    NA's   :52                             
##  Molec.HENT1.Percent Molec.HENT1.Int Molec.HER2      Molec.HOXB2.Percent
##  Min.   :  0.0       0   : 17        Mode :logical   Min.   :  0.0      
##  1st Qu.: 11.2       1   :114        FALSE:36        1st Qu.: 35.0      
##  Median : 42.5       2   : 51        TRUE :10        Median : 70.0      
##  Mean   : 44.4       3   : 12        NA's :194       Mean   : 59.6      
##  3rd Qu.: 75.0       NA's: 46                        3rd Qu.: 85.0      
##  Max.   :100.0                                       Max.   :100.0      
##  NA's   :46                                          NA's   :42         
##  Molec.HOXB2.Int Molec.RON.Int Molec.S100A2.Int Molec.S100A2.Percent
##  0   : 14        0   : 19      0:87             Min.   :  0.0       
##  1   :137        1   :110      1:59             1st Qu.:  0.0       
##  2   : 33        2   : 59      2:56             Median : 10.0       
##  3   : 14        3   : 10      3:38             Mean   : 28.1       
##  NA's: 42        NA's: 42                       3rd Qu.: 60.0       
##                                                 Max.   :100.0       
##                                                                     
##  Molec.S100A2.StromaScore Molec.S100A4.CytoInt Molec.S100A4.CytoPercent
##  Mode :logical            0:70                 Min.   :  0.0           
##  FALSE:175                1:89                 1st Qu.:  0.0           
##  TRUE :22                 2:40                 Median : 10.0           
##  NA's :43                 3:41                 Mean   : 34.8           
##                                                3rd Qu.: 75.0           
##                                                Max.   :100.0           
##                                                                        
##  Molec.S100A4.NucInt Molec.S100A4.NucPercent Stage.Overall
##  0:78                Min.   :  0.0           IIB    :117  
##  1:66                1st Qu.:  0.0           IIA    : 41  
##  2:62                Median :  5.0           IB     : 12  
##  3:34                Mean   : 26.4           IV     :  8  
##                      3rd Qu.: 60.0           IA     :  7  
##                      Max.   :100.0           (Other):  0  
##                                              NA's   : 55  
##  History.Death.Event Molec.S100A4.DCThresh Molec.S100A2.DCThresh
##  Min.   :0.000       Mode :logical         Mode :logical        
##  1st Qu.:1.000       FALSE:60              FALSE:203            
##  Median :1.000       TRUE :180             TRUE :37             
##  Mean   :0.996       NA's :0               NA's :0              
##  3rd Qu.:1.000                                                  
##  Max.   :1.000                                                  
##                                                                 
##  Stage.pT.Simplified Path.Ca199.Preop.Cent Path.Ca199.Postop.Cent
##  T1 : 18             Min.   :-5.38         Min.   :-3.97         
##  T2 : 32             1st Qu.:-1.09         1st Qu.:-1.14         
##  T34:190             Median : 0.00         Median : 0.37         
##                      Mean   : 0.09         Mean   : 0.62         
##                      3rd Qu.: 1.36         3rd Qu.: 1.66         
##                      Max.   : 6.14         Max.   : 6.40         
##                      NA's   :162           NA's   :137           
##  History.Diagnosis.AgeAt.Cent History.Smoking.PackYears.Cent
##  Min.   :-40.00               Min.   :-28.00                
##  1st Qu.: -6.00               1st Qu.:-10.00                
##  Median :  1.00               Median : -5.00                
##  Mean   : -0.51               Mean   :  1.89                
##  3rd Qu.:  7.00               3rd Qu.: 20.00                
##  Max.   : 19.00               Max.   : 50.00                
##                               NA's   :185                   
##  Path.Size.Cent   Path.Bilirubin.Preop.Cent Path.Bilirubin.Postop.Cent
##  Min.   :-22.00   Min.   :-3.39             Min.   :-0.53             
##  1st Qu.: -5.00   1st Qu.:-2.76             1st Qu.:-0.18             
##  Median :  0.00   Median : 0.18             Median : 0.06             
##  Mean   :  3.56   Mean   : 3.86             Mean   : 1.30             
##  3rd Qu.: 10.00   3rd Qu.: 7.27             3rd Qu.: 0.66             
##  Max.   : 60.00   Max.   :41.58             Max.   :24.74             
##                   NA's   :96                NA's   :100               
##  History.Diagnosis.Date.Cent Path.LN.InvolvedFraction Path.LN.Negative
##  Min.   :-2867               Min.   :0.000            Min.   : 0.00   
##  1st Qu.:-1297               1st Qu.:0.000            1st Qu.: 4.00   
##  Median : -234               Median :0.143            Median : 7.00   
##  Mean   : -389               Mean   :0.217            Mean   : 7.85   
##  3rd Qu.:  519               3rd Qu.:0.333            3rd Qu.:11.00   
##  Max.   : 1674               Max.   :1.000            Max.   :45.00   
##                              NA's   :21               NA's   :20      
##     SexM           Ca199          DiagYearCent         Time     
##  Mode :logical   Mode :logical   Min.   :-7.849   Min.   :  26  
##  FALSE:120       FALSE:26        1st Qu.:-3.551   1st Qu.: 274  
##  TRUE :120       TRUE :52        Median :-0.639   Median : 474  
##  NA's :0         NA's :162       Mean   :-1.065   Mean   : 589  
##                                  3rd Qu.: 1.422   3rd Qu.: 764  
##                                  Max.   : 4.583   Max.   :2701  
##                                                                 
##     DSD             AgeCent        LocBody           SizeCent     
##  Mode :logical   Min.   :-40.00   Mode :logical   Min.   :-22.00  
##  FALSE:9         1st Qu.: -6.00   FALSE:196       1st Qu.: -5.00  
##  TRUE :231       Median :  1.00   TRUE :44        Median :  0.00  
##  NA's :0         Mean   : -0.51   NA's :0         Mean   :  3.56  
##                  3rd Qu.:  7.00                   3rd Qu.: 10.00  
##                  Max.   : 19.00                   Max.   : 60.00  
##                                                                   
##      A2              A4             SizePlus    
##  Mode :logical   Mode :logical   Min.   : 0.00  
##  FALSE:203       FALSE:60        1st Qu.: 0.00  
##  TRUE :37        TRUE :180       Median : 0.00  
##  NA's :0         NA's :0         Mean   : 7.35  
##                                  3rd Qu.:10.00  
##                                  Max.   :60.00  
## 
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(data.glasgow)}
\end{alltt}
\begin{verbatim}
##   Patient.ID        Patient.Sex History.Diagnosis.AgeAt Treat.Procedure   
##  Length:189         F: 89       Min.   :37.5            Length:189        
##  Class :character   M:100       1st Qu.:57.8            Class :character  
##  Mode  :character               Median :64.0            Mode  :character  
##                                 Mean   :62.6                              
##                                 3rd Qu.:69.4                              
##                                 Max.   :86.0                              
##                                                                           
##  Path.Location     
##  Length:189        
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
##                    
##                                                          Path.Type  
##  Pancreatic Adenocarcinoma                                    :156  
##  Pancreatic adenocarcinoma                                    : 32  
##  Pancreatic Adenocarcinom                                     :  1  
##  Pancreatic adenocarcinoma arising form IPMN                  :  0  
##  Pancreatic adenocarcinoma arising from mucnous cystic neoplsm:  0  
##  Pancreatic Adenocarcinoma arising IPMN                       :  0  
##  (Other)                                                      :  0  
##  Path.Differentiation Path.Grade Stage.pT  Stage.pN
##  1: 12                Low :128   Tis:  0   N0: 33  
##  2:117                High: 61   T1 :  1   N1:156  
##  3: 60                           T2 : 13           
##  4:  0                           T3 :171           
##                                  T4 :  4           
##                                                    
##                                                    
##  Path.Invasion.Perineural Path.Invasion.Vascular Path.LN.Inspected
##  Mode :logical            Mode :logical          Min.   : 1.0     
##  FALSE:13                 FALSE:96               1st Qu.:13.0     
##  TRUE :176                TRUE :93               Median :20.0     
##  NA's :0                  NA's :0                Mean   :20.2     
##                                                  3rd Qu.:27.0     
##                                                  Max.   :53.0     
##                                                                   
##  Path.LN.InvolvedFraction Treat.MarginPositive Treat.VeinResection
##  Min.   :0.00             Mode :logical        Mode :logical      
##  1st Qu.:0.05             FALSE:51             FALSE:158          
##  Median :0.14             TRUE :138            TRUE :31           
##  Mean   :0.20             NA's :0              NA's :0            
##  3rd Qu.:0.27                                                     
##  Max.   :1.00                                                     
##                                                                   
##    Path.Size    History.Death.EventTimeDays History.Death.Cause
##  Min.   : 5.0   Min.   :   8                0:  9              
##  1st Qu.:25.0   1st Qu.: 233                1:161              
##  Median :30.0   Median : 501                2: 19              
##  Mean   :32.7   Mean   : 673                                   
##  3rd Qu.:40.0   3rd Qu.: 915                                   
##  Max.   :65.0   Max.   :3531                                   
##                                                                
##  Treat.Chemo.Adjuvant Treat.Chemo.Neoadjuvant Molec.S100A2.DCThresh
##  Mode :logical        Mode :logical           Mode :logical        
##  FALSE:110            FALSE:188               FALSE:127            
##  TRUE :79             TRUE :1                 TRUE :62             
##  NA's :0              NA's :0                 NA's :0              
##                                                                    
##                                                                    
##                                                                    
##  Molec.S100A4.DCThresh Treat.ProcedureWhipple Path.LocationBody
##  Mode :logical         Mode:logical           Mode :logical    
##  FALSE:55              TRUE:189               FALSE:189        
##  TRUE :134             NA's:0                 NA's :0          
##  NA's :0                                                       
##                                                                
##                                                                
##                                                                
##  History.DSDeath.Event History.ACDeath.Event Path.LN.Involved
##  Mode :logical         Mode :logical         Min.   : 0.00   
##  FALSE:28              FALSE:9               1st Qu.: 1.00   
##  TRUE :161             TRUE :180             Median : 2.00   
##  NA's :0               NA's :0               Mean   : 3.57   
##                                              3rd Qu.: 5.00   
##                                              Max.   :32.00   
##                                                              
##  History.Diagnosis.AgeAt.Cent Path.Size.Cent   Stage.pT.Simplified
##  Min.   :-30.55               Min.   :-25.00   T1 :  1            
##  1st Qu.:-10.19               1st Qu.: -5.00   T2 : 13            
##  Median : -4.00               Median :  0.00   T34:175            
##  Mean   : -5.37               Mean   :  2.72                      
##  3rd Qu.:  1.43               3rd Qu.: 10.00                      
##  Max.   : 18.00               Max.   : 35.00                      
##                                                                   
##  Path.LN.Negative    SexM            AgeCent          SizeCent     
##  Min.   : 0.0     Mode :logical   Min.   :-30.55   Min.   :-25.00  
##  1st Qu.:10.0     FALSE:89        1st Qu.:-10.19   1st Qu.: -5.00  
##  Median :16.0     TRUE :100       Median : -4.00   Median :  0.00  
##  Mean   :16.6     NA's :0         Mean   : -5.37   Mean   :  2.72  
##  3rd Qu.:23.0                     3rd Qu.:  1.43   3rd Qu.: 10.00  
##  Max.   :47.0                     Max.   : 18.00   Max.   : 35.00  
##                                                                    
##      A2              A4           LocBody             Time     
##  Mode :logical   Mode :logical   Mode :logical   Min.   :   8  
##  FALSE:127       FALSE:55        FALSE:189       1st Qu.: 233  
##  TRUE :62        TRUE :134       NA's :0         Median : 501  
##  NA's :0         NA's :0                         Mean   : 673  
##                                                  3rd Qu.: 915  
##                                                  Max.   :3531  
##                                                                
##     DSD         
##  Mode :logical  
##  FALSE:28       
##  TRUE :161      
##  NA's :0        
##                 
##                 
## 
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(data.apgi)}
\end{alltt}
\begin{verbatim}
##   Patient.ID        Patient.Gender                      Patient.Ethnicity
##  Length:75          Female:34      Asian                         : 7     
##  Class :character   Male  :41      Asian, White/Caucasian        : 0     
##  Mode  :character                  Black/African                 : 1     
##                                    Black/African, White/Caucasian: 0     
##                                    White/Caucasian               :67     
##                                                                          
##                                                                          
##                  Patient.Country History.LastFollowup.Date
##  Australia               :75     Min.   :2008-04-14       
##  Italy                   : 0     1st Qu.:2011-02-03       
##  New Zealand             : 0     Median :2012-05-09       
##  Puerto Rico             : 0     Mean   :2012-06-02       
##  United Kingdom          : 0     3rd Qu.:2013-11-06       
##  United States of America: 0     Max.   :2014-09-08       
##                                                           
##  History.Smoking.PackYears History.Diagnosis.Date
##  Min.   :  0.75            Min.   :2004-12-30    
##  1st Qu.: 12.00            1st Qu.:2009-11-28    
##  Median : 27.50            Median :2010-05-28    
##  Mean   : 30.98            Mean   :2010-06-08    
##  3rd Qu.: 44.06            3rd Qu.:2010-11-29    
##  Max.   :123.75            Max.   :2012-02-17    
##  NA's   :43                                      
##  History.Diagnosis.AgeAtYears History.Surgery.Date
##  Min.   :47.0                 Min.   :2004-12-30  
##  1st Qu.:60.5                 1st Qu.:2009-12-05  
##  Median :67.0                 Median :2010-06-01  
##  Mean   :66.8                 Mean   :2010-06-16  
##  3rd Qu.:74.0                 3rd Qu.:2011-01-19  
##  Max.   :84.0                 Max.   :2012-02-17  
##                                                   
##                                                                 Treat.Surgery.Procedure
##  Classic Whipple                                                            :55        
##  Classic Whipple, Exploratory laparotomy                                    : 3        
##  PPPD                                                                       : 3        
##  Splenectomy, Subtotal Panc/L sided Panc or distal Panc                     : 3        
##  Subtotal Panc/L sided Panc or distal Panc                                  : 3        
##  Cholecystectomy, Cholecystojejunostomy/Hepaticojejunostomy, Classic Whipple: 1        
##  (Other)                                                                    : 7        
##  Treat.Surgery.ExcisionStatus Treat.Surgery.Margin.Pancreatic
##  R0:51                        <2 mm   : 2                    
##  R1:20                        Clear   :65                    
##  R2: 4                        Involved: 2                    
##                               NA's    : 6                    
##                                                              
##                                                              
##                                                              
##  Treat.Surgery.MarginSizeMm.Pancreatic Treat.Surgery.Margin.Periunc
##  Min.   : 0.00                         <2 mm   :16                 
##  1st Qu.: 5.00                         Clear   :36                 
##  Median :10.00                         Involved:11                 
##  Mean   : 9.94                         NA's    :12                 
##  3rd Qu.:10.00                                                     
##  Max.   :40.00                                                     
##  NA's   :15                                                        
##  Treat.Surgery.MarginSizeMm.Periunc Treat.Surgery.Margin.PVGroove
##  Min.   : 0.00                      <2 mm   :18                  
##  1st Qu.: 1.00                      Clear   :37                  
##  Median : 2.20                      Involved:10                  
##  Mean   : 6.92                      NA's    :10                  
##  3rd Qu.:10.00                                                   
##  Max.   :40.00                                                   
##  NA's   :24                                                      
##  Treat.Surgery.MarginSizeMm.PVGroove Treat.Surgery.Margin.Retrop
##  Min.   : 0.0                        <2 mm   :19                
##  1st Qu.: 1.0                        Clear   :46                
##  Median : 2.0                        Involved: 5                
##  Mean   : 3.8                        NA's    : 5                
##  3rd Qu.: 4.0                                                   
##  Max.   :25.0                                                   
##  NA's   :24                                                     
##  Treat.Surgery.MarginSizeMm.Retrop Treat.Surgery.Margin.CBD
##  Min.   : 0.10                     <2 mm   : 0             
##  1st Qu.: 1.00                     Clear   :58             
##  Median : 3.00                     Involved: 0             
##  Mean   : 5.29                     NA's    :17             
##  3rd Qu.: 8.00                                             
##  Max.   :25.00                                             
##  NA's   :14                                                
##  Treat.Surgery.MarginSizeMm.CBD Treat.Surgery.Margin.Duodenal
##  Min.   : 3.0                   Clear   :40                  
##  1st Qu.:11.5                   Involved: 0                  
##  Median :20.0                   NA's    :35                  
##  Mean   :21.9                                                
##  3rd Qu.:30.0                                                
##  Max.   :50.0                                                
##  NA's   :31                                                  
##  Treat.Surgery.MarginSizeMm.Duodenal Treat.Surgery.Margin.Gastric
##  Min.   : 20.0                       Clear:39                    
##  1st Qu.: 47.5                       NA's :36                    
##  Median : 75.0                                                   
##  Mean   : 75.0                                                   
##  3rd Qu.:102.5                                                   
##  Max.   :130.0                                                   
##  NA's   :73                                                      
##  Treat.Surgery.MarginSizeMm.Gastric Treat.Surgery.Margin.Comments
##  Min.   : 20                        Length:75                    
##  1st Qu.: 40                        Class :character             
##  Median : 60                        Mode  :character             
##  Mean   : 60                                                     
##  3rd Qu.: 80                                                     
##  Max.   :100                                                     
##  NA's   :73                                                      
##                           Path.HistoType
##  Pancreatic Ductal Adenocarcinoma:75    
##  Acinar Cell Carcinoma           : 0    
##  Ampullary Adenocarcinoma        : 0    
##  Carcinoid Tumour                : 0    
##  Cholangiocarcinoma              : 0    
##  Clear Cell Carcinoma            : 0    
##  (Other)                         : 0    
##                    Path.HistoType.Subtype Path.Grade
##  Gastric                      : 0         1: 3      
##  Intestinal                   : 0         2:47      
##  Mixed                        : 0         3:23      
##  Not otherwise Specified (NOS):10         4: 2      
##  Pancreatobiliary             :10                   
##  Squamous                     : 0                   
##  NA's                         :55                   
##       Path.TumourLocation Path.TumourSizeMm Path.Invasion.PN
##  Head           :55       Min.   :15.0      Absent : 9      
##  Head (Uncinate): 9       1st Qu.:28.0      Present:66      
##  Body           : 7       Median :35.0                      
##  Tail           : 3       Mean   :36.9                      
##  Ampulla        : 1       3rd Qu.:43.0                      
##                 : 0       Max.   :90.0                      
##  (Other)        : 0                                         
##  Path.Invasion.VS Path.Nodes.Regional.Total Path.Nodes.Regional.Involved
##  Absent :22       Min.   : 2.0              Min.   : 0.00               
##  Present:51       1st Qu.:13.0              1st Qu.: 1.00               
##  NA's   : 2       Median :16.0              Median : 3.00               
##                   Mean   :18.6              Mean   : 3.03               
##                   3rd Qu.:23.5              3rd Qu.: 4.00               
##                   Max.   :46.0              Max.   :13.00               
##                                                                         
##  Path.Nodes.SepRec.Total Path.Nodes.SepRec.Involved
##  Min.   : 2.0            Min.   : 0.00             
##  1st Qu.:13.0            1st Qu.: 1.00             
##  Median :16.0            Median : 3.00             
##  Mean   :18.6            Mean   : 3.03             
##  3rd Qu.:23.5            3rd Qu.: 4.00             
##  Max.   :46.0            Max.   :13.00             
##                                                    
##                                    Staging.Version Staging.pM Staging.pN
##  pTNM AJCC 6th Ed 2002                     :12     M0  : 2    N0:16     
##  pTNM AJCC 7th Ed 2010                     :63     M1  : 4    N1:59     
##  pTNM AJCC 7th Ed 2010 (Ampulla)           : 0     NA's:69              
##  pTNM AJCC 7th Ed 2010 (Cholangiocarcinoma): 0                          
##  pTNM AJCC 7th Ed 2010 (Neuroendocrine)    : 0                          
##                                                                         
##                                                                         
##  Staging.pT Staging.Stage    History.Recurrence History.Recurrence.Date
##  Tis: 0     IA : 1        Not observed:15       Min.   :2007-12-31     
##  T1 : 1     IB : 1        Suspected   : 2       1st Qu.:2010-10-25     
##  T2 : 3     IIA:13        Confirmed   :56       Median :2011-04-11     
##  T3 :70     IIB:55        NA's        : 2       Mean   :2011-06-29     
##  T4 : 1     III: 1                              3rd Qu.:2012-02-28     
##             IV : 4                              Max.   :2014-08-27     
##                                                 NA's   :17             
##  History.Recurrence.Site.Stomach History.Recurrence.Site.Peritoneum
##  Mode :logical                   Mode :logical                     
##  FALSE:75                        FALSE:67                          
##  NA's :0                         TRUE :8                           
##                                  NA's :0                           
##                                                                    
##                                                                    
##                                                                    
##  History.Recurrence.Site.PancRemnant History.Recurrence.Site.PancBed
##  Mode :logical                       Mode :logical                  
##  FALSE:70                            FALSE:64                       
##  TRUE :5                             TRUE :11                       
##  NA's :0                             NA's :0                        
##                                                                     
##                                                                     
##                                                                     
##  History.Recurrence.Site.Other History.Recurrence.Site.Omentum
##  Mode :logical                 Mode :logical                  
##  FALSE:69                      FALSE:74                       
##  TRUE :6                       TRUE :1                        
##  NA's :0                       NA's :0                        
##                                                               
##                                                               
##                                                               
##  History.Recurrence.Site.Mesentery History.Recurrence.Site.LymphNodes
##  Mode :logical                     Mode :logical                     
##  FALSE:74                          FALSE:61                          
##  TRUE :1                           TRUE :14                          
##  NA's :0                           NA's :0                           
##                                                                      
##                                                                      
##                                                                      
##  History.Recurrence.Site.Lung History.Recurrence.Site.Liver
##  Mode :logical                Mode :logical                
##  FALSE:60                     FALSE:51                     
##  TRUE :15                     TRUE :24                     
##  NA's :0                      NA's :0                      
##                                                            
##                                                            
##                                                            
##  History.Recurrence.Site.Brain History.Recurrence.Site.Bone
##  Mode :logical                 Mode :logical               
##  FALSE:73                      FALSE:71                    
##  TRUE :2                       TRUE :4                     
##  NA's :0                       NA's :0                     
##                                                            
##                                                            
##                                                            
##                      History.Status History.Death.Date  
##  Alive - With Disease       : 7     Min.   :2008-05-13  
##  Alive - Without Disease    :13     1st Qu.:2010-12-20  
##  Deceased - Of Disease      :51     Median :2011-12-28  
##  Deceased - Of Other Cause  : 4     Mean   :2011-11-08  
##  Deceased - Of Unknown Cause: 0     3rd Qu.:2012-09-08  
##                                     Max.   :2014-01-26  
##                                     NA's   :20          
##                        History.Death.Cause Surv.Event.Death
##  Cancer Death (Pancreatic)       :51       Min.   :0.000   
##  Died of Treatment Complication  : 2       1st Qu.:0.000   
##  Cancer Death (Other) - Lung ca  : 1       Median :1.000   
##  Other (please specify) - Suicide: 1       Mean   :0.733   
##  Other (please specify)          : 0       3rd Qu.:1.000   
##  (Other)                         : 0       Max.   :1.000   
##  NA's                            :20                       
##  Surv.EventTimeFromDiag.Death Surv.EventTimeFromSurg.Death
##  Min.   :  56                 Min.   :  62                
##  1st Qu.: 386                 1st Qu.: 362                
##  Median : 653                 Median : 655                
##  Mean   : 753                 Mean   : 745                
##  3rd Qu.:1007                 3rd Qu.:1010                
##  Max.   :2848                 Max.   :2848                
##                                                           
##  Surv.EventTimeFromRec.Death Surv.Event.DSDeath
##  Min.   :   3.0              Min.   :0.00      
##  1st Qu.:  65.8              1st Qu.:0.00      
##  Median : 202.0              Median :1.00      
##  Mean   : 287.4              Mean   :0.68      
##  3rd Qu.: 371.2              3rd Qu.:1.00      
##  Max.   :1333.0              Max.   :1.00      
##  NA's   :17                                    
##  Surv.EventTimeFromDiag.DSDeath Surv.EventTimeFromSurg.DSDeath
##  Min.   :  31                   Min.   :  37                  
##  1st Qu.: 386                   1st Qu.: 362                  
##  Median : 653                   Median : 655                  
##  Mean   : 752                   Mean   : 743                  
##  3rd Qu.:1007                   3rd Qu.:1010                  
##  Max.   :2848                   Max.   :2848                  
##                                                               
##  Surv.EventTimeFromRec.DSDeath Surv.Event.Recurrence
##  Min.   :   3.0                Min.   :0.000        
##  1st Qu.:  65.8                1st Qu.:1.000        
##  Median : 202.0                Median :1.000        
##  Mean   : 287.1                Mean   :0.767        
##  3rd Qu.: 371.2                3rd Qu.:1.000        
##  Max.   :1333.0                Max.   :1.000        
##  NA's   :17                    NA's   :2            
##  Surv.EventTimeFromDiag.Recurrence Surv.EventTimeFromSurg.Recurrence
##  Min.   :  31                      Min.   : -15                     
##  1st Qu.: 241                      1st Qu.: 231                     
##  Median : 388                      Median : 377                     
##  Mean   : 540                      Mean   : 532                     
##  3rd Qu.: 698                      3rd Qu.: 705                     
##  Max.   :1954                      Max.   :1954                     
##  NA's   :2                         NA's   :2                        
##      A2              A4          Path.LN.Inspected Path.LN.Involved
##  Mode :logical   Mode :logical   Min.   : 2.0      Min.   : 0.00   
##  FALSE:64        FALSE:26        1st Qu.:13.0      1st Qu.: 1.00   
##  TRUE :11        TRUE :49        Median :16.0      Median : 3.00   
##  NA's :0         NA's :0         Mean   :18.6      Mean   : 3.03   
##                                  3rd Qu.:23.5      3rd Qu.: 4.00   
##                                  Max.   :46.0      Max.   :13.00   
##                                                                    
##  Path.LN.Negative History.Diagnosis.AgeAt History.Diagnosis.AgeAt.Cent
##  Min.   : 2.0     Min.   :47.0            Min.   :-21.00              
##  1st Qu.: 9.0     1st Qu.:60.5            1st Qu.: -7.50              
##  Median :13.0     Median :67.0            Median : -1.00              
##  Mean   :15.6     Mean   :66.8            Mean   : -1.15              
##  3rd Qu.:21.0     3rd Qu.:74.0            3rd Qu.:  6.00              
##  Max.   :44.0     Max.   :84.0            Max.   : 16.00              
##                                                                       
##    Path.Size    Path.Size.Cent   Patient.Sex    SexM        
##  Min.   :15.0   Min.   :-15.00   Female:34   Mode :logical  
##  1st Qu.:28.0   1st Qu.: -2.00   Male  :41   FALSE:34       
##  Median :35.0   Median :  5.00               TRUE :41       
##  Mean   :36.9   Mean   :  6.89               NA's :0        
##  3rd Qu.:43.0   3rd Qu.: 13.00                              
##  Max.   :90.0   Max.   : 60.00                              
##                                                             
##  Treat.MarginPositive    AgeCent          SizeCent      Stage.pT
##  Mode :logical        Min.   :-21.00   Min.   :-15.00   Tis: 0  
##  FALSE:51             1st Qu.: -7.50   1st Qu.: -2.00   T1 : 1  
##  TRUE :24             Median : -1.00   Median :  5.00   T2 : 3  
##  NA's :0              Mean   : -1.15   Mean   :  6.89   T3 :70  
##                       3rd Qu.:  6.00   3rd Qu.: 13.00   T4 : 1  
##                       Max.   : 16.00   Max.   : 60.00           
##                                                                 
##  Stage.pT.Simplified Path.LocationBody Path.Differentiation
##  Length:75           Mode :logical     1: 3                
##  Class :character    FALSE:64          2:47                
##  Mode  :character    TRUE :11          3:23                
##                      NA's :0           4: 2                
##                                                            
##                                                            
##                                                            
##   LocBody             Time           DSD      
##  Mode :logical   Min.   :  37   Min.   :0.00  
##  FALSE:64        1st Qu.: 362   1st Qu.:0.00  
##  TRUE :11        Median : 655   Median :1.00  
##  NA's :0         Mean   : 743   Mean   :0.68  
##                  3rd Qu.:1010   3rd Qu.:1.00  
##                  Max.   :2848   Max.   :1.00  
## 
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(data.dresden)}
\end{alltt}
\begin{verbatim}
##      Dresden.SSID Patient.Gender History.Surgery.AgeAtYears
##  3_105_PaCa:  1   F:68           Min.   :40.0              
##  3_112_PaCa:  1   M:82           1st Qu.:59.0              
##  3_11_PaCa :  1                  Median :68.0              
##  3_131_PaCa:  1                  Mean   :65.6              
##  3_13_PaCa :  1                  3rd Qu.:73.0              
##  3_196_PaCa:  1                  Max.   :84.0              
##  (Other)   :144                                            
##  History.Death.EventTimeDays History.Death.Event History.DSDeath.Event
##  Min.   :  10                Mode :logical       Mode :logical        
##  1st Qu.: 311                FALSE:22            FALSE:38             
##  Median : 514                TRUE :128           TRUE :112            
##  Mean   : 715                NA's :0             NA's :0              
##  3rd Qu.: 915                                                         
##  Max.   :4190                                                         
##                                                                       
##  History.Death.Cause Treat.Surgery.ExcisionStatus Path.Grade Staging.pT
##  other: 16           R0:98                        1: 3       T2:  9    
##  PaCa :112           R1:42                        2:75       T3:141    
##  NA's : 22           R2:10                        3:71                 
##                                                   4: 1                 
##                                                                        
##                                                                        
##                                                                        
##  Staging.pN Staging.pM Path.Invasion.VS Path.Invasion.PN
##  N0: 47     M0:150     Mode :logical    Mode :logical   
##  N1:101     M1:  0     FALSE:64         FALSE:53        
##  N2:  2                TRUE :36         TRUE :95        
##                        NA's :50         NA's :2         
##                                                         
##                                                         
##                                                         
##  Path.TumourLocation Path.TumourSizeMm Molec.S100A2.DCThresh
##  Head:139            Min.   :15.0      Mode :logical        
##  Tail: 11            1st Qu.:25.0      FALSE:112            
##                      Median :34.5      TRUE :38             
##                      Mean   :34.2      NA's :0              
##                      3rd Qu.:40.0                           
##                      Max.   :85.0                           
##                                                             
##  Molec.S100A4.DCThresh History.Diagnosis.AgeAt
##  Mode :logical         Min.   :40.0           
##  FALSE:18              1st Qu.:59.0           
##  TRUE :132             Median :68.0           
##  NA's :0               Mean   :65.6           
##                        3rd Qu.:73.0           
##                        Max.   :84.0           
##                                               
##  History.Diagnosis.AgeAt.Cent   Path.Size    Path.Size.Cent  
##  Min.   :-28.00               Min.   :15.0   Min.   :-15.00  
##  1st Qu.: -9.00               1st Qu.:25.0   1st Qu.: -5.00  
##  Median :  0.00               Median :34.5   Median :  4.50  
##  Mean   : -2.39               Mean   :34.2   Mean   :  4.17  
##  3rd Qu.:  5.00               3rd Qu.:40.0   3rd Qu.: 10.00  
##  Max.   : 16.00               Max.   :85.0   Max.   : 55.00  
##                                                              
##  Stage.pT.Simplified Patient.Sex    SexM            AgeCent      
##  Length:150          F:68        Mode :logical   Min.   :-28.00  
##  Class :character    M:82        FALSE:68        1st Qu.: -9.00  
##  Mode  :character                TRUE :82        Median :  0.00  
##                                  NA's :0         Mean   : -2.39  
##                                                  3rd Qu.:  5.00  
##                                                  Max.   : 16.00  
##                                                                  
##     SizeCent          A2              A4          Path.LocationBody
##  Min.   :-15.00   Mode :logical   Mode :logical   Mode :logical    
##  1st Qu.: -5.00   FALSE:112       FALSE:18        FALSE:139        
##  Median :  4.50   TRUE :38        TRUE :132       TRUE :11         
##  Mean   :  4.17   NA's :0         NA's :0         NA's :0          
##  3rd Qu.: 10.00                                                    
##  Max.   : 55.00                                                    
##                                                                    
##   LocBody             Time         DSD          Treat.MarginPositive
##  Mode :logical   Min.   :  10   Mode :logical   Mode :logical       
##  FALSE:139       1st Qu.: 311   FALSE:38        FALSE:98            
##  TRUE :11        Median : 514   TRUE :112       TRUE :52            
##  NA's :0         Mean   : 715   NA's :0         NA's :0             
##                  3rd Qu.: 915                                       
##                  Max.   :4190                                       
##                                                                     
##  Path.Differentiation
##  1: 3                
##  2:75                
##  3:71                
##  4: 1                
##                      
##                      
## 
\end{verbatim}
\begin{alltt}
\hlstd{temp} \hlkwb{=} \hlkwd{table}\hlstd{(}\hlkwc{value} \hlstd{=} \hlkwd{c}\hlstd{(data.nswpcn}\hlopt{$}\hlstd{A2, data.glasgow}\hlopt{$}\hlstd{A2, data.apgi}\hlopt{$}\hlstd{A2, data.dresden}\hlopt{$}\hlstd{A2, data.nswpcn}\hlopt{$}\hlstd{A4, data.glasgow}\hlopt{$}\hlstd{A4, data.apgi}\hlopt{$}\hlstd{A4, data.dresden}\hlopt{$}\hlstd{A4),} \hlkwc{marker} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{"A2"}\hlstd{,} \hlstr{"A4"}\hlstd{),} \hlkwc{each} \hlstd{=} \hlkwd{nrow}\hlstd{(data.nswpcn)} \hlopt{+} \hlkwd{nrow}\hlstd{(data.glasgow)} \hlopt{+} \hlkwd{nrow}\hlstd{(data.apgi)} \hlopt{+} \hlkwd{nrow}\hlstd{(data.dresden)),} \hlkwc{cohort} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{"NSWPCN"}\hlstd{,} \hlstr{"Glasgow"}\hlstd{,} \hlstr{"APGI"}\hlstd{,} \hlstr{"Dresden"}\hlstd{),} \hlkwd{c}\hlstd{(}\hlkwd{nrow}\hlstd{(data.nswpcn),} \hlkwd{nrow}\hlstd{(data.glasgow),} \hlkwd{nrow}\hlstd{(data.apgi),} \hlkwd{nrow}\hlstd{(data.dresden))),} \hlnum{2}\hlstd{))}
\hlstd{temp}
\end{alltt}
\begin{verbatim}
## , , cohort = APGI
## 
##        marker
## value    A2  A4
##   FALSE  64  26
##   TRUE   11  49
## 
## , , cohort = Dresden
## 
##        marker
## value    A2  A4
##   FALSE 112  18
##   TRUE   38 132
## 
## , , cohort = Glasgow
## 
##        marker
## value    A2  A4
##   FALSE 127  55
##   TRUE   62 134
## 
## , , cohort = NSWPCN
## 
##        marker
## value    A2  A4
##   FALSE 203  60
##   TRUE   37 180
\end{verbatim}
\begin{alltt}
\hlkwd{plot}\hlstd{(temp)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-data-summaries-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{plot}\hlstd{(}\hlkwd{as.table}\hlstd{(temp[,}\hlnum{1}\hlstd{,]))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-data-summaries-2} 

}


\begin{kframe}\begin{alltt}
\hlkwd{plot}\hlstd{(}\hlkwd{as.table}\hlstd{(temp[,}\hlnum{2}\hlstd{,]))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-data-summaries-3} 

}



\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp.time} \hlkwb{=} \hlkwd{c}\hlstd{(data.nswpcn}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{Time)} \hlopt{/} \hlnum{365.25}
\hlstd{temp.dsd} \hlkwb{=} \hlkwd{c}\hlstd{(data.nswpcn}\hlopt{$}\hlstd{DSD, data.glasgow}\hlopt{$}\hlstd{DSD, data.apgi}\hlopt{$}\hlstd{DSD, data.dresden}\hlopt{$}\hlstd{DSD)}
\hlstd{temp.cohort} \hlkwb{=} \hlkwd{factor}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{"NSWPCN"}\hlstd{,} \hlstr{"Glasgow"}\hlstd{,} \hlstr{"APGI"}\hlstd{,} \hlstr{"Dresden"}\hlstd{),} \hlkwd{c}\hlstd{(}\hlkwd{nrow}\hlstd{(data.nswpcn),} \hlkwd{nrow}\hlstd{(data.glasgow),} \hlkwd{nrow}\hlstd{(data.apgi),} \hlkwd{nrow}\hlstd{(data.dresden))))}
\hlstd{temp.survfit} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(temp.time, temp.dsd)} \hlopt{~} \hlstd{temp.cohort)}
\hlkwd{plot}\hlstd{(temp.survfit,} \hlkwc{col} \hlstd{= pal[}\hlnum{1}\hlopt{:}\hlnum{4}\hlstd{],} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{main} \hlstd{=} \hlstr{""}\hlstd{,} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (years)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"APGI"}\hlstd{,} \hlstr{"Dresden"}\hlstd{,} \hlstr{"Glasgow"}\hlstd{,} \hlstr{"NSWPCN"}\hlstd{),} \hlkwc{col} \hlstd{= pal[}\hlnum{1}\hlopt{:}\hlnum{4}\hlstd{],} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-cohort-surv-comparison-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{survdiff}\hlstd{(}\hlkwd{Surv}\hlstd{(temp.time, temp.dsd)} \hlopt{~} \hlstd{temp.cohort)}
\end{alltt}
\begin{verbatim}
## Call:
## survdiff(formula = Surv(temp.time, temp.dsd) ~ temp.cohort)
## 
##                       N Observed Expected (O-E)^2/E (O-E)^2/V
## temp.cohort=APGI     75       51     74.7     7.495    8.7035
## temp.cohort=Dresden 150      112    137.3     4.661    6.2829
## temp.cohort=Glasgow 189      161    163.2     0.031    0.0443
## temp.cohort=NSWPCN  240      231    179.8    14.581   21.8988
## 
##  Chisq= 27.1  on 3 degrees of freedom, p= 5.68e-06
\end{verbatim}
\begin{alltt}
\hlstd{temp.vars} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"Time"}\hlstd{,} \hlstr{"DSD"}\hlstd{,} \hlstr{"SexM"}\hlstd{,} \hlstr{"AgeCent"}\hlstd{,} \hlstr{"SizeCent"}\hlstd{,} \hlstr{"Stage.pT.Simplified"}\hlstd{,} \hlstr{"LocBody"}\hlstd{,} \hlstr{"Treat.MarginPositive"}\hlstd{,} \hlstr{"Path.Differentiation"}\hlstd{,} \hlstr{"A2"}\hlstd{,} \hlstr{"A4"}\hlstd{)}
\hlstd{temp.all} \hlkwb{=} \hlkwd{as.data.frame}\hlstd{(}\hlkwd{rbind}\hlstd{(}
        \hlkwd{cbind}\hlstd{(data.nswpcn[,temp.vars],} \hlkwc{cohort} \hlstd{=} \hlstr{"NSWPCN"}\hlstd{),}
        \hlkwd{cbind}\hlstd{(data.glasgow[,temp.vars],} \hlkwc{cohort} \hlstd{=} \hlstr{"Glasgow"}\hlstd{),}
        \hlkwd{cbind}\hlstd{(data.apgi[,temp.vars],} \hlkwc{cohort} \hlstd{=} \hlstr{"APGI"}\hlstd{),}
        \hlkwd{cbind}\hlstd{(data.dresden[,temp.vars],} \hlkwc{cohort} \hlstd{=} \hlstr{"Dresden"}\hlstd{)))}
\hlkwd{table}\hlstd{(temp.all}\hlopt{$}\hlstd{SexM, temp.all}\hlopt{$}\hlstd{cohort)}
\end{alltt}
\begin{verbatim}
##        
##         NSWPCN Glasgow APGI Dresden
##   FALSE    120      89   34      68
##   TRUE     120     100   41      82
\end{verbatim}
\begin{alltt}
\hlstd{temp.allfit} \hlkwb{=} \hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{LocBody} \hlopt{+} \hlstd{cohort}\hlopt{*}\hlstd{(SexM} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{Treat.MarginPositive} \hlopt{+} \hlkwd{I}\hlstd{(Path.Differentiation} \hlopt{%in%} \hlkwd{c}\hlstd{(}\hlstr{"3"}\hlstd{,} \hlstr{"4"}\hlstd{))} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4),} \hlkwc{data} \hlstd{= temp.all)}
\hlstd{temp.allfit2} \hlkwb{=} \hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{LocBody} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{Treat.MarginPositive} \hlopt{+} \hlkwd{I}\hlstd{(Path.Differentiation} \hlopt{%in%} \hlkwd{c}\hlstd{(}\hlstr{"3"}\hlstd{,} \hlstr{"4"}\hlstd{))} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4,} \hlkwc{data} \hlstd{= temp.all)}
\hlkwd{summary}\hlstd{(temp.allfit)}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ LocBody + cohort * (SexM + 
##     AgeCent + SizeCent + Treat.MarginPositive + I(Path.Differentiation %in% 
##     c("3", "4")) + A2 + A4), data = temp.all)
## 
##   n= 654, number of events= 555 
## 
##                                                                 coef
## LocBodyTRUE                                                 2.83e-01
## cohortGlasgow                                              -8.22e-01
## cohortAPGI                                                 -1.08e+00
## cohortDresden                                              -6.85e-01
## SexMTRUE                                                   -9.81e-02
## AgeCent                                                    -3.10e-03
## SizeCent                                                    8.51e-03
## Treat.MarginPositiveTRUE                                    4.91e-01
## I(Path.Differentiation %in% c("3", "4"))TRUE                1.35e-01
## A2TRUE                                                      6.88e-01
## A4TRUE                                                      5.70e-01
## cohortGlasgow:SexMTRUE                                      2.53e-01
## cohortAPGI:SexMTRUE                                         5.60e-01
## cohortDresden:SexMTRUE                                      3.91e-01
## cohortGlasgow:AgeCent                                      -2.27e-02
## cohortAPGI:AgeCent                                          2.78e-02
## cohortDresden:AgeCent                                       1.83e-02
## cohortGlasgow:SizeCent                                      2.44e-02
## cohortAPGI:SizeCent                                         8.54e-05
## cohortDresden:SizeCent                                     -4.15e-04
## cohortGlasgow:Treat.MarginPositiveTRUE                      1.61e-01
## cohortAPGI:Treat.MarginPositiveTRUE                         8.27e-01
## cohortDresden:Treat.MarginPositiveTRUE                      7.85e-02
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE  1.74e-01
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE     2.71e-01
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE  3.62e-01
## cohortGlasgow:A2TRUE                                        5.56e-02
## cohortAPGI:A2TRUE                                          -1.99e-01
## cohortDresden:A2TRUE                                       -4.45e-01
## cohortGlasgow:A4TRUE                                       -2.69e-01
## cohortAPGI:A4TRUE                                          -2.65e-01
## cohortDresden:A4TRUE                                       -3.09e-01
##                                                            exp(coef)
## LocBodyTRUE                                                 1.33e+00
## cohortGlasgow                                               4.40e-01
## cohortAPGI                                                  3.41e-01
## cohortDresden                                               5.04e-01
## SexMTRUE                                                    9.07e-01
## AgeCent                                                     9.97e-01
## SizeCent                                                    1.01e+00
## Treat.MarginPositiveTRUE                                    1.63e+00
## I(Path.Differentiation %in% c("3", "4"))TRUE                1.14e+00
## A2TRUE                                                      1.99e+00
## A4TRUE                                                      1.77e+00
## cohortGlasgow:SexMTRUE                                      1.29e+00
## cohortAPGI:SexMTRUE                                         1.75e+00
## cohortDresden:SexMTRUE                                      1.48e+00
## cohortGlasgow:AgeCent                                       9.78e-01
## cohortAPGI:AgeCent                                          1.03e+00
## cohortDresden:AgeCent                                       1.02e+00
## cohortGlasgow:SizeCent                                      1.02e+00
## cohortAPGI:SizeCent                                         1.00e+00
## cohortDresden:SizeCent                                      1.00e+00
## cohortGlasgow:Treat.MarginPositiveTRUE                      1.17e+00
## cohortAPGI:Treat.MarginPositiveTRUE                         2.29e+00
## cohortDresden:Treat.MarginPositiveTRUE                      1.08e+00
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE  1.19e+00
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE     1.31e+00
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE  1.44e+00
## cohortGlasgow:A2TRUE                                        1.06e+00
## cohortAPGI:A2TRUE                                           8.19e-01
## cohortDresden:A2TRUE                                        6.41e-01
## cohortGlasgow:A4TRUE                                        7.64e-01
## cohortAPGI:A4TRUE                                           7.67e-01
## cohortDresden:A4TRUE                                        7.34e-01
##                                                             se(coef)     z
## LocBodyTRUE                                                 1.64e-01  1.73
## cohortGlasgow                                               2.87e-01 -2.86
## cohortAPGI                                                  3.59e-01 -2.99
## cohortDresden                                               3.91e-01 -1.75
## SexMTRUE                                                    1.33e-01 -0.74
## AgeCent                                                     7.30e-03 -0.42
## SizeCent                                                    5.13e-03  1.66
## Treat.MarginPositiveTRUE                                    1.41e-01  3.48
## I(Path.Differentiation %in% c("3", "4"))TRUE                1.61e-01  0.84
## A2TRUE                                                      2.03e-01  3.40
## A4TRUE                                                      1.59e-01  3.59
## cohortGlasgow:SexMTRUE                                      2.13e-01  1.18
## cohortAPGI:SexMTRUE                                         3.41e-01  1.64
## cohortDresden:SexMTRUE                                      2.38e-01  1.64
## cohortGlasgow:AgeCent                                       1.12e-02 -2.03
## cohortAPGI:AgeCent                                          1.94e-02  1.43
## cohortDresden:AgeCent                                       1.32e-02  1.38
## cohortGlasgow:SizeCent                                      9.38e-03  2.60
## cohortAPGI:SizeCent                                         1.01e-02  0.01
## cohortDresden:SizeCent                                      1.07e-02 -0.04
## cohortGlasgow:Treat.MarginPositiveTRUE                      2.38e-01  0.68
## cohortAPGI:Treat.MarginPositiveTRUE                         3.38e-01  2.45
## cohortDresden:Treat.MarginPositiveTRUE                      2.53e-01  0.31
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE  2.38e-01  0.73
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE     3.41e-01  0.79
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE  2.65e-01  1.36
## cohortGlasgow:A2TRUE                                        2.71e-01  0.21
## cohortAPGI:A2TRUE                                           4.36e-01 -0.46
## cohortDresden:A2TRUE                                        3.07e-01 -1.45
## cohortGlasgow:A4TRUE                                        2.42e-01 -1.11
## cohortAPGI:A4TRUE                                           3.73e-01 -0.71
## cohortDresden:A4TRUE                                        3.64e-01 -0.85
##                                                            Pr(>|z|)
## LocBodyTRUE                                                 0.08445
## cohortGlasgow                                               0.00422
## cohortAPGI                                                  0.00275
## cohortDresden                                               0.08017
## SexMTRUE                                                    0.46098
## AgeCent                                                     0.67098
## SizeCent                                                    0.09729
## Treat.MarginPositiveTRUE                                    0.00050
## I(Path.Differentiation %in% c("3", "4"))TRUE                0.40055
## A2TRUE                                                      0.00069
## A4TRUE                                                      0.00034
## cohortGlasgow:SexMTRUE                                      0.23670
## cohortAPGI:SexMTRUE                                         0.10066
## cohortDresden:SexMTRUE                                      0.10095
## cohortGlasgow:AgeCent                                       0.04235
## cohortAPGI:AgeCent                                          0.15134
## cohortDresden:AgeCent                                       0.16648
## cohortGlasgow:SizeCent                                      0.00928
## cohortAPGI:SizeCent                                         0.99325
## cohortDresden:SizeCent                                      0.96910
## cohortGlasgow:Treat.MarginPositiveTRUE                      0.49879
## cohortAPGI:Treat.MarginPositiveTRUE                         0.01431
## cohortDresden:Treat.MarginPositiveTRUE                      0.75612
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE  0.46494
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE     0.42668
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE  0.17251
## cohortGlasgow:A2TRUE                                        0.83723
## cohortAPGI:A2TRUE                                           0.64777
## cohortDresden:A2TRUE                                        0.14658
## cohortGlasgow:A4TRUE                                        0.26585
## cohortAPGI:A4TRUE                                           0.47722
## cohortDresden:A4TRUE                                        0.39663
## 
##                                                            exp(coef)
## LocBodyTRUE                                                    1.327
## cohortGlasgow                                                  0.440
## cohortAPGI                                                     0.341
## cohortDresden                                                  0.504
## SexMTRUE                                                       0.907
## AgeCent                                                        0.997
## SizeCent                                                       1.009
## Treat.MarginPositiveTRUE                                       1.633
## I(Path.Differentiation %in% c("3", "4"))TRUE                   1.145
## A2TRUE                                                         1.989
## A4TRUE                                                         1.768
## cohortGlasgow:SexMTRUE                                         1.287
## cohortAPGI:SexMTRUE                                            1.751
## cohortDresden:SexMTRUE                                         1.478
## cohortGlasgow:AgeCent                                          0.978
## cohortAPGI:AgeCent                                             1.028
## cohortDresden:AgeCent                                          1.018
## cohortGlasgow:SizeCent                                         1.025
## cohortAPGI:SizeCent                                            1.000
## cohortDresden:SizeCent                                         1.000
## cohortGlasgow:Treat.MarginPositiveTRUE                         1.175
## cohortAPGI:Treat.MarginPositiveTRUE                            2.287
## cohortDresden:Treat.MarginPositiveTRUE                         1.082
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE     1.190
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE        1.311
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE     1.436
## cohortGlasgow:A2TRUE                                           1.057
## cohortAPGI:A2TRUE                                              0.819
## cohortDresden:A2TRUE                                           0.641
## cohortGlasgow:A4TRUE                                           0.764
## cohortAPGI:A4TRUE                                              0.767
## cohortDresden:A4TRUE                                           0.734
##                                                            exp(-coef)
## LocBodyTRUE                                                     0.754
## cohortGlasgow                                                   2.275
## cohortAPGI                                                      2.933
## cohortDresden                                                   1.983
## SexMTRUE                                                        1.103
## AgeCent                                                         1.003
## SizeCent                                                        0.992
## Treat.MarginPositiveTRUE                                        0.612
## I(Path.Differentiation %in% c("3", "4"))TRUE                    0.874
## A2TRUE                                                          0.503
## A4TRUE                                                          0.566
## cohortGlasgow:SexMTRUE                                          0.777
## cohortAPGI:SexMTRUE                                             0.571
## cohortDresden:SexMTRUE                                          0.676
## cohortGlasgow:AgeCent                                           1.023
## cohortAPGI:AgeCent                                              0.973
## cohortDresden:AgeCent                                           0.982
## cohortGlasgow:SizeCent                                          0.976
## cohortAPGI:SizeCent                                             1.000
## cohortDresden:SizeCent                                          1.000
## cohortGlasgow:Treat.MarginPositiveTRUE                          0.851
## cohortAPGI:Treat.MarginPositiveTRUE                             0.437
## cohortDresden:Treat.MarginPositiveTRUE                          0.924
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE      0.840
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE         0.763
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE      0.696
## cohortGlasgow:A2TRUE                                            0.946
## cohortAPGI:A2TRUE                                               1.220
## cohortDresden:A2TRUE                                            1.560
## cohortGlasgow:A4TRUE                                            1.309
## cohortAPGI:A4TRUE                                               1.303
## cohortDresden:A4TRUE                                            1.362
##                                                            lower .95
## LocBodyTRUE                                                    0.962
## cohortGlasgow                                                  0.250
## cohortAPGI                                                     0.169
## cohortDresden                                                  0.234
## SexMTRUE                                                       0.698
## AgeCent                                                        0.983
## SizeCent                                                       0.998
## Treat.MarginPositiveTRUE                                       1.239
## I(Path.Differentiation %in% c("3", "4"))TRUE                   0.835
## A2TRUE                                                         1.337
## A4TRUE                                                         1.295
## cohortGlasgow:SexMTRUE                                         0.847
## cohortAPGI:SexMTRUE                                            0.897
## cohortDresden:SexMTRUE                                         0.927
## cohortGlasgow:AgeCent                                          0.956
## cohortAPGI:AgeCent                                             0.990
## cohortDresden:AgeCent                                          0.992
## cohortGlasgow:SizeCent                                         1.006
## cohortAPGI:SizeCent                                            0.980
## cohortDresden:SizeCent                                         0.979
## cohortGlasgow:Treat.MarginPositiveTRUE                         0.737
## cohortAPGI:Treat.MarginPositiveTRUE                            1.180
## cohortDresden:Treat.MarginPositiveTRUE                         0.659
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE     0.746
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE        0.672
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE     0.854
## cohortGlasgow:A2TRUE                                           0.622
## cohortAPGI:A2TRUE                                              0.349
## cohortDresden:A2TRUE                                           0.351
## cohortGlasgow:A4TRUE                                           0.476
## cohortAPGI:A4TRUE                                              0.370
## cohortDresden:A4TRUE                                           0.359
##                                                            upper .95
## LocBodyTRUE                                                    1.830
## cohortGlasgow                                                  0.772
## cohortAPGI                                                     0.689
## cohortDresden                                                  1.086
## SexMTRUE                                                       1.177
## AgeCent                                                        1.011
## SizeCent                                                       1.019
## Treat.MarginPositiveTRUE                                       2.153
## I(Path.Differentiation %in% c("3", "4"))TRUE                   1.568
## A2TRUE                                                         2.958
## A4TRUE                                                         2.414
## cohortGlasgow:SexMTRUE                                         1.956
## cohortAPGI:SexMTRUE                                            3.419
## cohortDresden:SexMTRUE                                         2.359
## cohortGlasgow:AgeCent                                          0.999
## cohortAPGI:AgeCent                                             1.068
## cohortDresden:AgeCent                                          1.045
## cohortGlasgow:SizeCent                                         1.044
## cohortAPGI:SizeCent                                            1.020
## cohortDresden:SizeCent                                         1.021
## cohortGlasgow:Treat.MarginPositiveTRUE                         1.872
## cohortAPGI:Treat.MarginPositiveTRUE                            4.433
## cohortDresden:Treat.MarginPositiveTRUE                         1.776
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE     1.897
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE        2.558
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE     2.416
## cohortGlasgow:A2TRUE                                           1.798
## cohortAPGI:A2TRUE                                              1.925
## cohortDresden:A2TRUE                                           1.169
## cohortGlasgow:A4TRUE                                           1.227
## cohortAPGI:A4TRUE                                              1.593
## cohortDresden:A4TRUE                                           1.500
## 
## Concordance= 0.681  (se = 0.014 )
## Rsquare= 0.274   (max possible= 1 )
## Likelihood ratio test= 209  on 32 df,   p=0
## Wald test            = 202  on 32 df,   p=0
## Score (logrank) test = 218  on 32 df,   p=0
\end{verbatim}
\begin{alltt}
\hlkwd{anova}\hlstd{(temp.allfit)}
\end{alltt}
\begin{verbatim}
## Analysis of Deviance Table
##  Cox model: response is Surv(Time, DSD)
## Terms added sequentially (first to last)
## 
##                                                 loglik Chisq Df Pr(>|Chi|)
## NULL                                             -3089                    
## LocBody                                          -3082 14.72  1    0.00013
## cohort                                           -3069 26.55  3    7.3e-06
## SexM                                             -3068  1.22  1    0.27016
## AgeCent                                          -3068  0.15  1    0.70036
## SizeCent                                         -3054 27.65  1    1.5e-07
## Treat.MarginPositive                             -3037 33.69  1    6.5e-09
## I(Path.Differentiation %in% c("3", "4"))         -3026 22.66  1    1.9e-06
## A2                                               -3011 29.43  1    5.8e-08
## A4                                               -3003 17.05  1    3.6e-05
## cohort:SexM                                      -3000  5.32  3    0.14956
## cohort:AgeCent                                   -2994 12.21  3    0.00671
## cohort:SizeCent                                  -2990  7.07  3    0.06978
## cohort:Treat.MarginPositive                      -2987  5.63  3    0.13114
## cohort:I(Path.Differentiation %in% c("3", "4"))  -2987  1.06  3    0.78686
## cohort:A2                                        -2985  3.33  3    0.34326
## cohort:A4                                        -2984  1.67  3    0.64338
\end{verbatim}
\begin{alltt}
\hlkwd{anova}\hlstd{(temp.allfit, temp.allfit2)}
\end{alltt}
\begin{verbatim}
## Analysis of Deviance Table
##  Cox model: response is  Surv(Time, DSD)
##  Model 1: ~ LocBody + cohort * (SexM + AgeCent + SizeCent + Treat.MarginPositive + I(Path.Differentiation %in% c("3", "4")) + A2 + A4)
##  Model 2: ~ LocBody + SexM + AgeCent + SizeCent + Treat.MarginPositive + I(Path.Differentiation %in% c("3", "4")) + A2 + A4
##   loglik Chisq Df P(>|Chi|)
## 1  -2984                   
## 2  -3025  81.3 24   3.8e-08
\end{verbatim}
\begin{alltt}
\hlkwd{cox.zph}\hlstd{(temp.allfit)}
\end{alltt}
\begin{verbatim}
##                                                                 rho
## LocBodyTRUE                                                 0.03809
## cohortGlasgow                                               0.06697
## cohortAPGI                                                  0.01437
## cohortDresden                                              -0.01345
## SexMTRUE                                                    0.11035
## AgeCent                                                    -0.07038
## SizeCent                                                   -0.05970
## Treat.MarginPositiveTRUE                                   -0.05022
## I(Path.Differentiation %in% c("3", "4"))TRUE               -0.00879
## A2TRUE                                                      0.02464
## A4TRUE                                                     -0.06118
## cohortGlasgow:SexMTRUE                                     -0.07548
## cohortAPGI:SexMTRUE                                        -0.10355
## cohortDresden:SexMTRUE                                     -0.05615
## cohortGlasgow:AgeCent                                       0.03511
## cohortAPGI:AgeCent                                         -0.06395
## cohortDresden:AgeCent                                       0.00267
## cohortGlasgow:SizeCent                                     -0.01654
## cohortAPGI:SizeCent                                         0.02391
## cohortDresden:SizeCent                                     -0.00991
## cohortGlasgow:Treat.MarginPositiveTRUE                      0.00379
## cohortAPGI:Treat.MarginPositiveTRUE                         0.06396
## cohortDresden:Treat.MarginPositiveTRUE                      0.01213
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE -0.04754
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE    -0.00593
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE  0.06682
## cohortGlasgow:A2TRUE                                       -0.04746
## cohortAPGI:A2TRUE                                           0.06970
## cohortDresden:A2TRUE                                       -0.02126
## cohortGlasgow:A4TRUE                                       -0.02756
## cohortAPGI:A4TRUE                                           0.01480
## cohortDresden:A4TRUE                                       -0.01282
## GLOBAL                                                           NA
##                                                               chisq
## LocBodyTRUE                                                 0.90616
## cohortGlasgow                                               2.56256
## cohortAPGI                                                  0.10117
## cohortDresden                                               0.12785
## SexMTRUE                                                    6.70881
## AgeCent                                                     3.28661
## SizeCent                                                    2.35545
## Treat.MarginPositiveTRUE                                    1.50171
## I(Path.Differentiation %in% c("3", "4"))TRUE                0.04807
## A2TRUE                                                      0.38624
## A4TRUE                                                      2.05228
## cohortGlasgow:SexMTRUE                                      3.23367
## cohortAPGI:SexMTRUE                                         6.67723
## cohortDresden:SexMTRUE                                      1.91757
## cohortGlasgow:AgeCent                                       0.71607
## cohortAPGI:AgeCent                                          2.76090
## cohortDresden:AgeCent                                       0.00445
## cohortGlasgow:SizeCent                                      0.18172
## cohortAPGI:SizeCent                                         0.35473
## cohortDresden:SizeCent                                      0.07646
## cohortGlasgow:Treat.MarginPositiveTRUE                      0.00837
## cohortAPGI:Treat.MarginPositiveTRUE                         2.63651
## cohortDresden:Treat.MarginPositiveTRUE                      0.09593
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE  1.29374
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE     0.02202
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE  2.94642
## cohortGlasgow:A2TRUE                                        1.29339
## cohortAPGI:A2TRUE                                           2.82302
## cohortDresden:A2TRUE                                        0.28947
## cohortGlasgow:A4TRUE                                        0.40662
## cohortAPGI:A4TRUE                                           0.13340
## cohortDresden:A4TRUE                                        0.10976
## GLOBAL                                                     58.78746
##                                                                  p
## LocBodyTRUE                                                0.34114
## cohortGlasgow                                              0.10942
## cohortAPGI                                                 0.75043
## cohortDresden                                              0.72067
## SexMTRUE                                                   0.00959
## AgeCent                                                    0.06985
## SizeCent                                                   0.12485
## Treat.MarginPositiveTRUE                                   0.22041
## I(Path.Differentiation %in% c("3", "4"))TRUE               0.82645
## A2TRUE                                                     0.53428
## A4TRUE                                                     0.15198
## cohortGlasgow:SexMTRUE                                     0.07214
## cohortAPGI:SexMTRUE                                        0.00977
## cohortDresden:SexMTRUE                                     0.16613
## cohortGlasgow:AgeCent                                      0.39744
## cohortAPGI:AgeCent                                         0.09659
## cohortDresden:AgeCent                                      0.94683
## cohortGlasgow:SizeCent                                     0.66990
## cohortAPGI:SizeCent                                        0.55145
## cohortDresden:SizeCent                                     0.78216
## cohortGlasgow:Treat.MarginPositiveTRUE                     0.92710
## cohortAPGI:Treat.MarginPositiveTRUE                        0.10443
## cohortDresden:Treat.MarginPositiveTRUE                     0.75677
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE 0.25536
## cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE    0.88203
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE 0.08607
## cohortGlasgow:A2TRUE                                       0.25542
## cohortAPGI:A2TRUE                                          0.09292
## cohortDresden:A2TRUE                                       0.59056
## cohortGlasgow:A4TRUE                                       0.52369
## cohortAPGI:A4TRUE                                          0.71493
## cohortDresden:A4TRUE                                       0.74042
## GLOBAL                                                     0.00267
\end{verbatim}
\begin{alltt}
\hlstd{temp} \hlkwb{=} \hlkwd{cox.zph}\hlstd{(temp.allfit)}\hlopt{$}\hlstd{table}
\hlkwd{sort}\hlstd{(}\hlkwd{p.adjust}\hlstd{(temp[}\hlkwd{grepl}\hlstd{(}\hlstr{"^cohort"}\hlstd{,} \hlkwd{rownames}\hlstd{(temp)),} \hlstr{"p"}\hlstd{],} \hlstr{"holm"}\hlstd{))}
\end{alltt}
\begin{verbatim}
##                                        cohortAPGI:SexMTRUE 
##                                                     0.2344 
##                                              cohortGlasgow 
##                                                     1.0000 
##                                                 cohortAPGI 
##                                                     1.0000 
##                                              cohortDresden 
##                                                     1.0000 
##                                     cohortGlasgow:SexMTRUE 
##                                                     1.0000 
##                                     cohortDresden:SexMTRUE 
##                                                     1.0000 
##                                      cohortGlasgow:AgeCent 
##                                                     1.0000 
##                                         cohortAPGI:AgeCent 
##                                                     1.0000 
##                                      cohortDresden:AgeCent 
##                                                     1.0000 
##                                     cohortGlasgow:SizeCent 
##                                                     1.0000 
##                                        cohortAPGI:SizeCent 
##                                                     1.0000 
##                                     cohortDresden:SizeCent 
##                                                     1.0000 
##                     cohortGlasgow:Treat.MarginPositiveTRUE 
##                                                     1.0000 
##                        cohortAPGI:Treat.MarginPositiveTRUE 
##                                                     1.0000 
##                     cohortDresden:Treat.MarginPositiveTRUE 
##                                                     1.0000 
## cohortGlasgow:I(Path.Differentiation %in% c("3", "4"))TRUE 
##                                                     1.0000 
##    cohortAPGI:I(Path.Differentiation %in% c("3", "4"))TRUE 
##                                                     1.0000 
## cohortDresden:I(Path.Differentiation %in% c("3", "4"))TRUE 
##                                                     1.0000 
##                                       cohortGlasgow:A2TRUE 
##                                                     1.0000 
##                                          cohortAPGI:A2TRUE 
##                                                     1.0000 
##                                       cohortDresden:A2TRUE 
##                                                     1.0000 
##                                       cohortGlasgow:A4TRUE 
##                                                     1.0000 
##                                          cohortAPGI:A4TRUE 
##                                                     1.0000 
##                                       cohortDresden:A4TRUE 
##                                                     1.0000
\end{verbatim}
\begin{alltt}
\hlcom{#plot(cox.zph(temp.allfit))}
\end{alltt}
\end{kframe}
\end{knitrout}


\section{Score calculation}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp} \hlkwb{=} \hlkwd{applyNomogram}\hlstd{(fit.mskcc, data.glasgow)}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Portal.Vein}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Splenectomy}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Posterior.Margin}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Back.pain}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Weight.loss}}\begin{alltt}
\hlstd{mskcc_post.linpred.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{1}\hlstd{]}
\hlstd{mskcc_post.12mo.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{2}\hlstd{]}
\hlstd{mskcc_post.24mo.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{3}\hlstd{]}
\hlstd{mskcc_post.36mo.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{4}\hlstd{]}
\hlstd{temp} \hlkwb{=} \hlkwd{applyNomogram}\hlstd{(fit.mskcc, data.glasgow[,}\hlkwd{c}\hlstd{(}\hlstr{"History.Diagnosis.AgeAt"}\hlstd{,} \hlstr{"Patient.Sex"}\hlstd{,} \hlstr{"Path.LocationBody"}\hlstd{,} \hlstr{"Stage.pT.Simplified"}\hlstd{,} \hlstr{"Path.Size"}\hlstd{)])}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Portal.Vein}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Splenectomy}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Treat.MarginPositive}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.Differentiation}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Posterior.Margin}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Involved}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Negative}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Back.pain}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Weight.loss}}\begin{alltt}
\hlstd{mskcc_pre.linpred.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{1}\hlstd{]}
\hlstd{mskcc_pre.12mo.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{2}\hlstd{]}
\hlstd{mskcc_pre.24mo.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{3}\hlstd{]}
\hlstd{mskcc_pre.36mo.glasgow} \hlkwb{=} \hlstd{temp[,}\hlnum{4}\hlstd{]}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp} \hlkwb{=} \hlkwd{applyNomogram}\hlstd{(fit.mskcc, data.apgi)}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Portal.Vein}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Splenectomy}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Posterior.Margin}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Back.pain}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Weight.loss}}\begin{alltt}
\hlstd{mskcc_post.linpred.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{1}\hlstd{]}
\hlstd{mskcc_post.12mo.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{2}\hlstd{]}
\hlstd{mskcc_post.24mo.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{3}\hlstd{]}
\hlstd{mskcc_post.36mo.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{4}\hlstd{]}
\hlstd{temp} \hlkwb{=} \hlkwd{applyNomogram}\hlstd{(fit.mskcc, data.apgi[,}\hlkwd{c}\hlstd{(}\hlstr{"History.Diagnosis.AgeAt"}\hlstd{,} \hlstr{"Patient.Sex"}\hlstd{,} \hlstr{"Path.LocationBody"}\hlstd{,} \hlstr{"Stage.pT.Simplified"}\hlstd{,} \hlstr{"Path.Size"}\hlstd{)])}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Portal.Vein}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Splenectomy}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Treat.MarginPositive}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.Differentiation}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Posterior.Margin}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Involved}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Negative}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Back.pain}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Weight.loss}}\begin{alltt}
\hlstd{mskcc_pre.linpred.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{1}\hlstd{]}
\hlstd{mskcc_pre.12mo.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{2}\hlstd{]}
\hlstd{mskcc_pre.24mo.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{3}\hlstd{]}
\hlstd{mskcc_pre.36mo.apgi} \hlkwb{=} \hlstd{temp[,}\hlnum{4}\hlstd{]}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp} \hlkwb{=} \hlkwd{applyNomogram}\hlstd{(fit.mskcc, data.dresden)}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Portal.Vein}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Splenectomy}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Posterior.Margin}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Involved}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Negative}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Back.pain}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Weight.loss}}\begin{alltt}
\hlstd{mskcc_post.linpred.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{1}\hlstd{]}
\hlstd{mskcc_post.12mo.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{2}\hlstd{]}
\hlstd{mskcc_post.24mo.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{3}\hlstd{]}
\hlstd{mskcc_post.36mo.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{4}\hlstd{]}
\hlstd{temp} \hlkwb{=} \hlkwd{applyNomogram}\hlstd{(fit.mskcc, data.dresden[,}\hlkwd{c}\hlstd{(}\hlstr{"History.Diagnosis.AgeAt"}\hlstd{,} \hlstr{"Patient.Sex"}\hlstd{,} \hlstr{"Path.LocationBody"}\hlstd{,} \hlstr{"Stage.pT.Simplified"}\hlstd{,} \hlstr{"Path.Size"}\hlstd{)])}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Portal.Vein}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Splenectomy}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Treat.MarginPositive}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.Differentiation}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Posterior.Margin}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Involved}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Path.LN.Negative}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Back.pain}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning in FUN(c("{}History.Diagnosis.AgeAt"{}, "{}Patient.Sex"{}, "{}Portal.Vein"{}, : Marginalizing missing variable: Weight.loss}}\begin{alltt}
\hlstd{mskcc_pre.linpred.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{1}\hlstd{]}
\hlstd{mskcc_pre.12mo.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{2}\hlstd{]}
\hlstd{mskcc_pre.24mo.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{3}\hlstd{]}
\hlstd{mskcc_pre.36mo.dresden} \hlkwb{=} \hlstd{temp[,}\hlnum{4}\hlstd{]}
\end{alltt}
\end{kframe}
\end{knitrout}

Get approximate linear predictors from the GG model, by just calculating the location term.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{val.prob.times} \hlkwb{=} \hlkwd{seq}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{max}\hlstd{(}\hlkwd{c}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{Time)),} \hlnum{1}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{gg.path.glasgow} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.glasgow,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.coefs} \hlkwb{=} \hlkwd{coef}\hlstd{(fit.gg)}
\hlstd{gg.linpred.glasgow} \hlkwb{=} \hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.coefs),} \hlkwa{function}\hlstd{(}\hlkwc{coef_i}\hlstd{) \{}
        \hlcom{# if (names(temp.coefs)[coef_i] == "SexMTRUE") \{}
 \hlcom{#        rep(0, nrow(data.val)) }
        \hlcom{# \} else }
        \hlkwa{if} \hlstd{(}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.glasgow)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.glasgow[,}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]]}
        \hlstd{\}} \hlkwa{else if} \hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.glasgow)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.glasgow[,}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])]}
        \hlstd{\}} \hlkwa{else} \hlstd{\{}
                \hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{nrow}\hlstd{(data.glasgow))}
        \hlstd{\} \})}
\hlstd{gg.linpred.glasgow} \hlkwb{=} \hlopt{-}\hlkwd{rowSums}\hlstd{(gg.linpred.glasgow)}       \hlcom{# Negate to bring into concordance with the direction of Cox coefficients (ie higher is now worse)}
\hlstd{temp} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.glasgow,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.prob.glasgow} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)} \hlkwd{approx}\hlstd{(x[,}\hlnum{1}\hlstd{], x[,}\hlnum{2}\hlstd{],} \hlkwc{xout} \hlstd{= val.prob.times,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlstd{)}\hlopt{$}\hlstd{y)}
\hlkwd{colnames}\hlstd{(gg.prob.glasgow)} \hlkwb{=} \hlkwd{rownames}\hlstd{(data.glasgow)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{gg.path.apgi} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.apgi,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.coefs} \hlkwb{=} \hlkwd{coef}\hlstd{(fit.gg)}
\hlstd{gg.linpred.apgi} \hlkwb{=} \hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.coefs),} \hlkwa{function}\hlstd{(}\hlkwc{coef_i}\hlstd{) \{}
        \hlcom{# if (names(temp.coefs)[coef_i] == "SexMTRUE") \{}
 \hlcom{#        rep(0, nrow(data.val)) }
        \hlcom{# \} else }
        \hlkwa{if} \hlstd{(}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.apgi)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.apgi[,}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]]}
        \hlstd{\}} \hlkwa{else if} \hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.apgi)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.apgi[,}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])]}
        \hlstd{\}} \hlkwa{else} \hlstd{\{}
                \hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{nrow}\hlstd{(data.apgi))}
        \hlstd{\} \})}
\hlstd{gg.linpred.apgi} \hlkwb{=} \hlopt{-}\hlkwd{rowSums}\hlstd{(gg.linpred.apgi)}     \hlcom{# Negate to bring into concordance with the direction of Cox coefficients (ie higher is now worse)}
\hlstd{temp} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.apgi,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.prob.apgi} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)} \hlkwd{approx}\hlstd{(x[,}\hlnum{1}\hlstd{], x[,}\hlnum{2}\hlstd{],} \hlkwc{xout} \hlstd{= val.prob.times,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlstd{)}\hlopt{$}\hlstd{y)}
\hlkwd{colnames}\hlstd{(gg.prob.apgi)} \hlkwb{=} \hlkwd{rownames}\hlstd{(data.apgi)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{gg.path.dresden} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.dresden,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.coefs} \hlkwb{=} \hlkwd{coef}\hlstd{(fit.gg)}
\hlstd{gg.linpred.dresden} \hlkwb{=} \hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.coefs),} \hlkwa{function}\hlstd{(}\hlkwc{coef_i}\hlstd{) \{}
        \hlcom{# if (names(temp.coefs)[coef_i] == "SexMTRUE") \{}
 \hlcom{#        rep(0, nrow(data.val)) }
        \hlcom{# \} else }
        \hlkwa{if} \hlstd{(}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.dresden)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.dresden[,}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]]}
        \hlstd{\}} \hlkwa{else if} \hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.dresden)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.dresden[,}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])]}
        \hlstd{\}} \hlkwa{else} \hlstd{\{}
                \hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{nrow}\hlstd{(data.dresden))}
        \hlstd{\} \})}
\hlstd{gg.linpred.dresden} \hlkwb{=} \hlopt{-}\hlkwd{rowSums}\hlstd{(gg.linpred.dresden)}       \hlcom{# Negate to bring into concordance with the direction of Cox coefficients (ie higher is now worse)}
\hlstd{temp} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.dresden,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.prob.dresden} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)} \hlkwd{approx}\hlstd{(x[,}\hlnum{1}\hlstd{], x[,}\hlnum{2}\hlstd{],} \hlkwc{xout} \hlstd{= val.prob.times,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlstd{)}\hlopt{$}\hlstd{y)}
\hlkwd{colnames}\hlstd{(gg.prob.dresden)} \hlkwb{=} \hlkwd{rownames}\hlstd{(data.dresden)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{gg.linpred.nswpcn} \hlkwb{=} \hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.coefs),} \hlkwa{function}\hlstd{(}\hlkwc{coef_i}\hlstd{) \{}
        \hlcom{# if (names(temp.coefs)[coef_i] == "SexMTRUE") \{}
 \hlcom{#        rep(0, nrow(data.val)) }
        \hlcom{# \} else }
        \hlkwa{if} \hlstd{(}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.glasgow)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.nswpcn[,}\hlkwd{names}\hlstd{(temp.coefs)[coef_i]]}
        \hlstd{\}} \hlkwa{else if} \hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])} \hlopt{%in%} \hlkwd{colnames}\hlstd{(data.nswpcn)) \{}
                \hlstd{temp.coefs[coef_i]} \hlopt{*} \hlstd{data.nswpcn[,}\hlkwd{gsub}\hlstd{(}\hlstr{"TRUE$"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.coefs)[coef_i])]}
        \hlstd{\}} \hlkwa{else} \hlstd{\{}
                \hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwd{nrow}\hlstd{(data.nswpcn))}
        \hlstd{\} \})}
\hlstd{gg.linpred.nswpcn} \hlkwb{=} \hlopt{-}\hlkwd{rowSums}\hlstd{(gg.linpred.nswpcn)}         \hlcom{# Negate to bring into concordance with the direction of Cox coefficients (ie higher is now worse)}
\hlstd{temp} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.nswpcn,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.prob.nswpcn} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)} \hlkwd{approx}\hlstd{(x[,}\hlnum{1}\hlstd{], x[,}\hlnum{2}\hlstd{],} \hlkwc{xout} \hlstd{= val.prob.times,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlstd{)}\hlopt{$}\hlstd{y)}
\hlkwd{colnames}\hlstd{(gg.prob.nswpcn)} \hlkwb{=} \hlkwd{rownames}\hlstd{(data.nswpcn)}
\end{alltt}
\end{kframe}
\end{knitrout}

\section{Validation}
\subsection{Altman diagnostic 1: score histograms}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{pars} \hlkwb{=} \hlkwd{par}\hlstd{(}\hlkwc{no.readonly} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlkwd{par}\hlstd{(}\hlkwc{mfrow} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{mar} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{5.1}\hlstd{,} \hlnum{5.1}\hlstd{,} \hlnum{4.1}\hlstd{,} \hlnum{2.1}\hlstd{))}
\hlstd{temp.breaks} \hlkwb{=} \hlkwd{seq}\hlstd{(}\hlkwd{min}\hlstd{(}\hlkwd{c}\hlstd{(gg.linpred.nswpcn, gg.linpred.glasgow, gg.linpred.apgi, gg.linpred.dresden)),} \hlkwd{max}\hlstd{(}\hlkwd{c}\hlstd{(gg.linpred.nswpcn, gg.linpred.glasgow, gg.linpred.apgi, gg.linpred.dresden)),} \hlkwc{length.out} \hlstd{=} \hlnum{29}\hlstd{)}
\hlkwd{hist}\hlstd{(gg.linpred.nswpcn,} \hlkwc{main} \hlstd{=} \hlstr{"NSWPCN"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{range}\hlstd{(}\hlkwd{c}\hlstd{(gg.linpred.nswpcn, gg.linpred.glasgow, gg.linpred.apgi, gg.linpred.dresden)),} \hlkwc{breaks} \hlstd{= temp.breaks,} \hlkwc{col} \hlstd{=} \hlstr{"lightgrey"}\hlstd{,} \hlkwc{xlab} \hlstd{=} \hlstr{""}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.main} \hlstd{=} \hlnum{2}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{quantile}\hlstd{(gg.linpred.nswpcn,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.8}\hlstd{)),} \hlkwc{col} \hlstd{=} \hlkwd{rgb}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0.8}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{hist}\hlstd{(gg.linpred.glasgow,} \hlkwc{main} \hlstd{=} \hlstr{"Glasgow"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{range}\hlstd{(}\hlkwd{c}\hlstd{(gg.linpred.nswpcn, gg.linpred.glasgow, gg.linpred.apgi, gg.linpred.dresden)),} \hlkwc{breaks} \hlstd{= temp.breaks,} \hlkwc{col} \hlstd{=} \hlstr{"lightgrey"}\hlstd{,} \hlkwc{xlab} \hlstd{=} \hlstr{""}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.main} \hlstd{=} \hlnum{2}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{quantile}\hlstd{(gg.linpred.glasgow,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.8}\hlstd{)),} \hlkwc{col} \hlstd{=} \hlkwd{rgb}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0.8}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{hist}\hlstd{(gg.linpred.apgi,} \hlkwc{main} \hlstd{=} \hlstr{"APGI"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{range}\hlstd{(}\hlkwd{c}\hlstd{(gg.linpred.nswpcn, gg.linpred.glasgow, gg.linpred.apgi, gg.linpred.dresden)),} \hlkwc{breaks} \hlstd{= temp.breaks,} \hlkwc{col} \hlstd{=} \hlstr{"lightgrey"}\hlstd{,} \hlkwc{xlab} \hlstd{=} \hlstr{""}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.main} \hlstd{=} \hlnum{2}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{quantile}\hlstd{(gg.linpred.apgi,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.8}\hlstd{)),} \hlkwc{col} \hlstd{=} \hlkwd{rgb}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0.8}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{hist}\hlstd{(gg.linpred.dresden,} \hlkwc{main} \hlstd{=} \hlstr{"Dresden"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{range}\hlstd{(}\hlkwd{c}\hlstd{(gg.linpred.nswpcn, gg.linpred.glasgow, gg.linpred.apgi, gg.linpred.dresden)),} \hlkwc{breaks} \hlstd{= temp.breaks,} \hlkwc{col} \hlstd{=} \hlstr{"lightgrey"}\hlstd{,} \hlkwc{xlab} \hlstd{=} \hlstr{""}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{2}\hlstd{,} \hlkwc{cex.main} \hlstd{=} \hlnum{2}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{quantile}\hlstd{(gg.linpred.dresden,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{0.8}\hlstd{)),} \hlkwc{col} \hlstd{=} \hlkwd{rgb}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0.8}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-score-hists-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{par}\hlstd{(pars)}
\end{alltt}
\end{kframe}
\end{knitrout}

\subsection{Altman method 1 (D,F)}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{mskcc_post.linpred.glasgow, data.glasgow))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ mskcc_post.linpred.glasgow, 
##     data = data.glasgow)
## 
##   n= 189, number of events= 161 
## 
##                               coef exp(coef) se(coef)    z Pr(>|z|)
## mskcc_post.linpred.glasgow 0.01682   1.01696  0.00428 3.93  8.4e-05
## 
##                            exp(coef) exp(-coef) lower .95 upper .95
## mskcc_post.linpred.glasgow      1.02      0.983      1.01      1.03
## 
## Concordance= 0.584  (se = 0.026 )
## Rsquare= 0.081   (max possible= 0.999 )
## Likelihood ratio test= 15.9  on 1 df,   p=6.79e-05
## Wald test            = 15.5  on 1 df,   p=8.43e-05
## Score (logrank) test = 15.7  on 1 df,   p=7.56e-05
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{mskcc_pre.linpred.glasgow, data.glasgow))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ mskcc_pre.linpred.glasgow, 
##     data = data.glasgow)
## 
##   n= 189, number of events= 161 
## 
##                             coef exp(coef) se(coef)    z Pr(>|z|)
## mskcc_pre.linpred.glasgow 0.0118    1.0118   0.0105 1.12     0.26
## 
##                           exp(coef) exp(-coef) lower .95 upper .95
## mskcc_pre.linpred.glasgow      1.01      0.988     0.991      1.03
## 
## Concordance= 0.585  (se = 0.026 )
## Rsquare= 0.006   (max possible= 0.999 )
## Likelihood ratio test= 1.15  on 1 df,   p=0.284
## Wald test            = 1.25  on 1 df,   p=0.263
## Score (logrank) test = 1.25  on 1 df,   p=0.264
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{mskcc_post.linpred.apgi, data.apgi))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ mskcc_post.linpred.apgi, data = data.apgi)
## 
##   n= 75, number of events= 51 
## 
##                            coef exp(coef) se(coef)   z Pr(>|z|)
## mskcc_post.linpred.apgi 0.01626   1.01639  0.00452 3.6  0.00032
## 
##                         exp(coef) exp(-coef) lower .95 upper .95
## mskcc_post.linpred.apgi      1.02      0.984      1.01      1.03
## 
## Concordance= 0.701  (se = 0.044 )
## Rsquare= 0.14   (max possible= 0.993 )
## Likelihood ratio test= 11.3  on 1 df,   p=0.000754
## Wald test            = 12.9  on 1 df,   p=0.000319
## Score (logrank) test = 13.3  on 1 df,   p=0.000268
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{mskcc_pre.linpred.apgi, data.apgi))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ mskcc_pre.linpred.apgi, data = data.apgi)
## 
##   n= 75, number of events= 51 
## 
##                           coef exp(coef) se(coef)    z Pr(>|z|)
## mskcc_pre.linpred.apgi 0.00329   1.00330  0.00673 0.49     0.62
## 
##                        exp(coef) exp(-coef) lower .95 upper .95
## mskcc_pre.linpred.apgi         1      0.997      0.99      1.02
## 
## Concordance= 0.475  (se = 0.044 )
## Rsquare= 0.003   (max possible= 0.993 )
## Likelihood ratio test= 0.23  on 1 df,   p=0.634
## Wald test            = 0.24  on 1 df,   p=0.625
## Score (logrank) test = 0.24  on 1 df,   p=0.624
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{mskcc_post.linpred.dresden, data.dresden))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ mskcc_post.linpred.dresden, 
##     data = data.dresden)
## 
##   n= 150, number of events= 112 
## 
##                               coef exp(coef) se(coef)    z Pr(>|z|)
## mskcc_post.linpred.dresden 0.00792   1.00795  0.00363 2.18    0.029
## 
##                            exp(coef) exp(-coef) lower .95 upper .95
## mskcc_post.linpred.dresden      1.01      0.992         1      1.02
## 
## Concordance= 0.597  (se = 0.031 )
## Rsquare= 0.028   (max possible= 0.998 )
## Likelihood ratio test= 4.2  on 1 df,   p=0.0404
## Wald test            = 4.76  on 1 df,   p=0.0291
## Score (logrank) test = 4.81  on 1 df,   p=0.0282
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{mskcc_pre.linpred.dresden, data.dresden))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ mskcc_pre.linpred.dresden, 
##     data = data.dresden)
## 
##   n= 150, number of events= 112 
## 
##                              coef exp(coef) se(coef)    z Pr(>|z|)
## mskcc_pre.linpred.dresden 0.00336   1.00337  0.00485 0.69     0.49
## 
##                           exp(coef) exp(-coef) lower .95 upper .95
## mskcc_pre.linpred.dresden         1      0.997     0.994      1.01
## 
## Concordance= 0.518  (se = 0.031 )
## Rsquare= 0.003   (max possible= 0.998 )
## Likelihood ratio test= 0.45  on 1 df,   p=0.502
## Wald test            = 0.48  on 1 df,   p=0.488
## Score (logrank) test = 0.48  on 1 df,   p=0.488
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{gg.linpred.glasgow, data.glasgow))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ gg.linpred.glasgow, data = data.glasgow)
## 
##   n= 189, number of events= 161 
## 
##                     coef exp(coef) se(coef)    z Pr(>|z|)
## gg.linpred.glasgow 0.805     2.236    0.239 3.37  0.00075
## 
##                    exp(coef) exp(-coef) lower .95 upper .95
## gg.linpred.glasgow      2.24      0.447       1.4      3.57
## 
## Concordance= 0.607  (se = 0.026 )
## Rsquare= 0.059   (max possible= 0.999 )
## Likelihood ratio test= 11.4  on 1 df,   p=0.000725
## Wald test            = 11.3  on 1 df,   p=0.000754
## Score (logrank) test = 11.5  on 1 df,   p=0.000705
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{gg.linpred.apgi, data.apgi))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ gg.linpred.apgi, data = data.apgi)
## 
##   n= 75, number of events= 51 
## 
##                  coef exp(coef) se(coef)    z Pr(>|z|)
## gg.linpred.apgi 0.894     2.444    0.427 2.09    0.036
## 
##                 exp(coef) exp(-coef) lower .95 upper .95
## gg.linpred.apgi      2.44      0.409      1.06      5.64
## 
## Concordance= 0.579  (se = 0.044 )
## Rsquare= 0.057   (max possible= 0.993 )
## Likelihood ratio test= 4.42  on 1 df,   p=0.0355
## Wald test            = 4.39  on 1 df,   p=0.0362
## Score (logrank) test = 4.43  on 1 df,   p=0.0352
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlstd{gg.linpred.dresden, data.dresden))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ gg.linpred.dresden, data = data.dresden)
## 
##   n= 150, number of events= 112 
## 
##                     coef exp(coef) se(coef)    z Pr(>|z|)
## gg.linpred.dresden 0.527     1.694    0.312 1.69    0.091
## 
##                    exp(coef) exp(-coef) lower .95 upper .95
## gg.linpred.dresden      1.69       0.59     0.919      3.12
## 
## Concordance= 0.545  (se = 0.031 )
## Rsquare= 0.019   (max possible= 0.998 )
## Likelihood ratio test= 2.82  on 1 df,   p=0.0928
## Wald test            = 2.85  on 1 df,   p=0.0913
## Score (logrank) test = 2.86  on 1 df,   p=0.0911
\end{verbatim}
\begin{alltt}
\hlkwd{anova}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(gg.linpred.glasgow)} \hlopt{+} \hlstd{gg.linpred.glasgow, data.glasgow))}
\end{alltt}
\begin{verbatim}
## Analysis of Deviance Table
##  Cox model: response is Surv(Time, DSD)
## Terms added sequentially (first to last)
## 
##                    loglik Chisq Df Pr(>|Chi|)
## NULL                 -678                    
## gg.linpred.glasgow   -678  0.66  1       0.41
\end{verbatim}
\begin{alltt}
\hlkwd{anova}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(gg.linpred.apgi)} \hlopt{+} \hlstd{gg.linpred.apgi, data.apgi))}
\end{alltt}
\begin{verbatim}
## Analysis of Deviance Table
##  Cox model: response is Surv(Time, DSD)
## Terms added sequentially (first to last)
## 
##                 loglik Chisq Df Pr(>|Chi|)
## NULL              -185                    
## gg.linpred.apgi   -185  0.06  1        0.8
\end{verbatim}
\begin{alltt}
\hlkwd{anova}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(gg.linpred.dresden)} \hlopt{+} \hlstd{gg.linpred.dresden, data.dresden))}
\end{alltt}
\begin{verbatim}
## Analysis of Deviance Table
##  Cox model: response is Surv(Time, DSD)
## Terms added sequentially (first to last)
## 
##                    loglik Chisq Df Pr(>|Chi|)
## NULL                 -466                    
## gg.linpred.dresden   -465  2.31  1       0.13
\end{verbatim}
\end{kframe}
\end{knitrout}
Booyah.


\subsection{Altman method 2 (F)}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(mskcc_pre.linpred.glasgow)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.glasgow))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in fitter(X, Y, strats, offset, init, control, weights = weights, : Ran out of iterations and did not converge}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in fitter(X, Y, strats, offset, init, control, weights = weights, : NA/NaN/Inf in foreign function call (arg 6)}}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(mskcc_post.linpred.glasgow)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.glasgow))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ offset(mskcc_post.linpred.glasgow) + 
##     AgeCent + SexM + SizeCent + A2 + A4, data = data.glasgow)
## 
##   n= 189, number of events= 161 
## 
##               coef exp(coef)  se(coef)      z Pr(>|z|)
## AgeCent    0.22744   1.25538   0.00862  26.39  < 2e-16
## SexMTRUE  -4.18282   0.01526   0.29544 -14.16  < 2e-16
## SizeCent   0.07140   1.07401   0.01910   3.74  0.00019
## A2TRUE    -2.96537   0.05154   0.41042  -7.23    5e-13
## A4TRUE     5.40464 222.43685   0.28361  19.06  < 2e-16
## 
##          exp(coef) exp(-coef) lower .95 upper .95
## AgeCent     1.2554     0.7966  1.23e+00    1.2768
## SexMTRUE    0.0153    65.5506  8.55e-03    0.0272
## SizeCent    1.0740     0.9311  1.03e+00    1.1150
## A2TRUE      0.0515    19.4019  2.31e-02    0.1152
## A4TRUE    222.4369     0.0045  1.28e+02  387.8075
## 
## Concordance= 0.588  (se = 0.026 )
## Rsquare= 0.982   (max possible= 1 )
## Likelihood ratio test= 757  on 5 df,   p=0
## Wald test            = 1654  on 5 df,   p=0
## Score (logrank) test = 1745  on 5 df,   p=0
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(gg.linpred.glasgow)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.glasgow))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ offset(gg.linpred.glasgow) + 
##     AgeCent + SexM + SizeCent + A2 + A4, data = data.glasgow)
## 
##   n= 189, number of events= 161 
## 
##              coef exp(coef) se(coef)     z Pr(>|z|)
## AgeCent  -0.03105   0.96943  0.00872 -3.56  0.00037
## SexMTRUE  0.63117   1.87981  0.16671  3.79  0.00015
## SizeCent  0.02245   1.02270  0.00767  2.93  0.00343
## A2TRUE    0.33327   1.39553  0.17564  1.90  0.05776
## A4TRUE   -0.05074   0.95052  0.18482 -0.27  0.78367
## 
##          exp(coef) exp(-coef) lower .95 upper .95
## AgeCent      0.969      1.032     0.953     0.986
## SexMTRUE     1.880      0.532     1.356     2.606
## SizeCent     1.023      0.978     1.007     1.038
## A2TRUE       1.396      0.717     0.989     1.969
## A4TRUE       0.951      1.052     0.662     1.365
## 
## Concordance= 0.676  (se = 0.026 )
## Rsquare= 0.184   (max possible= 0.999 )
## Likelihood ratio test= 38.4  on 5 df,   p=3.19e-07
## Wald test            = 39  on 5 df,   p=2.4e-07
## Score (logrank) test = 40.5  on 5 df,   p=1.19e-07
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(mskcc_pre.linpred.apgi)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.apgi))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in fitter(X, Y, strats, offset, init, control, weights = weights, : Ran out of iterations and did not converge}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in fitter(X, Y, strats, offset, init, control, weights = weights, : NA/NaN/Inf in foreign function call (arg 6)}}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(mskcc_post.linpred.apgi)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.apgi))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in fitter(X, Y, strats, offset, init, control, weights = weights, : Ran out of iterations and did not converge}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in fitter(X, Y, strats, offset, init, control, weights = weights, : NA/NaN/Inf in foreign function call (arg 6)}}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(gg.linpred.apgi)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.apgi))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ offset(gg.linpred.apgi) + AgeCent + 
##     SexM + SizeCent + A2 + A4, data = data.apgi)
## 
##   n= 75, number of events= 51 
## 
##             coef exp(coef) se(coef)    z Pr(>|z|)
## AgeCent  0.02404   1.02433  0.01798 1.34   0.1812
## SexMTRUE 0.99912   2.71590  0.31918 3.13   0.0017
## SizeCent 0.01343   1.01352  0.00828 1.62   0.1050
## A2TRUE   0.22816   1.25628  0.39709 0.57   0.5656
## A4TRUE   0.17023   1.18558  0.33812 0.50   0.6146
## 
##          exp(coef) exp(-coef) lower .95 upper .95
## AgeCent       1.02      0.976     0.989      1.06
## SexMTRUE      2.72      0.368     1.453      5.08
## SizeCent      1.01      0.987     0.997      1.03
## A2TRUE        1.26      0.796     0.577      2.74
## A4TRUE        1.19      0.843     0.611      2.30
## 
## Concordance= 0.684  (se = 0.044 )
## Rsquare= 0.189   (max possible= 0.993 )
## Likelihood ratio test= 15.7  on 5 df,   p=0.00775
## Wald test            = 14.8  on 5 df,   p=0.0113
## Score (logrank) test = 15.6  on 5 df,   p=0.00816
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(mskcc_pre.linpred.dresden)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.dresden))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in fitter(X, Y, strats, offset, init, control, weights = weights, : Ran out of iterations and did not converge}}\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ offset(mskcc_pre.linpred.dresden) + 
##     AgeCent + SexM + SizeCent + A2 + A4, data = data.dresden)
## 
##   n= 150, number of events= 112 
## 
##               coef exp(coef)  se(coef)     z Pr(>|z|)
## AgeCent   1.07e+00  2.90e+00  1.40e+00  0.76    0.446
## SexMTRUE -9.61e+00  6.72e-05  7.27e+00 -1.32    0.186
## SizeCent -7.39e-02  9.29e-01  3.99e-01 -0.19    0.853
## A2TRUE    9.40e-01  2.56e+00  1.18e+01  0.08    0.936
## A4TRUE    2.69e+01  4.83e+11  1.38e+01  1.95    0.052
## 
##          exp(coef) exp(-coef) lower .95 upper .95
## AgeCent   2.90e+00   3.45e-01  1.87e-01  4.51e+01
## SexMTRUE  6.72e-05   1.49e+04  4.38e-11  1.03e+02
## SizeCent  9.29e-01   1.08e+00  4.25e-01  2.03e+00
## A2TRUE    2.56e+00   3.91e-01  2.42e-10  2.71e+10
## A4TRUE    4.83e+11   2.07e-12  8.14e-01  2.86e+23
## 
## Concordance= 0.551  (se = 0.031 )
## Rsquare= 1   (max possible= 1 )
## Likelihood ratio test= 6039  on 5 df,   p=0
## Wald test            = 29003  on 5 df,   p=0
## Score (logrank) test = 38248  on 5 df,   p=0
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(mskcc_post.linpred.dresden)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.dresden))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in fitter(X, Y, strats, offset, init, control, weights = weights, : Ran out of iterations and did not converge}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in fitter(X, Y, strats, offset, init, control, weights = weights, : NA/NaN/Inf in foreign function call (arg 6)}}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(Time, DSD)} \hlopt{~} \hlkwd{offset}\hlstd{(gg.linpred.dresden)} \hlopt{+} \hlstd{AgeCent} \hlopt{+} \hlstd{SexM} \hlopt{+} \hlstd{SizeCent} \hlopt{+} \hlstd{A2} \hlopt{+} \hlstd{A4, data.dresden))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(Time, DSD) ~ offset(gg.linpred.dresden) + 
##     AgeCent + SexM + SizeCent + A2 + A4, data = data.dresden)
## 
##   n= 150, number of events= 112 
## 
##              coef exp(coef) se(coef)     z Pr(>|z|)
## AgeCent   0.01589   1.01601  0.01103  1.44    0.150
## SexMTRUE  0.46624   1.59399  0.19189  2.43    0.015
## SizeCent  0.00808   1.00812  0.00918  0.88    0.378
## A2TRUE   -0.08110   0.92210  0.21938 -0.37    0.712
## A4TRUE    0.08918   1.09328  0.32044  0.28    0.781
## 
##          exp(coef) exp(-coef) lower .95 upper .95
## AgeCent      1.016      0.984     0.994      1.04
## SexMTRUE     1.594      0.627     1.094      2.32
## SizeCent     1.008      0.992     0.990      1.03
## A2TRUE       0.922      1.084     0.600      1.42
## A4TRUE       1.093      0.915     0.583      2.05
## 
## Concordance= 0.595  (se = 0.031 )
## Rsquare= 0.053   (max possible= 0.998 )
## Likelihood ratio test= 8.1  on 5 df,   p=0.151
## Wald test            = 8  on 5 df,   p=0.156
## Score (logrank) test = 8.1  on 5 df,   p=0.151
\end{verbatim}
\end{kframe}
\end{knitrout}
Still strong evidence of misspecification or poor fit.  However, the above calibration slope was not significantly different from 1.  Hmm.  This doesn't necessarily sink the method, but will need checking as we go along.

\subsection{Altman method 3 (D)}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(Hmisc)}
\hlkwd{rcorr.cens}\hlstd{(gg.linpred.glasgow,} \hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##        C Index            Dxy           S.D.              n        missing 
##      3.928e-01     -2.145e-01      4.883e-02      1.890e+02      0.000e+00 
##     uncensored Relevant Pairs     Concordant      Uncertain 
##      1.610e+02      2.891e+04      1.135e+04      6.608e+03
\end{verbatim}
\begin{alltt}
\hlkwd{rcorr.cens}\hlstd{(mskcc_pre.linpred.glasgow,} \hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##        C Index            Dxy           S.D.              n        missing 
##         0.4150        -0.1699         0.0514       189.0000         0.0000 
##     uncensored Relevant Pairs     Concordant      Uncertain 
##       161.0000     28906.0000     11997.0000      6608.0000
\end{verbatim}
\begin{alltt}
\hlkwd{rcorrp.cens}\hlstd{(gg.linpred.glasgow, mskcc_pre.linpred.glasgow,} \hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##                Dxy               S.D. x1 more concordant 
##          1.272e-01          5.245e-02          5.636e-01 
## x2 more concordant                  n            missing 
##          4.364e-01          1.890e+02          0.000e+00 
##         uncensored     Relevant Pairs          Uncertain 
##          1.610e+02          2.891e+04          6.608e+03 
##               C X1               C X2             Dxy X1 
##          3.928e-01          4.150e-01         -2.145e-01 
##             Dxy X2 
##         -1.699e-01
\end{verbatim}
\begin{alltt}
\hlkwd{rcorr.cens}\hlstd{(gg.linpred.apgi,} \hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##        C Index            Dxy           S.D.              n        missing 
##        0.42092       -0.15815        0.08359       75.00000        0.00000 
##     uncensored Relevant Pairs     Concordant      Uncertain 
##       51.00000     4464.00000     1879.00000     1086.00000
\end{verbatim}
\begin{alltt}
\hlkwd{rcorr.cens}\hlstd{(mskcc_pre.linpred.apgi,} \hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##        C Index            Dxy           S.D.              n        missing 
##      5.251e-01      5.018e-02      8.872e-02      7.500e+01      0.000e+00 
##     uncensored Relevant Pairs     Concordant      Uncertain 
##      5.100e+01      4.464e+03      2.344e+03      1.086e+03
\end{verbatim}
\begin{alltt}
\hlkwd{rcorrp.cens}\hlstd{(gg.linpred.apgi, mskcc_pre.linpred.apgi,} \hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##                Dxy               S.D. x1 more concordant 
##           -0.06855            0.08827            0.46550 
## x2 more concordant                  n            missing 
##            0.53405           75.00000            0.00000 
##         uncensored     Relevant Pairs          Uncertain 
##           51.00000         4464.00000         1086.00000 
##               C X1               C X2             Dxy X1 
##            0.42092            0.52509           -0.15815 
##             Dxy X2 
##            0.05018
\end{verbatim}
\begin{alltt}
\hlkwd{rcorr.cens}\hlstd{(gg.linpred.dresden,} \hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##        C Index            Dxy           S.D.              n        missing 
##      4.553e-01     -8.942e-02      5.994e-02      1.500e+02      0.000e+00 
##     uncensored Relevant Pairs     Concordant      Uncertain 
##      1.120e+02      1.745e+04      7.943e+03      4.890e+03
\end{verbatim}
\begin{alltt}
\hlkwd{rcorr.cens}\hlstd{(mskcc_pre.linpred.dresden,} \hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##        C Index            Dxy           S.D.              n        missing 
##      4.823e-01     -3.542e-02      5.516e-02      1.500e+02      0.000e+00 
##     uncensored Relevant Pairs     Concordant      Uncertain 
##      1.120e+02      1.745e+04      8.414e+03      4.890e+03
\end{verbatim}
\begin{alltt}
\hlkwd{rcorrp.cens}\hlstd{(gg.linpred.dresden, mskcc_pre.linpred.dresden,} \hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD))}
\end{alltt}
\begin{verbatim}
##                Dxy               S.D. x1 more concordant 
##          1.765e-02          5.548e-02          5.087e-01 
## x2 more concordant                  n            missing 
##          4.910e-01          1.500e+02          0.000e+00 
##         uncensored     Relevant Pairs          Uncertain 
##          1.120e+02          1.745e+04          4.890e+03 
##               C X1               C X2             Dxy X1 
##          4.553e-01          4.823e-01         -8.942e-02 
##             Dxy X2 
##         -3.542e-02
\end{verbatim}
\begin{alltt}
\hlkwd{library}\hlstd{(survcomp)}
\hlkwd{concordance.index}\hlstd{(gg.linpred.glasgow, data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $c.index
## [1] 0.6086
## 
## $se
## [1] 0.02411
## 
## $lower
## [1] 0.5613
## 
## $upper
## [1] 0.6558
## 
## $p.value
## [1] 6.667e-06
## 
## $n
## [1] 189
## 
## $data
## $data$x
##   [1]  0.80162  0.34886  0.09981  0.01110 -0.04435  0.18851 -0.28454
##   [8] -0.03326  0.62420 -0.04435  0.38434  0.51708  0.93468  0.04435
##  [15] -0.41760  0.38434 -0.28454  0.27789  0.42870  0.56144  0.33967
##  [22] -0.04435  0.14416  0.04435  0.54402  0.25096  0.65046  0.14416
##  [29] -0.13306  0.05545  0.01110 -0.08871 -0.03326 -0.09535 -0.15147
##  [36] -0.28454  0.29563  0.42838  0.51708  0.25096  0.09981 -0.28454
##  [43] -0.24018  0.56176  0.80162 -0.32002  0.71291  0.33967  0.01110
##  [50]  0.18851 -0.11532 -0.41760  0.47305  0.13306  0.70404  0.47273
##  [57] -0.37324  0.71291  0.80162  0.04435  0.28676  0.56144  1.06774
##  [64] -0.13306  0.71291  0.84597  0.71291  0.38434  0.18851  0.38434
##  [71]  0.29563 -0.05987  0.47273  0.00000  0.32157 -0.28454  0.36660
##  [78]  0.19516  0.42838  0.42838  0.42870  0.02884 -0.02439  0.60611
##  [85] -0.41760  0.71291  0.03771 -0.42647  0.56176 -0.37324  0.32857
##  [92]  0.73952  0.42838  0.04435 -0.03326  0.01110  0.65014 -0.37324
##  [99]  0.51740  0.38434  0.51740  0.00000 -0.03548  0.04435 -0.01774
## [106] -0.04435  0.42838  0.47305  0.71291 -0.46195  0.26870 -0.07761
## [113]  0.38402 -0.41760  0.75726  0.01110 -0.42647 -0.03326  0.71291
## [120]  0.47273 -0.20470  0.47273  0.47305  0.00000  0.65969 -0.03326
## [127]  0.33999 -0.12196 -0.13306  0.38402  0.31306 -0.42647  0.29563
## [134]  0.27789 -0.05987  0.66856  0.54370  0.51708  0.01110  0.55034
## [141]  0.38402  0.36660 -0.12196  0.80162 -0.19583  0.33112 -0.03326
## [148]  0.89033  0.80162  0.14416 -0.04435  0.01110 -0.12196  0.84597
## [155]  0.35518  0.33999  0.22145  0.62420 -0.37324  0.60579 -0.32889
## [162]  0.18851  0.14416  0.75726 -0.37324 -0.21067  0.60579  0.29563
## [169]  0.27722  0.33967  0.78388  0.42838  0.84597 -0.08871  0.52595
## [176] -0.31115  0.38434  0.05545  0.33999  0.66856  0.05545  0.18851
## [183] -0.32889 -0.28454 -0.07761 -0.04435  0.33999  0.38434  0.01997
## 
## $data$surv.time
##   [1]  233.456  266.937   40.482  216.106 2611.537  410.906  473.912
##   [8]  610.881 1380.949 1443.651  959.694  147.013   10.044  915.256
##  [15]  161.319 2884.562  136.056 3530.750  450.475  143.969   17.349
##  [22] 1104.881  267.850  655.319   38.656  283.069 1018.743  812.681
##  [29] 1452.782 1420.518 1342.294  900.950  308.332  336.943 1116.143
##  [36] 1016.613  423.994  741.762 1921.519  597.488    8.218   25.263
##  [43]  803.550  350.031  394.774  299.201  148.231 1094.837   25.263
##  [50]  312.593  436.169  751.806  492.174   11.262  416.994  809.637
##  [57]  806.594  142.143  621.838  316.550 2749.419  136.056   49.613
##  [64]  379.556  210.932  256.588  253.544  705.237 1254.938  510.437
##  [71]  890.906  116.576  178.668  519.568   14.306  702.193  148.231
##  [78]  560.050  113.532    9.131  152.188 1102.751  375.294  343.944
##  [85]  353.075 2830.688  185.669 1310.943 1491.438  576.182  663.538
##  [92]  408.776  548.788  781.331  467.824  636.144   76.094  468.738
##  [99]    9.131  501.306  248.674  837.944 2221.938 2556.750 2587.188
## [106]  286.113  542.701  534.787  396.601  856.207  139.099   29.524
## [113]  629.143 1205.325  868.382  395.688 1046.137   43.526  862.294
## [120]  235.282  177.451  118.706  553.049  903.081  563.094  404.819
## [127]  565.224  203.018  190.843  398.731  413.037  786.201  497.044
## [134]  942.649  883.601  257.806  344.857  191.756   45.656  730.500
## [141]  103.487 1004.438 1461.000  974.000  118.706 1156.625  703.106
## [148]  233.151  581.356 1552.312 1156.625 1795.812 2343.688  175.624
## [155] 1649.712 1978.438  487.000  602.663 1552.312   24.350  608.750
## [162]  319.594   76.094  730.500 1217.500 1461.000   91.312   30.438
## [169]  182.625  517.438  213.062  760.938  243.500  943.562  152.188
## [176] 1126.188  760.938 1068.356 1129.231  243.500  273.938  362.206
## [183] 1007.481  669.625 1187.062  273.938  608.750 1065.312  426.125
## 
## $data$surv.event
##   [1]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [12]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE
##  [23]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [34]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE
##  [45]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE  TRUE FALSE  TRUE
##  [56]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [67]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [78]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [89]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE
## [100]  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [111]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE
## [122]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [133]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE
## [144]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [155] FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE FALSE
## [166] FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [177]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE
## [188] FALSE  TRUE
## 
## 
## $comppairs
## [1] 28512
\end{verbatim}
\begin{alltt}
\hlkwd{concordance.index}\hlstd{(mskcc_pre.linpred.glasgow, data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $c.index
## [1] 0.5851
## 
## $se
## [1] 0.0251
## 
## $lower
## [1] 0.5359
## 
## $upper
## [1] 0.6343
## 
## $p.value
## [1] 0.0006962
## 
## $n
## [1] 189
## 
## $data
## $data$x
##   [1] 158.0 160.9 161.6 161.9 158.5 162.1 164.5 164.5 161.4 146.8 159.6
##  [12] 161.4 161.0 149.4 164.7 158.2 161.7 159.0 157.7 162.4 160.8 158.5
##  [23] 162.6 159.0 159.1 164.5 146.2 160.7 152.3 160.5 149.3 158.7 161.3
##  [34] 187.6 162.4 163.1 158.1 151.0 161.3 165.4 160.2 150.4 162.0 161.1
##  [45] 159.0 162.9 159.4 161.3 161.6 162.4 158.6 162.4 161.2 159.1 160.5
##  [56] 160.6 162.1 158.5 160.9 160.4 147.4 162.1 159.1 165.0 159.7 158.4
##  [67] 160.3 158.1 162.0 158.0 161.2 162.6 163.6 161.4 161.5 163.2 158.5
##  [78] 149.9 160.7 161.3 161.0 154.0 161.3 162.4 162.8 158.5 161.3 160.7
##  [89] 157.5 161.7 158.7 162.1 161.1 157.4 162.2 161.5 161.0 162.8 159.9
## [100] 159.7 160.1 158.2 157.7 158.3 159.5 161.6 161.3 158.5 159.7 162.0
## [111] 162.4 162.8 162.8 161.0 159.6 162.7 161.5 161.0 148.1 161.8 161.3
## [122] 165.6 159.7 158.8 159.2 160.8 161.3 164.6 165.1 163.6 161.8 162.2
## [133] 159.5 161.3 163.0 161.4 161.9 160.9 160.4 159.4 161.7 159.6 166.0
## [144] 157.8 161.9 159.4 163.0 159.8 160.1 160.2 161.3 161.1 166.1 158.7
## [155] 160.3 149.3 162.2 163.8 164.3 162.6 161.9 159.1 163.9 147.1 161.5
## [166] 201.9 162.7 157.7 161.5 161.4 158.7 162.9 158.0 162.0 163.3 163.5
## [177] 158.1 164.6 158.5 159.6 161.7 164.7 162.1 162.3 162.6 160.0 158.7
## [188] 158.5 160.7
## 
## $data$surv.time
##   [1]  233.456  266.937   40.482  216.106 2611.537  410.906  473.912
##   [8]  610.881 1380.949 1443.651  959.694  147.013   10.044  915.256
##  [15]  161.319 2884.562  136.056 3530.750  450.475  143.969   17.349
##  [22] 1104.881  267.850  655.319   38.656  283.069 1018.743  812.681
##  [29] 1452.782 1420.518 1342.294  900.950  308.332  336.943 1116.143
##  [36] 1016.613  423.994  741.762 1921.519  597.488    8.218   25.263
##  [43]  803.550  350.031  394.774  299.201  148.231 1094.837   25.263
##  [50]  312.593  436.169  751.806  492.174   11.262  416.994  809.637
##  [57]  806.594  142.143  621.838  316.550 2749.419  136.056   49.613
##  [64]  379.556  210.932  256.588  253.544  705.237 1254.938  510.437
##  [71]  890.906  116.576  178.668  519.568   14.306  702.193  148.231
##  [78]  560.050  113.532    9.131  152.188 1102.751  375.294  343.944
##  [85]  353.075 2830.688  185.669 1310.943 1491.438  576.182  663.538
##  [92]  408.776  548.788  781.331  467.824  636.144   76.094  468.738
##  [99]    9.131  501.306  248.674  837.944 2221.938 2556.750 2587.188
## [106]  286.113  542.701  534.787  396.601  856.207  139.099   29.524
## [113]  629.143 1205.325  868.382  395.688 1046.137   43.526  862.294
## [120]  235.282  177.451  118.706  553.049  903.081  563.094  404.819
## [127]  565.224  203.018  190.843  398.731  413.037  786.201  497.044
## [134]  942.649  883.601  257.806  344.857  191.756   45.656  730.500
## [141]  103.487 1004.438 1461.000  974.000  118.706 1156.625  703.106
## [148]  233.151  581.356 1552.312 1156.625 1795.812 2343.688  175.624
## [155] 1649.712 1978.438  487.000  602.663 1552.312   24.350  608.750
## [162]  319.594   76.094  730.500 1217.500 1461.000   91.312   30.438
## [169]  182.625  517.438  213.062  760.938  243.500  943.562  152.188
## [176] 1126.188  760.938 1068.356 1129.231  243.500  273.938  362.206
## [183] 1007.481  669.625 1187.062  273.938  608.750 1065.312  426.125
## 
## $data$surv.event
##   [1]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [12]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE
##  [23]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [34]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE
##  [45]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE  TRUE FALSE  TRUE
##  [56]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [67]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [78]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [89]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE
## [100]  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [111]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE
## [122]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [133]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE
## [144]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [155] FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE FALSE
## [166] FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [177]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE
## [188] FALSE  TRUE
## 
## 
## $comppairs
## [1] 28884
\end{verbatim}
\begin{alltt}
\hlkwd{concordance.index}\hlstd{(gg.linpred.apgi, data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $c.index
## [1] 0.5798
## 
## $se
## [1] 0.03978
## 
## $lower
## [1] 0.5019
## 
## $upper
## [1] 0.6578
## 
## $p.value
## [1] 0.04476
## 
## $n
## [1] 75
## 
## $data
## $data$x
##  [1]  0.188513  0.384341  0.428695  0.081914  0.115320  0.046581  0.505986
##  [8]  0.757265  0.543345  0.073193  0.384341  0.314781  0.775007  0.295633
## [15]  0.055451 -0.195828  0.099805  0.384341  0.314781  0.295633  0.757265
## [22]  0.046581  0.106449  0.357729 -0.382114  0.159674  0.608188  0.046581
## [29]  0.011098  0.437246  0.011098  0.099805  0.643351 -0.006644  0.133062
## [36] -0.122785 -0.044354 -0.444210 -0.390985 -0.104223  0.177416  0.046581
## [43]  0.126418  0.561437  0.144159  0.295633  0.099805  0.517403 -0.461951
## [50] -0.077610  0.739172 -0.044354  0.232867  0.569807  0.758320 -0.461951
## [57]  0.428695  0.339987 -0.328890  0.000000 -0.033256 -0.328890  0.492197
## [64]  0.845973  0.801619  0.517403  0.170772 -0.088708 -0.070966 -0.113914
## [71] -0.382114  0.339317  0.676608  0.366280 -0.044354
## 
## $data$surv.time
##  [1]  525 2848 1779 1279   37  436 1048  476  135  315  452  346  858  549
## [15] 1235  715  949  269  410  516  359  750 1081  835  768  989   71 1574
## [29]  209  313  312 1504  553  718 1588  237 1268  518 1533 1430  610 1461
## [43]  106  325  142 1171  365  281 1278  611  976 1407  427 1094  655  913
## [57]  796  480  162 1176  852  521  482  695  412 1030  305  869  892  241
## [71]  911  120  950  545  709
## 
## $data$surv.event
##  [1] 1 1 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 1 1 0 1 1 0
## [36] 1 0 1 0 0 1 0 0 1 1 0 1 1 0 0 1 0 1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 0 0 1
## [71] 0 1 0 1 1
## 
## 
## $comppairs
## [1] 4422
\end{verbatim}
\begin{alltt}
\hlkwd{concordance.index}\hlstd{(mskcc_pre.linpred.apgi, data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $c.index
## [1] 0.4745
## 
## $se
## [1] 0.04286
## 
## $lower
## [1] 0.3904
## 
## $upper
## [1] 0.5585
## 
## $p.value
## [1] 0.5511
## 
## $n
## [1] 75
## 
## $data
## $data$x
##  [1] 159.7 157.3 159.9 240.6 157.7 160.3 159.6 157.5 156.8 158.9 145.4
## [12] 210.1 157.1 159.2 160.0 159.6 161.1 158.4 210.1 160.3 157.1 158.5
## [23] 159.5 158.8 160.8 158.5 208.2 148.1 160.0 158.7 157.3 157.7 209.5
## [34] 160.7 158.0 209.0 158.9 156.5 157.2 157.5 157.9 158.1 157.2 159.3
## [45] 157.2 159.5 159.1 159.7 158.5 161.3 149.1 158.3 158.8 208.2 210.6
## [56] 158.3 158.3 158.9 157.1 159.3 159.1 160.3 209.1 157.5 156.5 159.3
## [67] 158.8 160.7 160.7 209.0 159.3 158.7 209.0 157.3 158.0
## 
## $data$surv.time
##  [1]  525 2848 1779 1279   37  436 1048  476  135  315  452  346  858  549
## [15] 1235  715  949  269  410  516  359  750 1081  835  768  989   71 1574
## [29]  209  313  312 1504  553  718 1588  237 1268  518 1533 1430  610 1461
## [43]  106  325  142 1171  365  281 1278  611  976 1407  427 1094  655  913
## [57]  796  480  162 1176  852  521  482  695  412 1030  305  869  892  241
## [71]  911  120  950  545  709
## 
## $data$surv.event
##  [1] 1 1 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 1 1 0 1 1 0
## [36] 1 0 1 0 0 1 0 0 1 1 0 1 1 0 0 1 0 1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 0 0 1
## [71] 0 1 0 1 1
## 
## 
## $comppairs
## [1] 4384
\end{verbatim}
\begin{alltt}
\hlkwd{concordance.index}\hlstd{(gg.linpred.dresden, data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $c.index
## [1] 0.5457
## 
## $se
## [1] 0.0297
## 
## $lower
## [1] 0.4874
## 
## $upper
## [1] 0.6039
## 
## $p.value
## [1] 0.1243
## 
## $n
## [1] 150
## 
## $data
## $data$x
##   [1] -0.088708  0.099805 -0.461951  0.517083  0.473049  0.428695  0.499342
##   [8]  0.011098 -0.328890  0.845973  0.295633  0.295314  0.384341  0.099805
##  [15]  0.011098  0.580905  0.295633  0.286763  0.339987 -0.033256  0.705447
##  [22]  0.000000  0.561437 -0.417598  0.303364  0.384341  0.428695 -0.033256
##  [29]  0.525134  0.144159 -0.033256  0.845973  0.490791  0.339987  0.384341
##  [36]  0.472729  0.845973 -0.133062 -0.088708  0.055451  0.055451  0.554963
##  [43]  0.677428  0.428695  0.099805 -0.077610 -0.077610 -0.050998  0.801619
##  [50] -0.033256  0.517403  0.863714  0.250960  0.321575  0.055451  0.384341
##  [57]  0.428375  0.845973  0.668557 -0.059869  0.082064  0.055451  0.384341
##  [64]  0.650816  0.144159  0.188513  0.314781  0.517403  0.144159  0.011098
##  [71]  0.428695  0.384021  0.845973 -0.121964  0.011098  0.561757  0.295633
##  [78] -0.033256  0.019968  1.087210 -0.006644  0.339667  0.819360  0.561437
##  [85]  0.055451  0.295314  0.517403  0.384341  0.401763  0.428375  0.428695
##  [92] -0.033256  1.105303  0.934681  0.490471  0.055451  0.339987  0.419504
##  [99]  0.073193 -0.033256  0.339987  0.357729 -0.346631 -0.033256  0.472729
## [106]  0.002227 -0.097579  0.011098 -0.328890  0.402083  0.195157 -0.033256
## [113]  0.499661  0.473049  0.428375  0.473049  0.446437  0.099805  0.561437
## [120] -0.006644  0.776733  0.000000  0.339987  0.473049  0.794474  0.159674
## [127] -0.006644  0.011098  0.055451  0.775007 -0.006644  0.473049  0.339987
## [134]  0.437566  0.392892  0.011098  0.384341  0.019968 -0.077610  0.055451
## [141]  0.650145  0.313375  0.561757  0.011098 -0.035483  0.295314 -0.035483
## [148]  0.099805  0.473049  0.019148
## 
## $data$surv.time
##   [1]  475  319  478  292  266 4190  511 1211 1379  844  737  338  583 1379
##  [15] 3691  496  360 1173  379  391  522 1486   27  891  356  123 2906  500
##  [29] 1450  747  357   10 2017 1256 1517  152 1061  317  698  435  987  975
##  [43]  604  859  427 1632 4059  521  526  471  309  305  559  110  844  389
##  [57]  349 1098 2353  169  420 1292  648 1022  219  392  540  717  319 1461
##  [71]  643  293  283   55  781  322  605  981 1920  375  704  886  735   13
##  [85] 1823  178  802 1096  453   69  288  707  522  254  727  153  652 1177
##  [99]  348  445  442  239  218  419  392  524  154  614 1727 1422  478  516
## [113]  184  330  303  502 1383  491  100 1101  138   17  538  278  761 1497
## [127]   49  698  641   71 1109  597 1204  304 1030  873  467  188   18  338
## [141]  279  308  448  268  923 1087  376 1084  252  745
## 
## $data$surv.event
##   [1]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [12]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [23] FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE FALSE  TRUE FALSE  TRUE
##  [34] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE
##  [45]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [56]  TRUE FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [67]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [78] FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE
##  [89]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE
## [100]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE
## [111] FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
## [122] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE
## [133] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE
## [144]  TRUE  TRUE FALSE FALSE  TRUE  TRUE FALSE
## 
## 
## $comppairs
## [1] 17106
\end{verbatim}
\begin{alltt}
\hlkwd{concordance.index}\hlstd{(mskcc_pre.linpred.dresden, data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## $c.index
## [1] 0.518
## 
## $se
## [1] 0.02694
## 
## $lower
## [1] 0.4652
## 
## $upper
## [1] 0.5708
## 
## $p.value
## [1] 0.5043
## 
## $n
## [1] 150
## 
## $data
## $data$x
##   [1] 147.5 152.0 150.8 188.4 148.2 147.3 153.6 154.3 150.3 148.5 146.6
##  [12] 150.5 147.9 149.7 151.7 203.0 146.7 147.9 146.3 149.1 201.5 147.8
##  [23] 149.6 153.5 202.2 150.9 148.7 150.9 239.0 153.5 150.4 147.9 149.0
##  [34] 146.5 149.3 149.5 146.9 188.0 148.9 152.9 149.3 198.5 147.5 147.7
##  [45] 152.3 150.7 152.1 187.5 147.9 150.3 148.2 147.7 154.9 150.1 150.1
##  [56] 147.9 150.3 149.3 149.3 151.1 150.7 150.7 149.4 148.9 149.3 152.8
##  [67] 201.7 151.1 150.1 151.9 148.1 152.4 147.5 153.3 152.9 147.4 147.5
##  [78] 150.3 150.3 199.9 153.3 185.3 146.9 150.9 151.5 151.5 146.7 147.1
##  [89] 150.5 150.0 147.0 149.1 200.7 182.9 151.2 150.3 146.7 150.3 151.7
## [100] 151.7 146.2 146.3 151.3 150.0 149.7 150.3 146.5 150.4 150.9 147.3
## [111] 182.7 153.1 148.9 147.5 150.1 146.3 146.7 150.3 149.7 149.2 197.6
## [122] 148.2 149.9 146.7 201.2 147.4 148.4 149.5 150.5 145.9 154.3 146.7
## [133] 147.5 146.7 151.2 149.5 147.3 149.9 149.2 150.8 152.1 146.9 147.3
## [144] 149.7 146.3 151.3 147.3 152.4 185.3 237.7
## 
## $data$surv.time
##   [1]  475  319  478  292  266 4190  511 1211 1379  844  737  338  583 1379
##  [15] 3691  496  360 1173  379  391  522 1486   27  891  356  123 2906  500
##  [29] 1450  747  357   10 2017 1256 1517  152 1061  317  698  435  987  975
##  [43]  604  859  427 1632 4059  521  526  471  309  305  559  110  844  389
##  [57]  349 1098 2353  169  420 1292  648 1022  219  392  540  717  319 1461
##  [71]  643  293  283   55  781  322  605  981 1920  375  704  886  735   13
##  [85] 1823  178  802 1096  453   69  288  707  522  254  727  153  652 1177
##  [99]  348  445  442  239  218  419  392  524  154  614 1727 1422  478  516
## [113]  184  330  303  502 1383  491  100 1101  138   17  538  278  761 1497
## [127]   49  698  641   71 1109  597 1204  304 1030  873  467  188   18  338
## [141]  279  308  448  268  923 1087  376 1084  252  745
## 
## $data$surv.event
##   [1]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [12]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [23] FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE FALSE  TRUE FALSE  TRUE
##  [34] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE
##  [45]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [56]  TRUE FALSE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [67]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [78] FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE
##  [89]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE FALSE  TRUE
## [100]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE
## [111] FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
## [122] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE
## [133] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE
## [144]  TRUE  TRUE FALSE FALSE  TRUE  TRUE FALSE
## 
## 
## $comppairs
## [1] 17236
\end{verbatim}
\begin{alltt}
\hlkwd{cindex.comp}\hlstd{(}\hlkwd{concordance.index}\hlstd{(gg.linpred.glasgow, data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{),} \hlkwd{concordance.index}\hlstd{(mskcc_pre.linpred.glasgow, data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{))}
\end{alltt}
\begin{verbatim}
## $p.value
## [1] 0.283
## 
## $cindex1
## [1] 0.6086
## 
## $cindex2
## [1] 0.5851
\end{verbatim}
\begin{alltt}
\hlkwd{cindex.comp}\hlstd{(}\hlkwd{concordance.index}\hlstd{(gg.linpred.apgi, data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{),} \hlkwd{concordance.index}\hlstd{(mskcc_pre.linpred.apgi, data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{))}
\end{alltt}
\begin{verbatim}
## $p.value
## [1] 0.04175
## 
## $cindex1
## [1] 0.5798
## 
## $cindex2
## [1] 0.4745
\end{verbatim}
\begin{alltt}
\hlkwd{cindex.comp}\hlstd{(}\hlkwd{concordance.index}\hlstd{(gg.linpred.dresden, data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{),} \hlkwd{concordance.index}\hlstd{(mskcc_pre.linpred.dresden, data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{method} \hlstd{=} \hlstr{"noether"}\hlstd{))}
\end{alltt}
\begin{verbatim}
## $p.value
## [1] 0.2626
## 
## $cindex1
## [1] 0.5457
## 
## $cindex2
## [1] 0.518
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Altman method 4 (D,C)}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{group_quantiles} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{0.2}\hlstd{,} \hlnum{0.8}\hlstd{,} \hlnum{1}\hlstd{)}
\hlstd{gg.groups.nswpcn} \hlkwb{=} \hlkwd{cut}\hlstd{(gg.linpred.nswpcn,} \hlkwd{quantile}\hlstd{(gg.linpred.nswpcn, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.alpha} \hlkwb{=} \hlnum{0.1}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp.km} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(data.nswpcn}\hlopt{$}\hlstd{Time, data.nswpcn}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlstd{gg.groups.nswpcn,} \hlkwc{conf.int} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{temp.alpha)}
\hlstd{temp.km} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{= temp.km}\hlopt{$}\hlstd{surv,} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{".*="}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.km}\hlopt{$}\hlstd{strata)), temp.km}\hlopt{$}\hlstd{strata),} \hlkwc{time} \hlstd{= temp.km}\hlopt{$}\hlstd{time,} \hlkwc{upper} \hlstd{= temp.km}\hlopt{$}\hlstd{upper,} \hlkwc{lower} \hlstd{= temp.km}\hlopt{$}\hlstd{lower,} \hlkwc{est} \hlstd{=} \hlstr{"NSWPCN Observed"}\hlstd{)}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.nswpcn,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.pred.times} \hlkwb{=} \hlstd{temp.pred[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{]}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(temp.pred.ests), gg.groups.nswpcn,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{)} \hlkwd{apply}\hlstd{(temp.pred.ests[,is],} \hlnum{1}\hlstd{, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.pred.lower} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{1}\hlstd{,])}
\hlstd{temp.pred.meds} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{2}\hlstd{,])}
\hlstd{temp.pred.upper} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{3}\hlstd{,])}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.meds),} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{colnames}\hlstd{(temp.pred.meds),} \hlkwc{each} \hlstd{=} \hlkwd{nrow}\hlstd{(temp.pred.meds)),} \hlkwc{time} \hlstd{= temp.pred.times,} \hlkwc{upper} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.upper),} \hlkwc{lower} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.lower),} \hlkwc{est} \hlstd{=} \hlstr{"GG1 Prediction"}\hlstd{)}
\hlstd{temp.data} \hlkwb{=} \hlkwd{rbind}\hlstd{(temp.km, temp.pred)}
\hlstd{temp.data}\hlopt{$}\hlstd{time} \hlkwb{=} \hlstd{temp.data}\hlopt{$}\hlstd{time} \hlopt{/} \hlnum{365.25} \hlopt{*} \hlnum{12}

\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.nswpcn)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.nswpcn))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.nswpcn))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"NSWPCN Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"NSWPCN Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,} \hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{1.2}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-nswpcn-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.nswpcn}\hlopt{$}\hlstd{Time, data.nswpcn}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(gg.groups.nswpcn)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.nswpcn$Time, data.nswpcn$DSD) ~ factor(gg.groups.nswpcn))
## 
##   n= 239, number of events= 230 
##    (1 observation deleted due to missingness)
## 
##                            coef exp(coef) se(coef)    z Pr(>|z|)
## factor(gg.groups.nswpcn)2 0.532     1.703    0.176 3.03   0.0025
## factor(gg.groups.nswpcn)3 1.328     3.775    0.219 6.06  1.3e-09
## 
##                           exp(coef) exp(-coef) lower .95 upper .95
## factor(gg.groups.nswpcn)2      1.70      0.587      1.21       2.4
## factor(gg.groups.nswpcn)3      3.78      0.265      2.46       5.8
## 
## Concordance= 0.618  (se = 0.019 )
## Rsquare= 0.138   (max possible= 1 )
## Likelihood ratio test= 35.5  on 2 df,   p=1.96e-08
## Wald test            = 37.9  on 2 df,   p=6.01e-09
## Score (logrank) test = 40.7  on 2 df,   p=1.46e-09
\end{verbatim}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_pre.groups.glasgow} \hlkwb{=} \hlkwd{cut}\hlstd{(mskcc_pre.linpred.glasgow,} \hlkwd{quantile}\hlstd{(mskcc_pre.linpred.glasgow, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{mskcc_post.groups.glasgow} \hlkwb{=} \hlkwd{cut}\hlstd{(mskcc_post.linpred.glasgow,} \hlkwd{quantile}\hlstd{(mskcc_post.linpred.glasgow, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.groups.glasgow} \hlkwb{=} \hlkwd{cut}\hlstd{(gg.linpred.glasgow,} \hlkwd{quantile}\hlstd{(gg.linpred.glasgow, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}

\hlstd{temp.km} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlstd{gg.groups.glasgow,} \hlkwc{conf.int} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{temp.alpha)}
\hlstd{temp.km} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{= temp.km}\hlopt{$}\hlstd{surv,} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{".*="}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.km}\hlopt{$}\hlstd{strata)), temp.km}\hlopt{$}\hlstd{strata),} \hlkwc{time} \hlstd{= temp.km}\hlopt{$}\hlstd{time,} \hlkwc{upper} \hlstd{= temp.km}\hlopt{$}\hlstd{upper,} \hlkwc{lower} \hlstd{= temp.km}\hlopt{$}\hlstd{lower,} \hlkwc{est} \hlstd{=} \hlstr{"Glasgow Observed"}\hlstd{)}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.glasgow,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.pred.times} \hlkwb{=} \hlstd{temp.pred[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{]}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(temp.pred.ests), gg.groups.glasgow,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{)} \hlkwd{apply}\hlstd{(temp.pred.ests[,is],} \hlnum{1}\hlstd{, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.pred.lower} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{1}\hlstd{,])}
\hlstd{temp.pred.meds} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{2}\hlstd{,])}
\hlstd{temp.pred.upper} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{3}\hlstd{,])}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.meds),} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{colnames}\hlstd{(temp.pred.meds),} \hlkwc{each} \hlstd{=} \hlkwd{nrow}\hlstd{(temp.pred.meds)),} \hlkwc{time} \hlstd{= temp.pred.times,} \hlkwc{upper} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.upper),} \hlkwc{lower} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.lower),} \hlkwc{est} \hlstd{=} \hlstr{"GG1 Prediction"}\hlstd{)}
\hlstd{temp.data} \hlkwb{=} \hlkwd{rbind}\hlstd{(temp.km, temp.pred)}
\hlstd{temp.data}\hlopt{$}\hlstd{time} \hlkwb{=} \hlstd{temp.data}\hlopt{$}\hlstd{time} \hlopt{/} \hlnum{365.25} \hlopt{*} \hlnum{12}
\hlstd{temp.predpre.12mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.12mo.glasgow, mskcc_pre.groups.glasgow, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpre.24mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.24mo.glasgow, mskcc_pre.groups.glasgow, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpre.36mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.36mo.glasgow, mskcc_pre.groups.glasgow, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.12mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.12mo.glasgow, mskcc_post.groups.glasgow, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.24mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.24mo.glasgow, mskcc_post.groups.glasgow, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.36mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.36mo.glasgow, mskcc_post.groups.glasgow, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.data2} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}
        \hlkwc{surv} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{2}\hlstd{,], temp.predpre.24mo[}\hlnum{2}\hlstd{,], temp.predpre.36mo[}\hlnum{2}\hlstd{,], temp.predpost.12mo[}\hlnum{2}\hlstd{,], temp.predpost.24mo[}\hlnum{2}\hlstd{,], temp.predpost.36mo[}\hlnum{2}\hlstd{,]),}
        \hlkwc{group} \hlstd{=} \hlkwd{factor}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(mskcc_pre.groups.glasgow)),} \hlnum{6}\hlstd{)),}
        \hlkwc{time} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{),} \hlkwc{each} \hlstd{=} \hlnum{3}\hlstd{),}
        \hlkwc{upper} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{3}\hlstd{,], temp.predpre.24mo[}\hlnum{3}\hlstd{,], temp.predpre.36mo[}\hlnum{3}\hlstd{,], temp.predpost.12mo[}\hlnum{3}\hlstd{,], temp.predpost.24mo[}\hlnum{3}\hlstd{,], temp.predpost.36mo[}\hlnum{3}\hlstd{,]),}
        \hlkwc{lower} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{1}\hlstd{,], temp.predpre.24mo[}\hlnum{1}\hlstd{,], temp.predpre.36mo[}\hlnum{1}\hlstd{,], temp.predpost.12mo[}\hlnum{1}\hlstd{,], temp.predpost.24mo[}\hlnum{1}\hlstd{,], temp.predpost.36mo[}\hlnum{1}\hlstd{,]),}
        \hlkwc{est} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{"MSKCC Preoperative"}\hlstd{,} \hlstr{"MSKCC Postoperative"}\hlstd{),} \hlkwc{each} \hlstd{=} \hlnum{9}\hlstd{))}

\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.glasgow)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.glasgow))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.glasgow))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"Glasgow Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{points}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data2[}\hlkwd{as.character}\hlstd{(temp.data2}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data2}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"MSKCC Preoperative"}\hlstd{,],} \hlkwc{pch} \hlstd{=} \hlnum{21}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{cex} \hlstd{=} \hlnum{1.5}\hlstd{)}
        \hlkwd{points}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data2[}\hlkwd{as.character}\hlstd{(temp.data2}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data2}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"MSKCC Postoperative"}\hlstd{,],} \hlkwc{pch} \hlstd{=} \hlnum{19}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{cex} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"MSKCC Preoperative Prediction"}\hlstd{,} \hlstr{"MSKCC Postoperative Prediction"}\hlstd{,} \hlstr{"Glasgow Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{21}\hlstd{,} \hlnum{19}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{0.7}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-glasgow-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.glasgow)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.glasgow))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.glasgow))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"Glasgow Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"Glasgow Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,} \hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{1.2}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-glasgow-2} 

}


\begin{kframe}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(gg.groups.glasgow)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.glasgow$Time, data.glasgow$DSD) ~ factor(gg.groups.glasgow))
## 
##   n= 188, number of events= 160 
##    (1 observation deleted due to missingness)
## 
##                              coef exp(coef) se(coef)    z Pr(>|z|)
## factor(gg.groups.glasgow)2 0.0794    1.0826   0.2074 0.38   0.7019
## factor(gg.groups.glasgow)3 0.6662    1.9468   0.2438 2.73   0.0063
## 
##                            exp(coef) exp(-coef) lower .95 upper .95
## factor(gg.groups.glasgow)2      1.08      0.924     0.721      1.63
## factor(gg.groups.glasgow)3      1.95      0.514     1.207      3.14
## 
## Concordance= 0.577  (se = 0.023 )
## Rsquare= 0.049   (max possible= 0.999 )
## Likelihood ratio test= 9.37  on 2 df,   p=0.00923
## Wald test            = 10.4  on 2 df,   p=0.00543
## Score (logrank) test = 10.8  on 2 df,   p=0.00463
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(mskcc_pre.groups.glasgow)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.glasgow$Time, data.glasgow$DSD) ~ factor(mskcc_pre.groups.glasgow))
## 
##   n= 188, number of events= 160 
##    (1 observation deleted due to missingness)
## 
##                                    coef exp(coef) se(coef)    z Pr(>|z|)
## factor(mskcc_pre.groups.glasgow)2 0.764     2.147    0.217 3.52  0.00043
## factor(mskcc_pre.groups.glasgow)3 0.762     2.143    0.260 2.93  0.00338
## 
##                                   exp(coef) exp(-coef) lower .95 upper .95
## factor(mskcc_pre.groups.glasgow)2      2.15      0.466      1.40      3.28
## factor(mskcc_pre.groups.glasgow)3      2.14      0.467      1.29      3.57
## 
## Concordance= 0.563  (se = 0.023 )
## Rsquare= 0.077   (max possible= 0.999 )
## Likelihood ratio test= 15.1  on 2 df,   p=0.000535
## Wald test            = 13.1  on 2 df,   p=0.00144
## Score (logrank) test = 13.6  on 2 df,   p=0.00109
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(mskcc_post.groups.glasgow)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.glasgow$Time, data.glasgow$DSD) ~ factor(mskcc_post.groups.glasgow))
## 
##   n= 188, number of events= 160 
##    (1 observation deleted due to missingness)
## 
##                                     coef exp(coef) se(coef)   z Pr(>|z|)
## factor(mskcc_post.groups.glasgow)2 0.631     1.879    0.218 2.9  0.00378
## factor(mskcc_post.groups.glasgow)3 0.990     2.691    0.261 3.8  0.00015
## 
##                                    exp(coef) exp(-coef) lower .95
## factor(mskcc_post.groups.glasgow)2      1.88      0.532      1.23
## factor(mskcc_post.groups.glasgow)3      2.69      0.372      1.61
##                                    upper .95
## factor(mskcc_post.groups.glasgow)2      2.88
## factor(mskcc_post.groups.glasgow)3      4.49
## 
## Concordance= 0.579  (se = 0.023 )
## Rsquare= 0.081   (max possible= 0.999 )
## Likelihood ratio test= 15.8  on 2 df,   p=0.000372
## Wald test            = 14.7  on 2 df,   p=0.00066
## Score (logrank) test = 15.3  on 2 df,   p=0.000484
\end{verbatim}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_pre.groups.apgi} \hlkwb{=} \hlkwd{cut}\hlstd{(mskcc_pre.linpred.apgi,} \hlkwd{quantile}\hlstd{(mskcc_pre.linpred.apgi, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{mskcc_post.groups.apgi} \hlkwb{=} \hlkwd{cut}\hlstd{(mskcc_post.linpred.apgi,} \hlkwd{quantile}\hlstd{(mskcc_post.linpred.apgi, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.groups.apgi} \hlkwb{=} \hlkwd{cut}\hlstd{(gg.linpred.apgi,} \hlkwd{quantile}\hlstd{(gg.linpred.apgi, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}

\hlstd{temp.km} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlstd{gg.groups.apgi,} \hlkwc{conf.int} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{temp.alpha)}
\hlstd{temp.km} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{= temp.km}\hlopt{$}\hlstd{surv,} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{".*="}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.km}\hlopt{$}\hlstd{strata)), temp.km}\hlopt{$}\hlstd{strata),} \hlkwc{time} \hlstd{= temp.km}\hlopt{$}\hlstd{time,} \hlkwc{upper} \hlstd{= temp.km}\hlopt{$}\hlstd{upper,} \hlkwc{lower} \hlstd{= temp.km}\hlopt{$}\hlstd{lower,} \hlkwc{est} \hlstd{=} \hlstr{"APGI Observed"}\hlstd{)}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.apgi,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.pred.times} \hlkwb{=} \hlstd{temp.pred[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{]}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(temp.pred.ests), gg.groups.apgi,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{)} \hlkwd{apply}\hlstd{(temp.pred.ests[,is],} \hlnum{1}\hlstd{, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.pred.lower} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{1}\hlstd{,])}
\hlstd{temp.pred.meds} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{2}\hlstd{,])}
\hlstd{temp.pred.upper} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{3}\hlstd{,])}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.meds),} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{colnames}\hlstd{(temp.pred.meds),} \hlkwc{each} \hlstd{=} \hlkwd{nrow}\hlstd{(temp.pred.meds)),} \hlkwc{time} \hlstd{= temp.pred.times,} \hlkwc{upper} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.upper),} \hlkwc{lower} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.lower),} \hlkwc{est} \hlstd{=} \hlstr{"GG1 Prediction"}\hlstd{)}
\hlstd{temp.data} \hlkwb{=} \hlkwd{rbind}\hlstd{(temp.km, temp.pred)}
\hlstd{temp.data}\hlopt{$}\hlstd{time} \hlkwb{=} \hlstd{temp.data}\hlopt{$}\hlstd{time} \hlopt{/} \hlnum{365.25} \hlopt{*} \hlnum{12}
\hlstd{temp.predpre.12mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.12mo.apgi, mskcc_pre.groups.apgi, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpre.24mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.24mo.apgi, mskcc_pre.groups.apgi, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpre.36mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.36mo.apgi, mskcc_pre.groups.apgi, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.12mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.12mo.apgi, mskcc_post.groups.apgi, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.24mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.24mo.apgi, mskcc_post.groups.apgi, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.36mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.36mo.apgi, mskcc_post.groups.apgi, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.data2} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}
        \hlkwc{surv} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{2}\hlstd{,], temp.predpre.24mo[}\hlnum{2}\hlstd{,], temp.predpre.36mo[}\hlnum{2}\hlstd{,], temp.predpost.12mo[}\hlnum{2}\hlstd{,], temp.predpost.24mo[}\hlnum{2}\hlstd{,], temp.predpost.36mo[}\hlnum{2}\hlstd{,]),}
        \hlkwc{group} \hlstd{=} \hlkwd{factor}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(mskcc_pre.groups.apgi)),} \hlnum{6}\hlstd{)),}
        \hlkwc{time} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{),} \hlkwc{each} \hlstd{=} \hlnum{3}\hlstd{),}
        \hlkwc{upper} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{3}\hlstd{,], temp.predpre.24mo[}\hlnum{3}\hlstd{,], temp.predpre.36mo[}\hlnum{3}\hlstd{,], temp.predpost.12mo[}\hlnum{3}\hlstd{,], temp.predpost.24mo[}\hlnum{3}\hlstd{,], temp.predpost.36mo[}\hlnum{3}\hlstd{,]),}
        \hlkwc{lower} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{1}\hlstd{,], temp.predpre.24mo[}\hlnum{1}\hlstd{,], temp.predpre.36mo[}\hlnum{1}\hlstd{,], temp.predpost.12mo[}\hlnum{1}\hlstd{,], temp.predpost.24mo[}\hlnum{1}\hlstd{,], temp.predpost.36mo[}\hlnum{1}\hlstd{,]),}
        \hlkwc{est} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{"MSKCC Preoperative"}\hlstd{,} \hlstr{"MSKCC Postoperative"}\hlstd{),} \hlkwc{each} \hlstd{=} \hlnum{9}\hlstd{))}

\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.apgi)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.apgi))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.apgi))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"APGI Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{points}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data2[}\hlkwd{as.character}\hlstd{(temp.data2}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data2}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"MSKCC Preoperative"}\hlstd{,],} \hlkwc{pch} \hlstd{=} \hlnum{21}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{cex} \hlstd{=} \hlnum{1.5}\hlstd{)}
        \hlkwd{points}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data2[}\hlkwd{as.character}\hlstd{(temp.data2}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data2}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"MSKCC Postoperative"}\hlstd{,],} \hlkwc{pch} \hlstd{=} \hlnum{19}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{cex} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"MSKCC Preoperative Prediction"}\hlstd{,} \hlstr{"MSKCC Postoperative Prediction"}\hlstd{,} \hlstr{"APGI Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{21}\hlstd{,} \hlnum{19}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{0.7}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-apgi-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.apgi)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.apgi))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.apgi))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"APGI Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"APGI Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,}\hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{1.2}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-apgi-2} 

}


\begin{kframe}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(gg.groups.apgi)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.apgi$Time, data.apgi$DSD) ~ factor(gg.groups.apgi))
## 
##   n= 73, number of events= 50 
##    (2 observations deleted due to missingness)
## 
##                          coef exp(coef) se(coef)    z Pr(>|z|)
## factor(gg.groups.apgi)2 0.182     1.199    0.421 0.43     0.67
## factor(gg.groups.apgi)3 0.584     1.793    0.477 1.22     0.22
## 
##                         exp(coef) exp(-coef) lower .95 upper .95
## factor(gg.groups.apgi)2      1.20      0.834     0.525      2.74
## factor(gg.groups.apgi)3      1.79      0.558     0.704      4.56
## 
## Concordance= 0.533  (se = 0.039 )
## Rsquare= 0.024   (max possible= 0.993 )
## Likelihood ratio test= 1.79  on 2 df,   p=0.409
## Wald test            = 1.89  on 2 df,   p=0.389
## Score (logrank) test = 1.92  on 2 df,   p=0.383
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(mskcc_pre.groups.apgi)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.apgi$Time, data.apgi$DSD) ~ factor(mskcc_pre.groups.apgi))
## 
##   n= 74, number of events= 50 
##    (1 observation deleted due to missingness)
## 
##                                  coef exp(coef) se(coef)     z Pr(>|z|)
## factor(mskcc_pre.groups.apgi)2 -0.412     0.662    0.367 -1.12     0.26
## factor(mskcc_pre.groups.apgi)3 -0.058     0.944    0.449 -0.13     0.90
## 
##                                exp(coef) exp(-coef) lower .95 upper .95
## factor(mskcc_pre.groups.apgi)2     0.662       1.51     0.322      1.36
## factor(mskcc_pre.groups.apgi)3     0.944       1.06     0.392      2.27
## 
## Concordance= 0.559  (se = 0.037 )
## Rsquare= 0.023   (max possible= 0.993 )
## Likelihood ratio test= 1.7  on 2 df,   p=0.428
## Wald test            = 1.75  on 2 df,   p=0.417
## Score (logrank) test = 1.77  on 2 df,   p=0.412
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(mskcc_post.groups.apgi)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.apgi$Time, data.apgi$DSD) ~ factor(mskcc_post.groups.apgi))
## 
##   n= 74, number of events= 51 
##    (1 observation deleted due to missingness)
## 
##                                  coef exp(coef) se(coef)    z Pr(>|z|)
## factor(mskcc_post.groups.apgi)2 1.526     4.598    0.531 2.87   0.0041
## factor(mskcc_post.groups.apgi)3 1.812     6.125    0.576 3.15   0.0016
## 
##                                 exp(coef) exp(-coef) lower .95 upper .95
## factor(mskcc_post.groups.apgi)2      4.60      0.217      1.62      13.0
## factor(mskcc_post.groups.apgi)3      6.12      0.163      1.98      18.9
## 
## Concordance= 0.624  (se = 0.04 )
## Rsquare= 0.184   (max possible= 0.993 )
## Likelihood ratio test= 15.1  on 2 df,   p=0.000539
## Wald test            = 10.1  on 2 df,   p=0.00628
## Score (logrank) test = 12.3  on 2 df,   p=0.00208
\end{verbatim}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_pre.groups.dresden} \hlkwb{=} \hlkwd{cut}\hlstd{(mskcc_pre.linpred.dresden,} \hlkwd{quantile}\hlstd{(mskcc_pre.linpred.dresden, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{mskcc_post.groups.dresden} \hlkwb{=} \hlkwd{cut}\hlstd{(mskcc_post.linpred.dresden,} \hlkwd{quantile}\hlstd{(mskcc_post.linpred.dresden, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{gg.groups.dresden} \hlkwb{=} \hlkwd{cut}\hlstd{(gg.linpred.dresden,} \hlkwd{quantile}\hlstd{(gg.linpred.dresden, group_quantiles),} \hlkwc{labels} \hlstd{=} \hlnum{FALSE}\hlstd{)}

\hlstd{temp.km} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlstd{gg.groups.dresden,} \hlkwc{conf.int} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{temp.alpha)}
\hlstd{temp.km} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{= temp.km}\hlopt{$}\hlstd{surv,} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{gsub}\hlstd{(}\hlstr{".*="}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{names}\hlstd{(temp.km}\hlopt{$}\hlstd{strata)), temp.km}\hlopt{$}\hlstd{strata),} \hlkwc{time} \hlstd{= temp.km}\hlopt{$}\hlstd{time,} \hlkwc{upper} \hlstd{= temp.km}\hlopt{$}\hlstd{upper,} \hlkwc{lower} \hlstd{= temp.km}\hlopt{$}\hlstd{lower,} \hlkwc{est} \hlstd{=} \hlstr{"Dresden Observed"}\hlstd{)}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{summary}\hlstd{(fit.gg,} \hlkwc{newdata} \hlstd{= data.dresden,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{)}
\hlstd{temp.pred.times} \hlkwb{=} \hlstd{temp.pred[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{]}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])}
\hlstd{temp.pred.ests} \hlkwb{=} \hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(temp.pred.ests), gg.groups.dresden,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{)} \hlkwd{apply}\hlstd{(temp.pred.ests[,is],} \hlnum{1}\hlstd{, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.pred.lower} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{1}\hlstd{,])}
\hlstd{temp.pred.meds} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{2}\hlstd{,])}
\hlstd{temp.pred.upper} \hlkwb{=} \hlkwd{sapply}\hlstd{(temp.pred.ests,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[}\hlnum{3}\hlstd{,])}
\hlstd{temp.pred} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{surv} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.meds),} \hlkwc{group} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{colnames}\hlstd{(temp.pred.meds),} \hlkwc{each} \hlstd{=} \hlkwd{nrow}\hlstd{(temp.pred.meds)),} \hlkwc{time} \hlstd{= temp.pred.times,} \hlkwc{upper} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.upper),} \hlkwc{lower} \hlstd{=} \hlkwd{as.vector}\hlstd{(temp.pred.lower),} \hlkwc{est} \hlstd{=} \hlstr{"GG1 Prediction"}\hlstd{)}
\hlstd{temp.data} \hlkwb{=} \hlkwd{rbind}\hlstd{(temp.km, temp.pred)}
\hlstd{temp.data}\hlopt{$}\hlstd{time} \hlkwb{=} \hlstd{temp.data}\hlopt{$}\hlstd{time} \hlopt{/} \hlnum{365.25} \hlopt{*} \hlnum{12}
\hlstd{temp.predpre.12mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.12mo.dresden, mskcc_pre.groups.dresden, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpre.24mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.24mo.dresden, mskcc_pre.groups.dresden, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpre.36mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_pre.36mo.dresden, mskcc_pre.groups.dresden, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.12mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.12mo.dresden, mskcc_post.groups.dresden, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.24mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.24mo.dresden, mskcc_post.groups.dresden, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.predpost.36mo} \hlkwb{=} \hlkwd{simplify2array}\hlstd{(}\hlkwd{tapply}\hlstd{(mskcc_post.36mo.dresden, mskcc_post.groups.dresden, quantile,} \hlkwc{probs} \hlstd{=} \hlkwd{c}\hlstd{(temp.alpha}\hlopt{/}\hlnum{2}\hlstd{,} \hlnum{0.5}\hlstd{,} \hlnum{1}\hlopt{-}\hlstd{temp.alpha}\hlopt{/}\hlnum{2}\hlstd{),} \hlkwc{na.rm} \hlstd{=} \hlnum{TRUE}\hlstd{))}
\hlstd{temp.data2} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}
        \hlkwc{surv} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{2}\hlstd{,], temp.predpre.24mo[}\hlnum{2}\hlstd{,], temp.predpre.36mo[}\hlnum{2}\hlstd{,], temp.predpost.12mo[}\hlnum{2}\hlstd{,], temp.predpost.24mo[}\hlnum{2}\hlstd{,], temp.predpost.36mo[}\hlnum{2}\hlstd{,]),}
        \hlkwc{group} \hlstd{=} \hlkwd{factor}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(mskcc_pre.groups.dresden)),} \hlnum{6}\hlstd{)),}
        \hlkwc{time} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{),} \hlkwc{each} \hlstd{=} \hlnum{3}\hlstd{),}
        \hlkwc{upper} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{3}\hlstd{,], temp.predpre.24mo[}\hlnum{3}\hlstd{,], temp.predpre.36mo[}\hlnum{3}\hlstd{,], temp.predpost.12mo[}\hlnum{3}\hlstd{,], temp.predpost.24mo[}\hlnum{3}\hlstd{,], temp.predpost.36mo[}\hlnum{3}\hlstd{,]),}
        \hlkwc{lower} \hlstd{=} \hlkwd{c}\hlstd{(temp.predpre.12mo[}\hlnum{1}\hlstd{,], temp.predpre.24mo[}\hlnum{1}\hlstd{,], temp.predpre.36mo[}\hlnum{1}\hlstd{,], temp.predpost.12mo[}\hlnum{1}\hlstd{,], temp.predpost.24mo[}\hlnum{1}\hlstd{,], temp.predpost.36mo[}\hlnum{1}\hlstd{,]),}
        \hlkwc{est} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{"MSKCC Preoperative"}\hlstd{,} \hlstr{"MSKCC Postoperative"}\hlstd{),} \hlkwc{each} \hlstd{=} \hlnum{9}\hlstd{))}

\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.dresden)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.dresden))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.dresden))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"Dresden Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{points}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data2[}\hlkwd{as.character}\hlstd{(temp.data2}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data2}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"MSKCC Preoperative"}\hlstd{,],} \hlkwc{pch} \hlstd{=} \hlnum{21}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{cex} \hlstd{=} \hlnum{1.5}\hlstd{)}
        \hlkwd{points}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data2[}\hlkwd{as.character}\hlstd{(temp.data2}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data2}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"MSKCC Postoperative"}\hlstd{,],} \hlkwc{pch} \hlstd{=} \hlnum{19}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{cex} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"MSKCC Preoperative Prediction"}\hlstd{,} \hlstr{"MSKCC Postoperative Prediction"}\hlstd{,} \hlstr{"Dresden Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{21}\hlstd{,} \hlnum{19}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{0.7}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-dresden-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{plot}\hlstd{(}\hlnum{0} \hlopt{~} \hlnum{0}\hlstd{,} \hlkwc{type} \hlstd{=} \hlstr{"n"}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{5}\hlopt{*}\hlnum{12}\hlstd{),} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Fraction alive"}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlstd{temp.pal} \hlkwb{=} \hlkwd{brewer.pal}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.dresden)),} \hlstr{"Dark2"}\hlstd{)[}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{2}\hlstd{)]}
\hlkwd{names}\hlstd{(temp.pal)} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.dresden))}
\hlkwa{for} \hlstd{(temp.i} \hlkwa{in} \hlkwd{factor}\hlstd{(}\hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(gg.groups.dresden))))}
\hlstd{\{}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"Dresden Observed"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"s"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
        \hlkwd{lines}\hlstd{(surv} \hlopt{~} \hlstd{time, temp.data[}\hlkwd{as.character}\hlstd{(temp.data}\hlopt{$}\hlstd{group)} \hlopt{==} \hlkwd{as.character}\hlstd{(temp.i)} \hlopt{&} \hlstd{temp.data}\hlopt{$}\hlstd{est} \hlopt{==} \hlstr{"GG1 Prediction"}\hlstd{,],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{col} \hlstd{= temp.pal[}\hlkwd{as.character}\hlstd{(temp.i)],} \hlkwc{lwd} \hlstd{=} \hlnum{4}\hlstd{)}
\hlstd{\}}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"PCOP Prediction"}\hlstd{,} \hlstr{"Dresden Observed"}\hlstd{,} \hlstr{"Low predicted risk"}\hlstd{,} \hlstr{"Medium predicted risk"}\hlstd{,} \hlstr{"High predicted risk"}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"solid"}\hlstd{,} \hlstr{"dotted"}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{lwd} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{4}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"black"}\hlstd{, temp.pal[}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{]),} \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{,} \hlnum{15}\hlstd{),} \hlkwc{cex} \hlstd{=} \hlnum{1.2}\hlstd{,} \hlkwc{pt.cex} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{2}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-altman-4-dresden-2} 

}


\begin{kframe}\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(gg.groups.dresden)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.dresden$Time, data.dresden$DSD) ~ factor(gg.groups.dresden))
## 
##   n= 149, number of events= 111 
##    (1 observation deleted due to missingness)
## 
##                              coef exp(coef) se(coef)    z Pr(>|z|)
## factor(gg.groups.dresden)2 0.0305    1.0310   0.2555 0.12     0.90
## factor(gg.groups.dresden)3 0.3364    1.4000   0.3038 1.11     0.27
## 
##                            exp(coef) exp(-coef) lower .95 upper .95
## factor(gg.groups.dresden)2      1.03      0.970     0.625      1.70
## factor(gg.groups.dresden)3      1.40      0.714     0.772      2.54
## 
## Concordance= 0.52  (se = 0.027 )
## Rsquare= 0.012   (max possible= 0.998 )
## Likelihood ratio test= 1.73  on 2 df,   p=0.421
## Wald test            = 1.84  on 2 df,   p=0.399
## Score (logrank) test = 1.85  on 2 df,   p=0.397
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(mskcc_pre.groups.dresden)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.dresden$Time, data.dresden$DSD) ~ factor(mskcc_pre.groups.dresden))
## 
##   n= 149, number of events= 112 
##    (1 observation deleted due to missingness)
## 
##                                     coef exp(coef) se(coef)    z Pr(>|z|)
## factor(mskcc_pre.groups.dresden)2 0.0797    1.0830   0.2483 0.32     0.75
## factor(mskcc_pre.groups.dresden)3 0.3448    1.4117   0.2938 1.17     0.24
## 
##                                   exp(coef) exp(-coef) lower .95 upper .95
## factor(mskcc_pre.groups.dresden)2      1.08      0.923     0.666      1.76
## factor(mskcc_pre.groups.dresden)3      1.41      0.708     0.794      2.51
## 
## Concordance= 0.517  (se = 0.028 )
## Rsquare= 0.01   (max possible= 0.998 )
## Likelihood ratio test= 1.57  on 2 df,   p=0.456
## Wald test            = 1.64  on 2 df,   p=0.441
## Score (logrank) test = 1.65  on 2 df,   p=0.438
\end{verbatim}
\begin{alltt}
\hlkwd{summary}\hlstd{(}\hlkwd{coxph}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD)} \hlopt{~} \hlkwd{factor}\hlstd{(mskcc_post.groups.dresden)))}
\end{alltt}
\begin{verbatim}
## Call:
## coxph(formula = Surv(data.dresden$Time, data.dresden$DSD) ~ factor(mskcc_post.groups.dresden))
## 
##   n= 149, number of events= 111 
##    (1 observation deleted due to missingness)
## 
##                                     coef exp(coef) se(coef)    z Pr(>|z|)
## factor(mskcc_post.groups.dresden)2 0.431     1.539    0.284 1.51   0.1298
## factor(mskcc_post.groups.dresden)3 1.019     2.771    0.334 3.05   0.0023
## 
##                                    exp(coef) exp(-coef) lower .95
## factor(mskcc_post.groups.dresden)2      1.54      0.650     0.881
## factor(mskcc_post.groups.dresden)3      2.77      0.361     1.439
##                                    upper .95
## factor(mskcc_post.groups.dresden)2      2.69
## factor(mskcc_post.groups.dresden)3      5.34
## 
## Concordance= 0.569  (se = 0.027 )
## Rsquare= 0.063   (max possible= 0.998 )
## Likelihood ratio test= 9.73  on 2 df,   p=0.00772
## Wald test            = 10.1  on 2 df,   p=0.00648
## Score (logrank) test = 10.5  on 2 df,   p=0.0052
\end{verbatim}
\end{kframe}
\end{knitrout}


Decision curve analysis.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{source}\hlstd{(}\hlstr{"stdca.R"}\hlstd{)}
\hlstd{temp.data} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{Time} \hlstd{= data.glasgow}\hlopt{$}\hlstd{Time,} \hlkwc{DSD} \hlstd{= data.glasgow}\hlopt{$}\hlstd{DSD}\hlopt{*}\hlnum{1}\hlstd{,}
    \hlkwc{gg.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.glasgow[val.prob.times} \hlopt{==} \hlnum{365}\hlstd{,],} \hlkwc{gg.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.glasgow[val.prob.times} \hlopt{==} \hlnum{365}\hlopt{*}\hlnum{2}\hlstd{,],} \hlkwc{gg.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.glasgow[val.prob.times} \hlopt{==} \hlnum{365}\hlopt{*}\hlnum{3}\hlstd{,],}
    \hlkwc{mskcc.pre.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.12mo.glasgow,} \hlkwc{mskcc.pre.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.24mo.glasgow,} \hlkwc{mskcc.pre.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.36mo.glasgow,}
    \hlkwc{mskcc.post.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.12mo.glasgow,} \hlkwc{mskcc.post.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.24mo.glasgow,} \hlkwc{mskcc.post.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.36mo.glasgow)}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.1"}\hlstd{,} \hlstr{"mskcc.pre.1"}\hlstd{,} \hlstr{"mskcc.post.1"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.1: No observations with risk greater than 63% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."        
## [2] "mskcc.pre.1: No observations with risk greater than 32%, and therefore net benefit not calculable in this range."                                                   
## [3] "mskcc.post.1: No observations with risk greater than 30% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-1} 

}


\begin{kframe}\begin{alltt}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.2"}\hlstd{,} \hlstr{"mskcc.pre.2"}\hlstd{,} \hlstr{"mskcc.post.2"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlopt{*}\hlnum{2}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.2: No observations with risk greater than 94% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."        
## [2] "mskcc.pre.2: No observations with risk greater than 65%, and therefore net benefit not calculable in this range."                                                   
## [3] "mskcc.post.2: No observations with risk greater than 61% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-2} 

}


\begin{kframe}\begin{alltt}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.3"}\hlstd{,} \hlstr{"mskcc.pre.3"}\hlstd{,} \hlstr{"mskcc.post.3"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlopt{*}\hlnum{3}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "mskcc.pre.3: No observations with risk greater than 80%, and therefore net benefit not calculable in this range."                                                   
## [2] "mskcc.post.3: No observations with risk greater than 77% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-3} 

}


\begin{kframe}\begin{alltt}
\hlstd{temp.data} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{Time} \hlstd{= data.apgi}\hlopt{$}\hlstd{Time,} \hlkwc{DSD} \hlstd{= data.apgi}\hlopt{$}\hlstd{DSD}\hlopt{*}\hlnum{1}\hlstd{,}
    \hlkwc{gg.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.apgi[val.prob.times} \hlopt{==} \hlnum{365}\hlstd{,],} \hlkwc{gg.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.apgi[val.prob.times} \hlopt{==} \hlnum{365}\hlopt{*}\hlnum{2}\hlstd{,],} \hlkwc{gg.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.apgi[val.prob.times} \hlopt{==} \hlnum{365}\hlopt{*}\hlnum{3}\hlstd{,],}
    \hlkwc{mskcc.pre.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.12mo.apgi,} \hlkwc{mskcc.pre.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.24mo.apgi,} \hlkwc{mskcc.pre.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.36mo.apgi,}
    \hlkwc{mskcc.post.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.12mo.apgi,} \hlkwc{mskcc.post.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.24mo.apgi,} \hlkwc{mskcc.post.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.36mo.apgi)}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.1"}\hlstd{,} \hlstr{"mskcc.pre.1"}\hlstd{,} \hlstr{"mskcc.post.1"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.1: No observations with risk greater than 72%, and therefore net benefit not calculable in this range."        
## [2] "mskcc.pre.1: No observations with risk greater than 50%, and therefore net benefit not calculable in this range." 
## [3] "mskcc.post.1: No observations with risk greater than 50%, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-4} 

}


\begin{kframe}\begin{alltt}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.2"}\hlstd{,} \hlstr{"mskcc.pre.2"}\hlstd{,} \hlstr{"mskcc.post.2"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlopt{*}\hlnum{2}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.2: No observations with risk greater than 89% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."        
## [2] "mskcc.pre.2: No observations with risk greater than 85%, and therefore net benefit not calculable in this range."                                                   
## [3] "mskcc.post.2: No observations with risk greater than 80% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-5} 

}


\begin{kframe}\begin{alltt}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.3"}\hlstd{,} \hlstr{"mskcc.pre.3"}\hlstd{,} \hlstr{"mskcc.post.3"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlopt{*}\hlnum{3}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.3: No observations with risk greater than 93% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."        
## [2] "mskcc.pre.3: No observations with risk greater than 95%, and therefore net benefit not calculable in this range."                                                   
## [3] "mskcc.post.3: No observations with risk greater than 92% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-6} 

}


\begin{kframe}\begin{alltt}
\hlstd{temp.data} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{Time} \hlstd{= data.dresden}\hlopt{$}\hlstd{Time,} \hlkwc{DSD} \hlstd{= data.dresden}\hlopt{$}\hlstd{DSD}\hlopt{*}\hlnum{1}\hlstd{,}
    \hlkwc{gg.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.dresden[val.prob.times} \hlopt{==} \hlnum{365}\hlstd{,],} \hlkwc{gg.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.dresden[val.prob.times} \hlopt{==} \hlnum{365}\hlopt{*}\hlnum{2}\hlstd{,],} \hlkwc{gg.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{gg.prob.dresden[val.prob.times} \hlopt{==} \hlnum{365}\hlopt{*}\hlnum{3}\hlstd{,],}
    \hlkwc{mskcc.pre.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.12mo.dresden,} \hlkwc{mskcc.pre.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.24mo.dresden,} \hlkwc{mskcc.pre.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_pre.36mo.dresden,}
    \hlkwc{mskcc.post.1} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.12mo.dresden,} \hlkwc{mskcc.post.2} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.24mo.dresden,} \hlkwc{mskcc.post.3} \hlstd{=} \hlnum{1}\hlopt{-}\hlstd{mskcc_post.36mo.dresden)}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.1"}\hlstd{,} \hlstr{"mskcc.pre.1"}\hlstd{,} \hlstr{"mskcc.post.1"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.1: No observations with risk greater than 77%, and therefore net benefit not calculable in this range."        
## [2] "mskcc.pre.1: No observations with risk greater than 49%, and therefore net benefit not calculable in this range." 
## [3] "mskcc.post.1: No observations with risk greater than 57%, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-7} 

}


\begin{kframe}\begin{alltt}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.2"}\hlstd{,} \hlstr{"mskcc.pre.2"}\hlstd{,} \hlstr{"mskcc.post.2"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlopt{*}\hlnum{2}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "gg.2: No observations with risk greater than 94% that have followup through the timepoint selected, and therefore net benefit not calculable in this range."
## [2] "mskcc.pre.2: No observations with risk greater than 84%, and therefore net benefit not calculable in this range."                                           
## [3] "mskcc.post.2: No observations with risk greater than 90%, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-8} 

}


\begin{kframe}\begin{alltt}
\hlkwd{invisible}\hlstd{(}\hlkwd{stdca}\hlstd{(}\hlkwc{data} \hlstd{= temp.data,} \hlkwc{outcome} \hlstd{=} \hlstr{"DSD"}\hlstd{,} \hlkwc{ttoutcome} \hlstd{=} \hlstr{"Time"}\hlstd{,} \hlkwc{predictors} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"gg.3"}\hlstd{,} \hlstr{"mskcc.pre.3"}\hlstd{,} \hlstr{"mskcc.post.3"}\hlstd{),} \hlkwc{timepoint} \hlstd{=} \hlnum{365}\hlopt{*}\hlnum{3}\hlstd{,} \hlkwc{probability} \hlstd{=} \hlkwd{rep}\hlstd{(}\hlnum{TRUE}\hlstd{,} \hlnum{3}\hlstd{)))}
\end{alltt}
\begin{verbatim}
## [1] "mskcc.pre.3: No observations with risk greater than 94%, and therefore net benefit not calculable in this range." 
## [2] "mskcc.post.3: No observations with risk greater than 98%, and therefore net benefit not calculable in this range."
\end{verbatim}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-model-selection-dca-9} 

}



\end{knitrout}


\subsection{Brier score}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{calcIBS} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{surv}\hlstd{,} \hlkwc{pred}\hlstd{,} \hlkwc{pred_times}\hlstd{,} \hlkwc{max_time}\hlstd{,} \hlkwc{min_time} \hlstd{=} \hlnum{0}\hlstd{)}
\hlstd{\{}
        \hlkwd{stopifnot}\hlstd{(}\hlkwd{nrow}\hlstd{(surv)} \hlopt{==} \hlkwd{nrow}\hlstd{(pred)} \hlopt{&&} \hlkwd{length}\hlstd{(pred_times)} \hlopt{==} \hlkwd{ncol}\hlstd{(pred))}

        \hlstd{n} \hlkwb{=} \hlkwd{nrow}\hlstd{(surv)}
        \hlstd{marg_survfit} \hlkwb{=} \hlkwd{survfit}\hlstd{(surv} \hlopt{~} \hlnum{1}\hlstd{)}
        \hlstd{marg_censfit} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(surv[,}\hlnum{1}\hlstd{],} \hlopt{!}\hlstd{surv[,}\hlnum{2}\hlstd{])} \hlopt{~} \hlnum{1}\hlstd{)}
        \hlstd{marg_surv_func} \hlkwb{=} \hlkwd{approxfun}\hlstd{(marg_survfit}\hlopt{$}\hlstd{time, marg_survfit}\hlopt{$}\hlstd{surv,} \hlkwc{method} \hlstd{=} \hlstr{"constant"}\hlstd{,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlopt{:}\hlnum{1}\hlstd{,} \hlkwc{f} \hlstd{=} \hlnum{0}\hlstd{)}
        \hlstd{marg_cens_func} \hlkwb{=} \hlkwd{approxfun}\hlstd{(marg_censfit}\hlopt{$}\hlstd{time, marg_censfit}\hlopt{$}\hlstd{surv,} \hlkwc{method} \hlstd{=} \hlstr{"constant"}\hlstd{,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlopt{:}\hlnum{1}\hlstd{,} \hlkwc{f} \hlstd{=} \hlnum{0}\hlstd{)}

        \hlstd{pred_funcs} \hlkwb{=} \hlkwd{apply}\hlstd{(pred,} \hlnum{1}\hlstd{,} \hlkwa{function}\hlstd{(}\hlkwc{pat_preds}\hlstd{)} \hlkwd{approxfun}\hlstd{(pred_times, pat_preds,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlkwd{min}\hlstd{(pat_preds),} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlstd{))}

        \hlstd{indiv_patient_bsc} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{pat_i}\hlstd{,} \hlkwc{tstars}\hlstd{)}
        \hlstd{\{}
                \hlstd{observed_time} \hlkwb{=} \hlstd{surv[pat_i,} \hlnum{1}\hlstd{]}
                \hlstd{observed_event} \hlkwb{=} \hlstd{surv[pat_i,} \hlnum{2}\hlstd{]}
                \hlstd{pred_func} \hlkwb{=} \hlstd{pred_funcs[[pat_i]]}
                \hlstd{category} \hlkwb{=} \hlnum{1}\hlopt{*}\hlstd{(observed_time} \hlopt{<=} \hlstd{tstars} \hlopt{&} \hlstd{observed_event)} \hlopt{+} \hlnum{2}\hlopt{*}\hlstd{(observed_time} \hlopt{>} \hlstd{tstars)} \hlopt{+} \hlnum{3}\hlopt{*}\hlstd{(observed_time} \hlopt{<=} \hlstd{tstars} \hlopt{& !}\hlstd{observed_event)}
                \hlstd{bsc} \hlkwb{=} \hlkwd{rep}\hlstd{(}\hlnum{NA}\hlstd{,} \hlkwd{length}\hlstd{(tstars))}
                \hlstd{bsc[category} \hlopt{==} \hlnum{1}\hlstd{]} \hlkwb{=} \hlkwd{pred_func}\hlstd{(tstars[category} \hlopt{==} \hlnum{1}\hlstd{])}\hlopt{^}\hlnum{2} \hlopt{/} \hlkwd{marg_cens_func}\hlstd{(observed_time)}
                \hlstd{bsc[category} \hlopt{==} \hlnum{2}\hlstd{]} \hlkwb{=} \hlstd{(}\hlnum{1} \hlopt{-} \hlkwd{pred_func}\hlstd{(tstars[category} \hlopt{==} \hlnum{2}\hlstd{]))}\hlopt{^}\hlnum{2} \hlopt{/} \hlkwd{marg_cens_func}\hlstd{(tstars[category} \hlopt{==} \hlnum{2}\hlstd{])}
                \hlstd{bsc[category} \hlopt{==} \hlnum{3}\hlstd{]} \hlkwb{=} \hlnum{0}
                \hlstd{bsc}
        \hlstd{\}}

        \hlstd{bsc_func} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{tstars}\hlstd{) \{} \hlkwd{rowMeans}\hlstd{(}\hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlstd{n,} \hlkwa{function}\hlstd{(}\hlkwc{pat_i}\hlstd{)} \hlkwd{indiv_patient_bsc}\hlstd{(pat_i, tstars))) \}}

        \hlstd{weight_func} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{tstars}\hlstd{) \{ (}\hlnum{1} \hlopt{-} \hlkwd{marg_surv_func}\hlstd{(tstars))} \hlopt{/} \hlstd{(}\hlnum{1} \hlopt{-} \hlkwd{marg_surv_func}\hlstd{(max_time)) \}}

        \hlcom{# Be slack and do trapezoidal int. with a fine grid.  It should be possible }
        \hlcom{# to calulate the int. exactly but I cbfed.}
        \hlstd{int_grid} \hlkwb{=} \hlkwd{seq}\hlstd{(min_time, max_time,} \hlkwc{length.out} \hlstd{=} \hlnum{1e3}\hlstd{)}
        \hlstd{bsc_vals} \hlkwb{=} \hlkwd{bsc_func}\hlstd{(int_grid)}
        \hlstd{weight_vals} \hlkwb{=} \hlkwd{weight_func}\hlstd{(int_grid)}
        \hlstd{int_vals} \hlkwb{=} \hlstd{bsc_vals} \hlopt{*} \hlstd{weight_vals}
        \hlstd{ibsc} \hlkwb{=} \hlstd{(}\hlnum{2}\hlopt{*}\hlkwd{sum}\hlstd{(int_vals)} \hlopt{-} \hlstd{int_vals[}\hlnum{1}\hlstd{]} \hlopt{-} \hlstd{int_vals[}\hlkwd{length}\hlstd{(int_vals)])} \hlopt{*} \hlstd{(}\hlkwd{diff}\hlstd{(}\hlkwd{range}\hlstd{(int_grid)))} \hlopt{/} \hlstd{(}\hlnum{2}\hlopt{*}\hlkwd{length}\hlstd{(int_vals))}

        \hlkwd{return}\hlstd{(}\hlkwd{list}\hlstd{(}\hlkwc{bsc} \hlstd{= bsc_vals,} \hlkwc{weights} \hlstd{= weight_vals,} \hlkwc{eval_times} \hlstd{= int_grid,} \hlkwc{ibsc} \hlstd{= ibsc))}
\hlstd{\}}

\hlstd{calcBSsingle} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{surv}\hlstd{,} \hlkwc{pred}\hlstd{,} \hlkwc{pred_time}\hlstd{)}
\hlstd{\{}
        \hlstd{n} \hlkwb{=} \hlkwd{nrow}\hlstd{(surv)}
        \hlstd{obs_time} \hlkwb{=} \hlstd{surv[,}\hlnum{1}\hlstd{]}
        \hlstd{obs_event} \hlkwb{=} \hlstd{surv[,}\hlnum{2}\hlstd{]}
        \hlstd{marg_censfit} \hlkwb{=} \hlkwd{survfit}\hlstd{(}\hlkwd{Surv}\hlstd{(obs_time,} \hlopt{!}\hlstd{obs_event)} \hlopt{~} \hlnum{1}\hlstd{)}
        \hlstd{marg_cens_func} \hlkwb{=} \hlkwd{approxfun}\hlstd{(marg_censfit}\hlopt{$}\hlstd{time, marg_censfit}\hlopt{$}\hlstd{surv,} \hlkwc{method} \hlstd{=} \hlstr{"constant"}\hlstd{,} \hlkwc{yleft} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{yright} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{rule} \hlstd{=} \hlnum{2}\hlopt{:}\hlnum{1}\hlstd{,} \hlkwc{f} \hlstd{=} \hlnum{0}\hlstd{)}

        \hlstd{brier_val} \hlkwb{=} \hlkwd{rep}\hlstd{(}\hlnum{NA}\hlstd{, n)}
        \hlstd{cat} \hlkwb{=} \hlnum{1}\hlopt{*}\hlkwd{I}\hlstd{(obs_time} \hlopt{<=} \hlstd{pred_time} \hlopt{&} \hlstd{obs_event)} \hlopt{+} \hlnum{2}\hlopt{*}\hlkwd{I}\hlstd{(obs_time} \hlopt{>} \hlstd{pred_time)} \hlopt{+} \hlnum{3}\hlopt{*}\hlkwd{I}\hlstd{(obs_time} \hlopt{<=} \hlstd{pred_time} \hlopt{& !}\hlstd{obs_event)}
        \hlstd{brier_val[cat} \hlopt{==} \hlnum{1}\hlstd{]} \hlkwb{=} \hlstd{(pred[cat} \hlopt{==} \hlnum{1}\hlstd{])}\hlopt{^}\hlnum{2} \hlopt{/} \hlkwd{marg_cens_func}\hlstd{(obs_time[cat} \hlopt{==} \hlnum{1}\hlstd{])}
        \hlstd{brier_val[cat} \hlopt{==} \hlnum{2}\hlstd{]} \hlkwb{=} \hlstd{(}\hlnum{1}\hlopt{-}\hlstd{pred[cat} \hlopt{==} \hlnum{2}\hlstd{])}\hlopt{^}\hlnum{2} \hlopt{/} \hlkwd{marg_cens_func}\hlstd{(pred_time)}
        \hlstd{brier_val[cat} \hlopt{==} \hlnum{3}\hlstd{]} \hlkwb{=} \hlnum{0}

        \hlkwd{mean}\hlstd{(brier_val)}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_post.12mo.glasgow.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD), mskcc_post.12mo.glasgow,} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_post.24mo.glasgow.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD), mskcc_post.24mo.glasgow,} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_post.36mo.glasgow.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD), mskcc_post.36mo.glasgow,} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.12mo.glasgow.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD), mskcc_pre.12mo.glasgow,} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.24mo.glasgow.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD), mskcc_pre.24mo.glasgow,} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.36mo.glasgow.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD), mskcc_pre.36mo.glasgow,} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{gg.path.glasgow.brier} \hlkwb{=} \hlkwd{calcIBS}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD),} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(gg.path.glasgow,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])), gg.path.glasgow[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{],} \hlnum{10}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{km0.path.glasgow.brier} \hlkwb{=} \hlkwd{calcIBS}\hlstd{(}\hlkwd{Surv}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time, data.glasgow}\hlopt{$}\hlstd{DSD),} \hlkwd{matrix}\hlstd{(fit.km0}\hlopt{$}\hlstd{surv,} \hlkwc{nrow} \hlstd{=} \hlkwd{nrow}\hlstd{(data.glasgow),} \hlkwc{ncol} \hlstd{=} \hlkwd{length}\hlstd{(fit.km0}\hlopt{$}\hlstd{time),} \hlkwc{byrow} \hlstd{=} \hlnum{TRUE}\hlstd{), fit.km0}\hlopt{$}\hlstd{time,} \hlnum{10}\hlopt{*}\hlnum{365.25}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_post.12mo.apgi.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD), mskcc_post.12mo.apgi,} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_post.24mo.apgi.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD), mskcc_post.24mo.apgi,} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_post.36mo.apgi.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD), mskcc_post.36mo.apgi,} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.12mo.apgi.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD), mskcc_pre.12mo.apgi,} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.24mo.apgi.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD), mskcc_pre.24mo.apgi,} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.36mo.apgi.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD), mskcc_pre.36mo.apgi,} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{gg.path.apgi.brier} \hlkwb{=} \hlkwd{calcIBS}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD),} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(gg.path.apgi,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])), gg.path.apgi[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{],} \hlnum{10}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{km0.path.apgi.brier} \hlkwb{=} \hlkwd{calcIBS}\hlstd{(}\hlkwd{Surv}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time, data.apgi}\hlopt{$}\hlstd{DSD),} \hlkwd{matrix}\hlstd{(fit.km0}\hlopt{$}\hlstd{surv,} \hlkwc{nrow} \hlstd{=} \hlkwd{nrow}\hlstd{(data.apgi),} \hlkwc{ncol} \hlstd{=} \hlkwd{length}\hlstd{(fit.km0}\hlopt{$}\hlstd{time),} \hlkwc{byrow} \hlstd{=} \hlnum{TRUE}\hlstd{), fit.km0}\hlopt{$}\hlstd{time,} \hlnum{10}\hlopt{*}\hlnum{365.25}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_post.12mo.dresden.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD), mskcc_post.12mo.dresden,} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_post.24mo.dresden.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD), mskcc_post.24mo.dresden,} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_post.36mo.dresden.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD), mskcc_post.36mo.dresden,} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.12mo.dresden.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD), mskcc_pre.12mo.dresden,} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.24mo.dresden.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD), mskcc_pre.24mo.dresden,} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{mskcc_pre.36mo.dresden.brier} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD), mskcc_pre.36mo.dresden,} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{gg.path.dresden.brier} \hlkwb{=} \hlkwd{calcIBS}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD),} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(gg.path.dresden,} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{) x[,}\hlnum{2}\hlstd{])), gg.path.dresden[[}\hlnum{1}\hlstd{]][,}\hlnum{1}\hlstd{],} \hlnum{10}\hlopt{*}\hlnum{365.25}\hlstd{)}
\hlstd{km0.path.dresden.brier} \hlkwb{=} \hlkwd{calcIBS}\hlstd{(}\hlkwd{Surv}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time, data.dresden}\hlopt{$}\hlstd{DSD),} \hlkwd{matrix}\hlstd{(fit.km0}\hlopt{$}\hlstd{surv,} \hlkwc{nrow} \hlstd{=} \hlkwd{nrow}\hlstd{(data.dresden),} \hlkwc{ncol} \hlstd{=} \hlkwd{length}\hlstd{(fit.km0}\hlopt{$}\hlstd{time),} \hlkwc{byrow} \hlstd{=} \hlnum{TRUE}\hlstd{), fit.km0}\hlopt{$}\hlstd{time,} \hlnum{10}\hlopt{*}\hlnum{365.25}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(gg.path.glasgow.brier}\hlopt{$}\hlstd{eval_times}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, gg.path.glasgow.brier}\hlopt{$}\hlstd{bsc,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{0.3}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Brier score"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{40}\hlstd{),} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlkwd{lines}\hlstd{(gg.path.glasgow.brier}\hlopt{$}\hlstd{eval_times}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, km0.path.glasgow.brier}\hlopt{$}\hlstd{bsc,} \hlkwc{col} \hlstd{= pal[}\hlstr{"km0"}\hlstd{],} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\hlkwd{points}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{),} \hlkwd{c}\hlstd{(mskcc_pre.12mo.glasgow.brier, mskcc_pre.24mo.glasgow.brier, mskcc_pre.36mo.glasgow.brier),} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{],} \hlkwc{cex} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{pch} \hlstd{=} \hlnum{16}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{h} \hlstd{=} \hlnum{0.25}\hlstd{,} \hlkwc{col} \hlstd{=} \hlstr{"grey"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{34}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"bottom"}\hlstd{,}
        \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}     \hlstr{"PCOP"}\hlstd{,}                 \hlstr{"KM0"}\hlstd{,}          \hlstr{"MSKCC"}\hlstd{),}
        \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}        \hlnum{NA}\hlstd{,}                     \hlnum{NA}\hlstd{,}             \hlnum{16}\hlstd{),}
        \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(        pal[}\hlstr{"gg"}\hlstd{],              pal[}\hlstr{"km0"}\hlstd{], pal[}\hlstr{"mskcc.pre"}\hlstd{]),}
        \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}        \hlstr{"solid"}\hlstd{,}                \hlstr{"solid"}\hlstd{,}        \hlnum{NA}\hlstd{),}
        \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-prob-bs-paths-plot-glasgow-1} 

}



\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(gg.path.apgi.brier}\hlopt{$}\hlstd{eval_times}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, gg.path.apgi.brier}\hlopt{$}\hlstd{bsc,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{0.3}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Brier score"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{40}\hlstd{),} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlkwd{lines}\hlstd{(gg.path.apgi.brier}\hlopt{$}\hlstd{eval_times}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, km0.path.apgi.brier}\hlopt{$}\hlstd{bsc,} \hlkwc{col} \hlstd{= pal[}\hlstr{"km0"}\hlstd{],} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\hlkwd{points}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{),} \hlkwd{c}\hlstd{(mskcc_pre.12mo.apgi.brier, mskcc_pre.24mo.apgi.brier, mskcc_pre.36mo.apgi.brier),} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{],} \hlkwc{cex} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{pch} \hlstd{=} \hlnum{16}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{h} \hlstd{=} \hlnum{0.25}\hlstd{,} \hlkwc{col} \hlstd{=} \hlstr{"grey"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{34}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"bottom"}\hlstd{,}
        \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}     \hlstr{"PCOP"}\hlstd{,}                 \hlstr{"KM0"}\hlstd{,}          \hlstr{"MSKCC"}\hlstd{),}
        \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}        \hlnum{NA}\hlstd{,}                     \hlnum{NA}\hlstd{,}             \hlnum{16}\hlstd{),}
        \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(        pal[}\hlstr{"gg"}\hlstd{],              pal[}\hlstr{"km0"}\hlstd{], pal[}\hlstr{"mskcc.pre"}\hlstd{]),}
        \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}        \hlstr{"solid"}\hlstd{,}                \hlstr{"solid"}\hlstd{,}        \hlnum{NA}\hlstd{),}
        \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-prob-bs-paths-plot-apgi-1} 

}



\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(gg.path.dresden.brier}\hlopt{$}\hlstd{eval_times}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, gg.path.dresden.brier}\hlopt{$}\hlstd{bsc,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{],} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{0.3}\hlstd{),} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"Brier score"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{xlim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{40}\hlstd{),} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlkwd{lines}\hlstd{(gg.path.dresden.brier}\hlopt{$}\hlstd{eval_times}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, km0.path.dresden.brier}\hlopt{$}\hlstd{bsc,} \hlkwc{col} \hlstd{= pal[}\hlstr{"km0"}\hlstd{],} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\hlkwd{points}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{),} \hlkwd{c}\hlstd{(mskcc_pre.12mo.dresden.brier, mskcc_pre.24mo.dresden.brier, mskcc_pre.36mo.dresden.brier),} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{],} \hlkwc{cex} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{pch} \hlstd{=} \hlnum{16}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{h} \hlstd{=} \hlnum{0.25}\hlstd{,} \hlkwc{col} \hlstd{=} \hlstr{"grey"}\hlstd{,} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{34}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"bottom"}\hlstd{,}
        \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}     \hlstr{"PCOP"}\hlstd{,}                 \hlstr{"KM0"}\hlstd{,}          \hlstr{"MSKCC"}\hlstd{),}
        \hlkwc{pch} \hlstd{=} \hlkwd{c}\hlstd{(}        \hlnum{NA}\hlstd{,}                     \hlnum{NA}\hlstd{,}             \hlnum{16}\hlstd{),}
        \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(        pal[}\hlstr{"gg"}\hlstd{],              pal[}\hlstr{"km0"}\hlstd{], pal[}\hlstr{"mskcc.pre"}\hlstd{]),}
        \hlkwc{lty} \hlstd{=} \hlkwd{c}\hlstd{(}        \hlstr{"solid"}\hlstd{,}                \hlstr{"solid"}\hlstd{,}        \hlnum{NA}\hlstd{),}
        \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-prob-bs-paths-plot-dresden-1} 

}



\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{probs_bs_boot_func_glasgow} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{d}\hlstd{,} \hlkwc{i}\hlstd{) \{}
        \hlstd{bs.mskcc.postop.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.12mo.glasgow[i],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.postop.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.24mo.glasgow[i],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.postop.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.36mo.glasgow[i],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.12mo.glasgow[i],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.24mo.glasgow[i],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.36mo.glasgow[i],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{bs.gg.vals} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(gg.path.glasgow[i],} \hlkwa{function}\hlstd{(}\hlkwc{path}\hlstd{)} \hlkwd{approx}\hlstd{(path[,}\hlnum{1}\hlstd{], path[,}\hlnum{2}\hlstd{],} \hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{)}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}\hlopt{$}\hlstd{y))}
        \hlkwd{rownames}\hlstd{(bs.gg.vals)} \hlkwb{<-} \hlkwa{NULL}
        \hlstd{bs.gg.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{1}\hlstd{],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.gg.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{2}\hlstd{],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.gg.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{3}\hlstd{],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{bs.km0.vals} \hlkwb{=} \hlkwd{approx}\hlstd{(fit.km0}\hlopt{$}\hlstd{time, fit.km0}\hlopt{$}\hlstd{surv,} \hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{)}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}\hlopt{$}\hlstd{y}
        \hlstd{bs.km0.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{1}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.km0.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{2}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.km0.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{3}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{result} \hlkwb{=} \hlkwd{c}\hlstd{(}
                \hlstd{bs.gg.12} \hlopt{-} \hlstd{bs.km0.12,                   bs.mskcc.preop.12} \hlopt{-} \hlstd{bs.km0.12,}
                \hlstd{bs.gg.12} \hlopt{-} \hlstd{bs.mskcc.preop.12,}
                \hlstd{bs.gg.24} \hlopt{-} \hlstd{bs.km0.24,                   bs.mskcc.preop.24} \hlopt{-} \hlstd{bs.km0.24,}
                \hlstd{bs.gg.24} \hlopt{-} \hlstd{bs.mskcc.preop.24,}
                \hlstd{bs.gg.36} \hlopt{-} \hlstd{bs.km0.36,                   bs.mskcc.preop.36} \hlopt{-} \hlstd{bs.km0.36,}
                \hlstd{bs.gg.36} \hlopt{-} \hlstd{bs.mskcc.preop.36)}

        \hlkwd{names}\hlstd{(result)} \hlkwb{<-} \hlkwa{NULL}
        \hlstd{result}
\hlstd{\}}

\hlkwd{set.seed}\hlstd{(}\hlnum{20150208}\hlstd{)}
\hlstd{deltaBrier.boot.glasgow} \hlkwb{=} \hlkwd{boot}\hlstd{(data.glasgow, probs_bs_boot_func_glasgow,} \hlkwc{R} \hlstd{=} \hlnum{500}\hlstd{)}
\hlstd{deltaBrier.boot.glasgow.cis} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(deltaBrier.boot.glasgow}\hlopt{$}\hlstd{t),} \hlkwa{function}\hlstd{(}\hlkwc{i}\hlstd{)} \hlkwd{boot.ci}\hlstd{(deltaBrier.boot.glasgow,} \hlkwc{index} \hlstd{= i,} \hlkwc{type} \hlstd{=} \hlstr{"bca"}\hlstd{)}\hlopt{$}\hlstd{bca))}
\hlkwd{colnames}\hlstd{(deltaBrier.boot.glasgow.cis)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"level"}\hlstd{,} \hlstr{"lowindex"}\hlstd{,} \hlstr{"highindex"}\hlstd{,} \hlstr{"lci"}\hlstd{,} \hlstr{"uci"}\hlstd{)}
\hlkwd{rownames}\hlstd{(deltaBrier.boot.glasgow.cis)} \hlkwb{=} \hlkwd{c}\hlstd{(}
        \hlstr{"12:gg-km0"}\hlstd{,} \hlstr{"12:pre-km0"}\hlstd{,} \hlstr{"12:gg-pre"}\hlstd{,}
        \hlstr{"24:gg-km0"}\hlstd{,} \hlstr{"24:pre-km0"}\hlstd{,} \hlstr{"24:gg-pre"}\hlstd{,}
        \hlstr{"36:gg-km0"}\hlstd{,} \hlstr{"36:pre-km0"}\hlstd{,} \hlstr{"36:gg-pre"}\hlstd{)}
\hlstd{deltaBrier.boot.glasgow}
\end{alltt}
\begin{verbatim}
## 
## ORDINARY NONPARAMETRIC BOOTSTRAP
## 
## 
## Call:
## boot(data = data.glasgow, statistic = probs_bs_boot_func_glasgow, 
##     R = 500)
## 
## 
## Bootstrap Statistics :
##      original     bias    std. error
## t1* -0.023252 -5.591e-04    0.011020
## t2*  0.012000  5.097e-04    0.014791
## t3* -0.035252 -1.069e-03    0.018703
## t4* -0.024707 -1.173e-03    0.011163
## t5*  0.020378  1.780e-04    0.020822
## t6* -0.045085 -1.351e-03    0.022651
## t7* -0.006137 -3.073e-04    0.006092
## t8*  0.039775 -9.123e-06    0.018277
## t9* -0.045912 -2.982e-04    0.018448
\end{verbatim}
\begin{alltt}
\hlstd{deltaBrier.boot.glasgow.cis}
\end{alltt}
\begin{verbatim}
##            level lowindex highindex        lci        uci
## 12:gg-km0   0.95    19.36     493.3 -0.0438016  0.0001641
## 12:pre-km0  0.95    10.07     485.4 -0.0179132  0.0401415
## 12:gg-pre   0.95     9.88     485.4 -0.0753277 -0.0035136
## 24:gg-km0   0.95    17.35     492.2 -0.0471870 -0.0023731
## 24:pre-km0  0.95    11.87     487.8 -0.0189747  0.0617515
## 24:gg-pre   0.95    19.24     493.3 -0.0845755  0.0024417
## 36:gg-km0   0.95    15.48     490.9 -0.0174246  0.0056702
## 36:pre-km0  0.95     7.75     482.0  0.0002576  0.0703455
## 36:gg-pre   0.95    17.88     492.7 -0.0791661 -0.0078058
\end{verbatim}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{probs_bs_boot_func_apgi} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{d}\hlstd{,} \hlkwc{i}\hlstd{) \{}
        \hlstd{bs.mskcc.postop.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.12mo.apgi[i],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.postop.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.24mo.apgi[i],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.postop.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.36mo.apgi[i],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.12mo.apgi[i],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.24mo.apgi[i],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.36mo.apgi[i],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{bs.gg.vals} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(gg.path.apgi[i],} \hlkwa{function}\hlstd{(}\hlkwc{path}\hlstd{)} \hlkwd{approx}\hlstd{(path[,}\hlnum{1}\hlstd{], path[,}\hlnum{2}\hlstd{],} \hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{)}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}\hlopt{$}\hlstd{y))}
        \hlkwd{rownames}\hlstd{(bs.gg.vals)} \hlkwb{<-} \hlkwa{NULL}
        \hlstd{bs.gg.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{1}\hlstd{],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.gg.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{2}\hlstd{],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.gg.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{3}\hlstd{],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{bs.km0.vals} \hlkwb{=} \hlkwd{approx}\hlstd{(fit.km0}\hlopt{$}\hlstd{time, fit.km0}\hlopt{$}\hlstd{surv,} \hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{)}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}\hlopt{$}\hlstd{y}
        \hlstd{bs.km0.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{1}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.km0.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{2}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.km0.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{3}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{result} \hlkwb{=} \hlkwd{c}\hlstd{(}
                \hlstd{bs.gg.12} \hlopt{-} \hlstd{bs.km0.12,                   bs.mskcc.preop.12} \hlopt{-} \hlstd{bs.km0.12,}
                \hlstd{bs.gg.12} \hlopt{-} \hlstd{bs.mskcc.preop.12,}
                \hlstd{bs.gg.24} \hlopt{-} \hlstd{bs.km0.24,                   bs.mskcc.preop.24} \hlopt{-} \hlstd{bs.km0.24,}
                \hlstd{bs.gg.24} \hlopt{-} \hlstd{bs.mskcc.preop.24,}
                \hlstd{bs.gg.36} \hlopt{-} \hlstd{bs.km0.36,                   bs.mskcc.preop.36} \hlopt{-} \hlstd{bs.km0.36,}
                \hlstd{bs.gg.36} \hlopt{-} \hlstd{bs.mskcc.preop.36)}

        \hlkwd{names}\hlstd{(result)} \hlkwb{<-} \hlkwa{NULL}
        \hlstd{result}
\hlstd{\}}

\hlkwd{set.seed}\hlstd{(}\hlnum{20150208}\hlstd{)}
\hlstd{deltaBrier.boot.apgi} \hlkwb{=} \hlkwd{boot}\hlstd{(data.apgi, probs_bs_boot_func_apgi,} \hlkwc{R} \hlstd{=} \hlnum{500}\hlstd{)}
\hlstd{deltaBrier.boot.apgi.cis} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(deltaBrier.boot.apgi}\hlopt{$}\hlstd{t),} \hlkwa{function}\hlstd{(}\hlkwc{i}\hlstd{)} \hlkwd{boot.ci}\hlstd{(deltaBrier.boot.apgi,} \hlkwc{index} \hlstd{= i,} \hlkwc{type} \hlstd{=} \hlstr{"bca"}\hlstd{)}\hlopt{$}\hlstd{bca))}
\hlkwd{colnames}\hlstd{(deltaBrier.boot.apgi.cis)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"level"}\hlstd{,} \hlstr{"lowindex"}\hlstd{,} \hlstr{"highindex"}\hlstd{,} \hlstr{"lci"}\hlstd{,} \hlstr{"uci"}\hlstd{)}
\hlkwd{rownames}\hlstd{(deltaBrier.boot.apgi.cis)} \hlkwb{=} \hlkwd{c}\hlstd{(}
        \hlstr{"12:gg-km0"}\hlstd{,} \hlstr{"12:pre-km0"}\hlstd{,} \hlstr{"12:gg-pre"}\hlstd{,}
        \hlstr{"24:gg-km0"}\hlstd{,} \hlstr{"24:pre-km0"}\hlstd{,} \hlstr{"24:gg-pre"}\hlstd{,}
        \hlstr{"36:gg-km0"}\hlstd{,} \hlstr{"36:pre-km0"}\hlstd{,} \hlstr{"36:gg-pre"}\hlstd{)}
\hlstd{deltaBrier.boot.apgi}
\end{alltt}
\begin{verbatim}
## 
## ORDINARY NONPARAMETRIC BOOTSTRAP
## 
## 
## Call:
## boot(data = data.apgi, statistic = probs_bs_boot_func_apgi, R = 500)
## 
## 
## Bootstrap Statistics :
##      original     bias    std. error
## t1* -0.002467 -9.427e-04     0.01533
## t2* -0.021902 -9.299e-04     0.01871
## t3*  0.019435 -1.284e-05     0.02357
## t4* -0.026163  1.455e-04     0.01626
## t5* -0.031015 -2.957e-03     0.03088
## t6*  0.004852  3.102e-03     0.03210
## t7* -0.013158  5.419e-04     0.01076
## t8* -0.002300 -1.978e-03     0.03104
## t9* -0.010858  2.520e-03     0.03157
\end{verbatim}
\begin{alltt}
\hlstd{deltaBrier.boot.apgi.cis}
\end{alltt}
\begin{verbatim}
##            level lowindex highindex      lci      uci
## 12:gg-km0   0.95    19.66     493.6 -0.03018 0.028926
## 12:pre-km0  0.95    19.61     493.7 -0.05458 0.021352
## 12:gg-pre   0.95     9.26     484.6 -0.03157 0.063344
## 24:gg-km0   0.95    11.80     487.7 -0.05845 0.005853
## 24:pre-km0  0.95    24.25     495.0 -0.08215 0.036547
## 24:gg-pre   0.95     9.20     484.1 -0.05843 0.066835
## 36:gg-km0   0.95     7.17     481.3 -0.03799 0.005808
## 36:pre-km0  0.95    13.87     489.6 -0.06168 0.053566
## 36:gg-pre   0.95    14.34     490.2 -0.06126 0.052894
\end{verbatim}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{probs_bs_boot_func_dresden} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{d}\hlstd{,} \hlkwc{i}\hlstd{) \{}
        \hlstd{bs.mskcc.postop.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.12mo.dresden[i],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.postop.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.24mo.dresden[i],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.postop.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_post.36mo.dresden[i],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.12mo.dresden[i],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.24mo.dresden[i],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.mskcc.preop.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), mskcc_pre.36mo.dresden[i],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{bs.gg.vals} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(gg.path.dresden[i],} \hlkwa{function}\hlstd{(}\hlkwc{path}\hlstd{)} \hlkwd{approx}\hlstd{(path[,}\hlnum{1}\hlstd{], path[,}\hlnum{2}\hlstd{],} \hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{)}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}\hlopt{$}\hlstd{y))}
        \hlkwd{rownames}\hlstd{(bs.gg.vals)} \hlkwb{<-} \hlkwa{NULL}
        \hlstd{bs.gg.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{1}\hlstd{],} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.gg.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{2}\hlstd{],} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.gg.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]), bs.gg.vals[,}\hlnum{3}\hlstd{],} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{bs.km0.vals} \hlkwb{=} \hlkwd{approx}\hlstd{(fit.km0}\hlopt{$}\hlstd{time, fit.km0}\hlopt{$}\hlstd{surv,} \hlkwd{c}\hlstd{(}\hlnum{12}\hlstd{,} \hlnum{24}\hlstd{,} \hlnum{36}\hlstd{)}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}\hlopt{$}\hlstd{y}
        \hlstd{bs.km0.12} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{1}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{12}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.km0.24} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{2}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{24}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}
        \hlstd{bs.km0.36} \hlkwb{=} \hlkwd{calcBSsingle}\hlstd{(}\hlkwd{Surv}\hlstd{(d}\hlopt{$}\hlstd{Time[i], d}\hlopt{$}\hlstd{DSD[i]),} \hlkwd{rep}\hlstd{(bs.km0.vals[}\hlnum{3}\hlstd{],} \hlkwd{nrow}\hlstd{(d[i,])),} \hlnum{36}\hlopt{/}\hlnum{12}\hlopt{*}\hlnum{365.25}\hlstd{)}

        \hlstd{result} \hlkwb{=} \hlkwd{c}\hlstd{(}
                \hlstd{bs.gg.12} \hlopt{-} \hlstd{bs.km0.12,                   bs.mskcc.preop.12} \hlopt{-} \hlstd{bs.km0.12,}
                \hlstd{bs.gg.12} \hlopt{-} \hlstd{bs.mskcc.preop.12,}
                \hlstd{bs.gg.24} \hlopt{-} \hlstd{bs.km0.24,                   bs.mskcc.preop.24} \hlopt{-} \hlstd{bs.km0.24,}
                \hlstd{bs.gg.24} \hlopt{-} \hlstd{bs.mskcc.preop.24,}
                \hlstd{bs.gg.36} \hlopt{-} \hlstd{bs.km0.36,                   bs.mskcc.preop.36} \hlopt{-} \hlstd{bs.km0.36,}
                \hlstd{bs.gg.36} \hlopt{-} \hlstd{bs.mskcc.preop.36)}

        \hlkwd{names}\hlstd{(result)} \hlkwb{<-} \hlkwa{NULL}
        \hlstd{result}
\hlstd{\}}

\hlkwd{set.seed}\hlstd{(}\hlnum{20150208}\hlstd{)}
\hlstd{deltaBrier.boot.dresden} \hlkwb{=} \hlkwd{boot}\hlstd{(data.dresden, probs_bs_boot_func_dresden,} \hlkwc{R} \hlstd{=} \hlnum{500}\hlstd{)}
\hlstd{deltaBrier.boot.dresden.cis} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{ncol}\hlstd{(deltaBrier.boot.dresden}\hlopt{$}\hlstd{t),} \hlkwa{function}\hlstd{(}\hlkwc{i}\hlstd{)} \hlkwd{boot.ci}\hlstd{(deltaBrier.boot.dresden,} \hlkwc{index} \hlstd{= i,} \hlkwc{type} \hlstd{=} \hlstr{"bca"}\hlstd{)}\hlopt{$}\hlstd{bca))}
\hlkwd{colnames}\hlstd{(deltaBrier.boot.dresden.cis)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"level"}\hlstd{,} \hlstr{"lowindex"}\hlstd{,} \hlstr{"highindex"}\hlstd{,} \hlstr{"lci"}\hlstd{,} \hlstr{"uci"}\hlstd{)}
\hlkwd{rownames}\hlstd{(deltaBrier.boot.dresden.cis)} \hlkwb{=} \hlkwd{c}\hlstd{(}
        \hlstr{"12:gg-km0"}\hlstd{,} \hlstr{"12:pre-km0"}\hlstd{,} \hlstr{"12:gg-pre"}\hlstd{,}
        \hlstr{"24:gg-km0"}\hlstd{,} \hlstr{"24:pre-km0"}\hlstd{,} \hlstr{"24:gg-pre"}\hlstd{,}
        \hlstr{"36:gg-km0"}\hlstd{,} \hlstr{"36:pre-km0"}\hlstd{,} \hlstr{"36:gg-pre"}\hlstd{)}
\hlstd{deltaBrier.boot.dresden}
\end{alltt}
\begin{verbatim}
## 
## ORDINARY NONPARAMETRIC BOOTSTRAP
## 
## 
## Call:
## boot(data = data.dresden, statistic = probs_bs_boot_func_dresden, 
##     R = 500)
## 
## 
## Bootstrap Statistics :
##       original     bias    std. error
## t1*  0.0034421  9.367e-04    0.011108
## t2*  0.0004868  6.525e-05    0.016340
## t3*  0.0029552  8.714e-04    0.020299
## t4*  0.0126527  4.762e-04    0.010369
## t5*  0.0285863 -1.651e-04    0.026848
## t6* -0.0159336  6.414e-04    0.031273
## t7*  0.0103725  3.284e-04    0.006289
## t8*  0.0172025 -6.142e-04    0.025904
## t9* -0.0068300  9.426e-04    0.028929
\end{verbatim}
\begin{alltt}
\hlstd{deltaBrier.boot.dresden.cis}
\end{alltt}
\begin{verbatim}
##            level lowindex highindex       lci     uci
## 12:gg-km0   0.95     8.37     482.4 -0.020654 0.02330
## 12:pre-km0  0.95    13.25     489.2 -0.028488 0.03549
## 12:gg-pre   0.95     6.20     478.0 -0.042748 0.03807
## 24:gg-km0   0.95    13.87     489.8 -0.007239 0.03688
## 24:pre-km0  0.95    10.10     485.6 -0.029593 0.07763
## 24:gg-pre   0.95    14.01     489.9 -0.075056 0.05172
## 36:gg-km0   0.95     9.38     484.3 -0.001999 0.02198
## 36:pre-km0  0.95    11.04     486.9 -0.037358 0.06442
## 36:gg-pre   0.95    10.83     486.4 -0.063253 0.05389
\end{verbatim}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp.time} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{":.*"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.glasgow.cis))}
\hlstd{temp.methodpos} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{".*:"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{gsub}\hlstd{(}\hlstr{"-.*"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.glasgow.cis)))}
\hlstd{temp.methodneg} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{".*-"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.glasgow.cis))}
\hlstd{temp.methods} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(}\hlkwd{c}\hlstd{(temp.methodpos, temp.methodneg)))}
\hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.time), temp.time,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{) \{}
        \hlstd{res} \hlkwb{=} \hlkwd{matrix}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwc{nrow} \hlstd{=} \hlkwd{length}\hlstd{(temp.methods),} \hlkwc{ncol} \hlstd{=} \hlkwd{length}\hlstd{(temp.methods))}
        \hlkwd{rownames}\hlstd{(res)} \hlkwb{=} \hlstd{temp.methods}
        \hlkwd{colnames}\hlstd{(res)} \hlkwb{=} \hlstd{temp.methods}
        \hlcom{# Make res signed.  0 => NS.  +1 => row is better than col (BS_row - BS_col < 0).  -1 => row is worse than col (BS_row - BS_col > 0).}
        \hlstd{res[}\hlkwd{cbind}\hlstd{(temp.methodpos[is], temp.methodneg[is])]} \hlkwb{=} \hlstd{(}\hlkwd{sign}\hlstd{(deltaBrier.boot.glasgow.cis[is,} \hlstr{"uci"}\hlstd{])} \hlopt{==} \hlkwd{sign}\hlstd{(deltaBrier.boot.glasgow.cis[is,} \hlstr{"lci"}\hlstd{]))} \hlopt{*} \hlkwd{sign}\hlstd{(}\hlopt{-}\hlstd{deltaBrier.boot.glasgow.cis[is,} \hlstr{"uci"}\hlstd{])}
        \hlstd{res[}\hlkwd{cbind}\hlstd{(temp.methodneg[is], temp.methodpos[is])]} \hlkwb{=} \hlstd{(}\hlkwd{sign}\hlstd{(deltaBrier.boot.glasgow.cis[is,} \hlstr{"uci"}\hlstd{])} \hlopt{==} \hlkwd{sign}\hlstd{(deltaBrier.boot.glasgow.cis[is,} \hlstr{"lci"}\hlstd{]))} \hlopt{*} \hlkwd{sign}\hlstd{(deltaBrier.boot.glasgow.cis[is,} \hlstr{"uci"}\hlstd{])}
        \hlstd{res}
\hlstd{\})}
\end{alltt}
\begin{verbatim}
## $`12`
##     gg km0 pre
## gg   0   0   1
## km0  0   0   0
## pre -1   0   0
## 
## $`24`
##     gg km0 pre
## gg   0   1   0
## km0 -1   0   0
## pre  0   0   0
## 
## $`36`
##     gg km0 pre
## gg   0   0   1
## km0  0   0   1
## pre -1  -1   0
\end{verbatim}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp.time} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{":.*"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.apgi.cis))}
\hlstd{temp.methodpos} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{".*:"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{gsub}\hlstd{(}\hlstr{"-.*"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.apgi.cis)))}
\hlstd{temp.methodneg} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{".*-"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.apgi.cis))}
\hlstd{temp.methods} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(}\hlkwd{c}\hlstd{(temp.methodpos, temp.methodneg)))}
\hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.time), temp.time,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{) \{}
        \hlstd{res} \hlkwb{=} \hlkwd{matrix}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwc{nrow} \hlstd{=} \hlkwd{length}\hlstd{(temp.methods),} \hlkwc{ncol} \hlstd{=} \hlkwd{length}\hlstd{(temp.methods))}
        \hlkwd{rownames}\hlstd{(res)} \hlkwb{=} \hlstd{temp.methods}
        \hlkwd{colnames}\hlstd{(res)} \hlkwb{=} \hlstd{temp.methods}
        \hlcom{# Make res signed.  0 => NS.  +1 => row is better than col (BS_row - BS_col < 0).  -1 => row is worse than col (BS_row - BS_col > 0).}
        \hlstd{res[}\hlkwd{cbind}\hlstd{(temp.methodpos[is], temp.methodneg[is])]} \hlkwb{=} \hlstd{(}\hlkwd{sign}\hlstd{(deltaBrier.boot.apgi.cis[is,} \hlstr{"uci"}\hlstd{])} \hlopt{==} \hlkwd{sign}\hlstd{(deltaBrier.boot.apgi.cis[is,} \hlstr{"lci"}\hlstd{]))} \hlopt{*} \hlkwd{sign}\hlstd{(}\hlopt{-}\hlstd{deltaBrier.boot.apgi.cis[is,} \hlstr{"uci"}\hlstd{])}
        \hlstd{res[}\hlkwd{cbind}\hlstd{(temp.methodneg[is], temp.methodpos[is])]} \hlkwb{=} \hlstd{(}\hlkwd{sign}\hlstd{(deltaBrier.boot.apgi.cis[is,} \hlstr{"uci"}\hlstd{])} \hlopt{==} \hlkwd{sign}\hlstd{(deltaBrier.boot.apgi.cis[is,} \hlstr{"lci"}\hlstd{]))} \hlopt{*} \hlkwd{sign}\hlstd{(deltaBrier.boot.apgi.cis[is,} \hlstr{"uci"}\hlstd{])}
        \hlstd{res}
\hlstd{\})}
\end{alltt}
\begin{verbatim}
## $`12`
##     gg km0 pre
## gg   0   0   0
## km0  0   0   0
## pre  0   0   0
## 
## $`24`
##     gg km0 pre
## gg   0   0   0
## km0  0   0   0
## pre  0   0   0
## 
## $`36`
##     gg km0 pre
## gg   0   0   0
## km0  0   0   0
## pre  0   0   0
\end{verbatim}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{temp.time} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{":.*"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.dresden.cis))}
\hlstd{temp.methodpos} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{".*:"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{gsub}\hlstd{(}\hlstr{"-.*"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.dresden.cis)))}
\hlstd{temp.methodneg} \hlkwb{=} \hlkwd{gsub}\hlstd{(}\hlstr{".*-"}\hlstd{,} \hlstr{""}\hlstd{,} \hlkwd{rownames}\hlstd{(deltaBrier.boot.dresden.cis))}
\hlstd{temp.methods} \hlkwb{=} \hlkwd{sort}\hlstd{(}\hlkwd{unique}\hlstd{(}\hlkwd{c}\hlstd{(temp.methodpos, temp.methodneg)))}
\hlkwd{tapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(temp.time), temp.time,} \hlkwa{function}\hlstd{(}\hlkwc{is}\hlstd{) \{}
        \hlstd{res} \hlkwb{=} \hlkwd{matrix}\hlstd{(}\hlnum{0}\hlstd{,} \hlkwc{nrow} \hlstd{=} \hlkwd{length}\hlstd{(temp.methods),} \hlkwc{ncol} \hlstd{=} \hlkwd{length}\hlstd{(temp.methods))}
        \hlkwd{rownames}\hlstd{(res)} \hlkwb{=} \hlstd{temp.methods}
        \hlkwd{colnames}\hlstd{(res)} \hlkwb{=} \hlstd{temp.methods}
        \hlcom{# Make res signed.  0 => NS.  +1 => row is better than col (BS_row - BS_col < 0).  -1 => row is worse than col (BS_row - BS_col > 0).}
        \hlstd{res[}\hlkwd{cbind}\hlstd{(temp.methodpos[is], temp.methodneg[is])]} \hlkwb{=} \hlstd{(}\hlkwd{sign}\hlstd{(deltaBrier.boot.dresden.cis[is,} \hlstr{"uci"}\hlstd{])} \hlopt{==} \hlkwd{sign}\hlstd{(deltaBrier.boot.dresden.cis[is,} \hlstr{"lci"}\hlstd{]))} \hlopt{*} \hlkwd{sign}\hlstd{(}\hlopt{-}\hlstd{deltaBrier.boot.dresden.cis[is,} \hlstr{"uci"}\hlstd{])}
        \hlstd{res[}\hlkwd{cbind}\hlstd{(temp.methodneg[is], temp.methodpos[is])]} \hlkwb{=} \hlstd{(}\hlkwd{sign}\hlstd{(deltaBrier.boot.dresden.cis[is,} \hlstr{"uci"}\hlstd{])} \hlopt{==} \hlkwd{sign}\hlstd{(deltaBrier.boot.dresden.cis[is,} \hlstr{"lci"}\hlstd{]))} \hlopt{*} \hlkwd{sign}\hlstd{(deltaBrier.boot.dresden.cis[is,} \hlstr{"uci"}\hlstd{])}
        \hlstd{res}
\hlstd{\})}
\end{alltt}
\begin{verbatim}
## $`12`
##     gg km0 pre
## gg   0   0   0
## km0  0   0   0
## pre  0   0   0
## 
## $`24`
##     gg km0 pre
## gg   0   0   0
## km0  0   0   0
## pre  0   0   0
## 
## $`36`
##     gg km0 pre
## gg   0   0   0
## km0  0   0   0
## pre  0   0   0
\end{verbatim}
\end{kframe}
\end{knitrout}

Cumulative-dynamic:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_pre.cdroc.glasgow} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.glasgow}\hlopt{$}\hlstd{DSD, mskcc_pre.linpred.glasgow,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlstd{mskcc_post.cdroc.glasgow} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.glasgow}\hlopt{$}\hlstd{DSD, mskcc_post.linpred.glasgow,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlstd{gg.cdroc.glasgow} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.glasgow}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.glasgow}\hlopt{$}\hlstd{DSD, gg.linpred.glasgow,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlkwd{plotAUCcurve}\hlstd{(mskcc_pre.cdroc.glasgow,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{])}
\hlkwd{plotAUCcurve}\hlstd{(mskcc_post.cdroc.glasgow,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.post"}\hlstd{])}
\hlkwd{plotAUCcurve}\hlstd{(gg.cdroc.glasgow,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{])}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Glasgow Preop"}\hlstd{,} \hlstr{"Glasgow Postop"}\hlstd{,} \hlstr{"GG"}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(pal[}\hlstr{"mskcc.pre"}\hlstd{], pal[}\hlstr{"mskcc.post"}\hlstd{], pal[}\hlstr{"gg"}\hlstd{]),} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{2}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-timeROC-glasgow-1} 

}



\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_pre.cdroc.apgi} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.apgi}\hlopt{$}\hlstd{DSD, mskcc_pre.linpred.apgi,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlstd{mskcc_post.cdroc.apgi} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.apgi}\hlopt{$}\hlstd{DSD, mskcc_post.linpred.apgi,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlstd{gg.cdroc.apgi} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.apgi}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.apgi}\hlopt{$}\hlstd{DSD, gg.linpred.apgi,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlkwd{plotAUCcurve}\hlstd{(mskcc_pre.cdroc.apgi,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{])}
\hlkwd{plotAUCcurve}\hlstd{(mskcc_post.cdroc.apgi,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.post"}\hlstd{])}
\hlkwd{plotAUCcurve}\hlstd{(gg.cdroc.apgi,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{])}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"APGI Preop"}\hlstd{,} \hlstr{"APGI Postop"}\hlstd{,} \hlstr{"GG"}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(pal[}\hlstr{"mskcc.pre"}\hlstd{], pal[}\hlstr{"mskcc.post"}\hlstd{], pal[}\hlstr{"gg"}\hlstd{]),} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{2}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{31}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-timeROC-apgi-1} 

}



\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mskcc_pre.cdroc.dresden} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.dresden}\hlopt{$}\hlstd{DSD, mskcc_pre.linpred.dresden,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlstd{mskcc_post.cdroc.dresden} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.dresden}\hlopt{$}\hlstd{DSD, mskcc_post.linpred.dresden,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlstd{gg.cdroc.dresden} \hlkwb{=} \hlkwd{timeROC}\hlstd{(data.dresden}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{, data.dresden}\hlopt{$}\hlstd{DSD, gg.linpred.dresden,} \hlkwc{cause} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{times} \hlstd{=} \hlkwd{seq}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{36}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{iid} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlkwd{plotAUCcurve}\hlstd{(mskcc_pre.cdroc.dresden,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{])}
\hlkwd{plotAUCcurve}\hlstd{(mskcc_post.cdroc.dresden,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.post"}\hlstd{])}
\hlkwd{plotAUCcurve}\hlstd{(gg.cdroc.dresden,} \hlkwc{conf.int} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{])}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Dresden Preop"}\hlstd{,} \hlstr{"Dresden Postop"}\hlstd{,} \hlstr{"GG"}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(pal[}\hlstr{"mskcc.pre"}\hlstd{], pal[}\hlstr{"mskcc.post"}\hlstd{], pal[}\hlstr{"gg"}\hlstd{]),} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{2}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{31}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-timeROC-dresden-1} 

}



\end{knitrout}

Incident-dynamic:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{risksetROC.boot} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{time}\hlstd{,} \hlkwc{event}\hlstd{,} \hlkwc{marker}\hlstd{,} \hlkwc{tmin} \hlstd{=} \hlnum{0}\hlstd{,} \hlkwc{tmax}\hlstd{,} \hlkwc{B} \hlstd{=} \hlnum{2000}\hlstd{,} \hlkwc{...}\hlstd{)}
\hlstd{\{}
        \hlstd{data} \hlkwb{=} \hlkwd{data.frame}\hlstd{(}\hlkwc{time} \hlstd{= time,} \hlkwc{event} \hlstd{= event,} \hlkwc{marker} \hlstd{= marker)}
        \hlstd{eval_times} \hlkwb{=} \hlkwd{seq}\hlstd{(tmin, tmax,} \hlkwc{length.out} \hlstd{=} \hlnum{200}\hlstd{)}

        \hlstd{boot_obj} \hlkwb{=} \hlkwd{boot}\hlstd{(data,} \hlkwa{function}\hlstd{(}\hlkwc{data}\hlstd{,} \hlkwc{indices}\hlstd{) \{}
                \hlstd{data_draw} \hlkwb{=} \hlstd{data[indices,]}
                \hlstd{rsAUC} \hlkwb{=} \hlkwd{risksetAUC}\hlstd{(}\hlkwc{Stime} \hlstd{= data_draw}\hlopt{$}\hlstd{time,} \hlkwc{status} \hlstd{= data_draw}\hlopt{$}\hlstd{event,} \hlkwc{marker} \hlstd{= data_draw}\hlopt{$}\hlstd{marker,} \hlkwc{tmax} \hlstd{= tmax,} \hlkwc{plot} \hlstd{=} \hlnum{FALSE}\hlstd{, ...)}
                \hlstd{AUC_at_eval_times} \hlkwb{=} \hlkwd{approx}\hlstd{(rsAUC}\hlopt{$}\hlstd{utimes, rsAUC}\hlopt{$}\hlstd{AUC, eval_times)}\hlopt{$}\hlstd{y}
                \hlstd{AUC_at_eval_times}
        \hlstd{\},} \hlkwc{R} \hlstd{= B)}

        \hlstd{res} \hlkwb{=} \hlkwd{list}\hlstd{(}\hlkwc{boot} \hlstd{= boot_obj,} \hlkwc{eval_times} \hlstd{= eval_times)}
        \hlkwd{class}\hlstd{(res)} \hlkwb{=} \hlstr{"rrROC_boot"}
        \hlkwd{return}\hlstd{(res)}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{plot.rrROC_boot} \hlkwb{=} \hlkwa{function}\hlstd{(}\hlkwc{obj}\hlstd{,} \hlkwc{add} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{ci} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{ci_conf} \hlstd{=} \hlnum{0.95}\hlstd{,} \hlkwc{ci_type} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"perc"}\hlstd{,} \hlstr{"norm"}\hlstd{,} \hlstr{"basic"}\hlstd{,} \hlstr{"stud"}\hlstd{,} \hlstr{"bca"}\hlstd{),} \hlkwc{...}\hlstd{)}
\hlstd{\{}
        \hlstd{ci_type} \hlkwb{=} \hlkwd{match.arg}\hlstd{(ci_type)}
        \hlstd{boot_ci} \hlkwb{=} \hlkwd{t}\hlstd{(}\hlkwd{sapply}\hlstd{(}\hlnum{1}\hlopt{:}\hlkwd{length}\hlstd{(obj}\hlopt{$}\hlstd{boot}\hlopt{$}\hlstd{t0),} \hlkwa{function}\hlstd{(}\hlkwc{i}\hlstd{) \{}
                \hlstd{ci} \hlkwb{=} \hlkwd{try}\hlstd{(}\hlkwd{boot.ci}\hlstd{(obj}\hlopt{$}\hlstd{boot,} \hlkwc{index} \hlstd{=} \hlkwd{c}\hlstd{(i, i),} \hlkwc{type} \hlstd{= ci_type,} \hlkwc{conf} \hlstd{= ci_conf))}
                \hlkwa{if} \hlstd{(}\hlkwd{class}\hlstd{(ci)} \hlopt{==} \hlstr{"try-error"}\hlstd{) \{}
                        \hlkwa{if} \hlstd{(ci_type} \hlopt{==} \hlstr{"norm"}\hlstd{)  \{} \hlkwd{return}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{)) \}} \hlkwa{else} \hlstd{\{} \hlkwd{return}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{,} \hlnum{NA}\hlstd{)) \}}
                \hlstd{\}}
                \hlkwd{return}\hlstd{(ci[[}\hlkwd{c}\hlstd{(}\hlstr{"bca"} \hlstd{=} \hlstr{"bca"}\hlstd{,} \hlstr{"norm"} \hlstd{=} \hlstr{"normal"}\hlstd{,} \hlstr{"basic"} \hlstd{=} \hlstr{"basic"}\hlstd{,} \hlstr{"stud"} \hlstd{=} \hlstr{"student"}\hlstd{,} \hlstr{"perc"} \hlstd{=} \hlstr{"percent"}\hlstd{)[ci_type]]])}
        \hlstd{\}))}
        \hlkwa{if} \hlstd{(ci_type} \hlopt{==} \hlstr{"norm"}\hlstd{)  \{} \hlkwd{colnames}\hlstd{(boot_ci)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"level"}\hlstd{,} \hlstr{"lci"}\hlstd{,} \hlstr{"uci"}\hlstd{) \}} \hlkwa{else} \hlstd{\{} \hlkwd{colnames}\hlstd{(boot_ci)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"level"}\hlstd{,} \hlstr{"ind1"}\hlstd{,} \hlstr{"ind2"}\hlstd{,} \hlstr{"lci"}\hlstd{,} \hlstr{"uci"}\hlstd{) \}}
        \hlstd{summ} \hlkwb{=} \hlkwd{as.data.frame}\hlstd{(}\hlkwd{cbind}\hlstd{(}\hlkwc{time} \hlstd{= obj}\hlopt{$}\hlstd{eval_times,} \hlkwc{mean} \hlstd{= obj}\hlopt{$}\hlstd{boot}\hlopt{$}\hlstd{t0, boot_ci))}

        \hlkwa{if} \hlstd{(}\hlopt{!}\hlstd{add) \{}
                \hlkwd{plot}\hlstd{(mean} \hlopt{~} \hlstd{time, summ,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{0.4}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{type} \hlstd{=} \hlstr{"l"}\hlstd{, ...)}
        \hlstd{\}} \hlkwa{else} \hlstd{\{}
                \hlkwd{lines}\hlstd{(mean} \hlopt{~} \hlstd{time, summ, ...)}
        \hlstd{\}}
        \hlkwa{if} \hlstd{(ci) \{}
                \hlkwd{lines}\hlstd{(lci} \hlopt{~} \hlstd{time, summ,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{, ...)}
                \hlkwd{lines}\hlstd{(uci} \hlopt{~} \hlstd{time, summ,} \hlkwc{lty} \hlstd{=} \hlstr{"dotted"}\hlstd{, ...)}
        \hlstd{\}}
        \hlkwd{abline}\hlstd{(}\hlkwc{h} \hlstd{=} \hlnum{0.5}\hlstd{)}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{20150216}\hlstd{)}
\hlstd{rrROC_boot.mskcc_pre.glasgow} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.glasgow}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= mskcc_pre.linpred.glasgow,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\hlstd{rrROC_boot.mskcc_post.glasgow} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.glasgow}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= mskcc_post.linpred.glasgow,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\hlstd{rrROC_boot.gg.glasgow} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.glasgow}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.glasgow}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= gg.linpred.glasgow,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(rrROC_boot.mskcc_pre.glasgow,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{],} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"AUC"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlkwd{plot}\hlstd{(rrROC_boot.gg.glasgow,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{],} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{ci} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"MSKCC"}\hlstd{,} \hlstr{"PCOP"}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(pal[}\hlstr{"mskcc.pre"}\hlstd{], pal[}\hlstr{"gg"}\hlstd{]),} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{31}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-risksetROC-plot-glasgow-1} 

}



\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{20150216}\hlstd{)}
\hlstd{rrROC_boot.mskcc_pre.apgi} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.apgi}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= mskcc_pre.linpred.apgi,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\hlstd{rrROC_boot.mskcc_post.apgi} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.apgi}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= mskcc_post.linpred.apgi,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\hlstd{rrROC_boot.gg.apgi} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.apgi}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.apgi}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= gg.linpred.apgi,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(rrROC_boot.mskcc_pre.apgi,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{],} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"AUC"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlkwd{plot}\hlstd{(rrROC_boot.gg.apgi,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{],} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{ci} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"MSKCC"}\hlstd{,} \hlstr{"PCOP"}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(pal[}\hlstr{"mskcc.pre"}\hlstd{], pal[}\hlstr{"gg"}\hlstd{]),} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{31}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-risksetROC-plot-apgi-1} 

}



\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{20150216}\hlstd{)}
\hlstd{rrROC_boot.mskcc_pre.dresden} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.dresden}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= mskcc_pre.linpred.dresden,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\hlstd{rrROC_boot.mskcc_post.dresden} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.dresden}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= mskcc_post.linpred.dresden,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\hlstd{rrROC_boot.gg.dresden} \hlkwb{=} \hlkwd{risksetROC.boot}\hlstd{(}\hlkwc{time} \hlstd{= data.dresden}\hlopt{$}\hlstd{Time}\hlopt{/}\hlnum{365.25}\hlopt{*}\hlnum{12}\hlstd{,} \hlkwc{event} \hlstd{= data.dresden}\hlopt{$}\hlstd{DSD,} \hlkwc{marker} \hlstd{= gg.linpred.dresden,} \hlkwc{tmax} \hlstd{=} \hlnum{60}\hlstd{,} \hlkwc{method} \hlstd{=} \hlstr{"Schoenfeld"}\hlstd{,} \hlkwc{span} \hlstd{=} \hlnum{0.4}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(rrROC_boot.mskcc_pre.dresden,} \hlkwc{col} \hlstd{= pal[}\hlstr{"mskcc.pre"}\hlstd{],} \hlkwc{xlab} \hlstd{=} \hlstr{"Time from diagnosis (months)"}\hlstd{,} \hlkwc{ylab} \hlstd{=} \hlstr{"AUC"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{cex.lab} \hlstd{=} \hlnum{1.5}\hlstd{,} \hlkwc{cex.axis} \hlstd{=} \hlnum{1.5}\hlstd{)}
\hlkwd{plot}\hlstd{(rrROC_boot.gg.dresden,} \hlkwc{col} \hlstd{= pal[}\hlstr{"gg"}\hlstd{],} \hlkwc{add} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{ci} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{)}
\hlkwd{legend}\hlstd{(}\hlstr{"topright"}\hlstd{,} \hlkwc{legend} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"MSKCC"}\hlstd{,} \hlstr{"PCOP"}\hlstd{),} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(pal[}\hlstr{"mskcc.pre"}\hlstd{], pal[}\hlstr{"gg"}\hlstd{]),} \hlkwc{lty} \hlstd{=} \hlstr{"solid"}\hlstd{,} \hlkwc{lwd} \hlstd{=} \hlnum{3}\hlstd{,} \hlkwc{inset} \hlstd{=} \hlnum{0.05}\hlstd{,} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}
\hlkwd{abline}\hlstd{(}\hlkwc{v} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{7}\hlstd{,} \hlnum{31}\hlstd{),} \hlkwc{lty} \hlstd{=} \hlstr{"dashed"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=\maxwidth]{figure/07-risksetROC-plot-dresden-1} 

}



\end{knitrout}

\end{document}
