%% PREAMBLE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt,a4paper,final,twoside]{memoir}

\newcommand{\thesisTitleMain}{Molecular signatures of survival in pancreatic ductal adenocarcinoma}
\newcommand{\thesisTitleSub}{why do some patients live longer than others, and how can we identify them?}
\newcommand{\thesisTitleSUB}{Why do some patients live longer than others, and how can we identify them?}
\newcommand{\thesisTitle}{\thesisTitleMain{}:~\\\thesisTitleSub{}}

% DRAFT STUFF -- REMOVE FOR FINAL
% \overfullrule=2cm

% UNSW-mandated ugly
\settrimmedsize{297mm}{210mm}{*}
\settrims{0pt}{0pt}
\settypeblocksize{200mm}{115mm}{*}
\setbinding{10mm}
\setlrmargins{40mm}{*}{*}
\setulmargins{60mm}{*}{*}
\setheadfoot{2\onelineskip}{3\onelineskip}
\setheaderspaces{*}{2\onelineskip}{*}
\checkandfixthelayout

% SPECIAL HYPHENATION RULES
\hyphenation{mRNA}
\hyphenation{mRNAs}

% CHOPPING N CUTTING
\usepackage{subfiles}

% VERSIONING
\usepackage{mVersion}

% FIXME
\usepackage[footnote,nomargin]{fixme}
\FXRegisterAuthor{mp}{amp}{MP}
\FXRegisterAuthor{mjc}{amjc}{MJC}

\usepackage[table,xcdraw]{xcolor}

% ALGORITHMS
\usepackage{listings}
\usepackage{algorithm2e}

% MATHS
\usepackage{amsmath}
\let\equation\gather
\let\endequation\endgather
\usepackage{amssymb}
\usepackage{bm}

% TRADEMARK
\usepackage{textcomp}

% GRAPHICS
\usepackage{pdfpages}
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{calc}

% CAPTIONS
\usepackage[singlelinecheck=off]{caption}		% To get left caption alignment on longtables

% CROSS-REFERENCING
\usepackage[colorlinks=true,hidelinks,plainpages=false,pdfpagelabels]{hyperref}

% GLOSSARY
\usepackage[toc,noredefwarn]{glossaries}
\let\originalgls\gls
\renewcommand{\gls}[1]{\ifglsentryexists{#1}{\originalgls{#1}}{\colorbox{red}{\underline{#1}}}}
\let\originalglspl\glspl
\renewcommand{\glspl}[1]{\ifglsentryexists{#1}{\originalglspl{#1}}{\colorbox{red}{\underline{#1}}}}
\let\originalGls\Gls
\renewcommand{\Gls}[1]{\ifglsentryexists{#1}{\originalGls{#1}}{\colorbox{red}{\underline{#1}}}}
\let\originalGlspl\Glspl
\renewcommand{\Glspl}[1]{\ifglsentryexists{#1}{\originalGlspl{#1}}{\colorbox{red}{\underline{#1}}}}

% SUBFIGURES
\newsubfloat{figure}		% AFTER hyperref!


\input{macros}

\lstset{basicstyle=\footnotesize\ttfamily,breaklines=true}
\lstset{framextopmargin=50pt,frame=bottomline}
%\cleartoevenpage[\vspace*{\fill}This page intentionally left unblank\vspace*{\fill}]
%\cleartooddpage[\vspace*{\fill}This page intentionally left unblank\vspace*{\fill}]


\input{glossary}
\makeglossaries

\begin{document}
\pagestyle{empty}
\hypersetup{pageanchor=false}	% Disable page number anchors in hyperref for early
								% pages, to prevent duplicate page warnings.
\raggedbottom

%\listoffixmes

\begin{tikzpicture}[remember picture,overlay,shift={(current page.center)}]
    \node at (0.8cm,0) (OffsetNode) {};
\end{tikzpicture}
\begin{tikzpicture}[remember picture,overlay,shift={(OffsetNode.center)}]
    \node at (0,0) {\includegraphics[page=1,scale=0.8]{resources/thesisdissertation}};
    \begin{scope}[shift={(current page.south west)},every node/.style={anchor=base west}]
%        \draw [help lines] (0,0) grid (current page.north east);
%        \draw [help lines,thick] (0,0) grid [step=5cm] (current page.north east);
        \node[font=\scriptsize] at (7cm,24.5cm)	{Pinese};
        \node[font=\scriptsize] at (7cm,24cm) 	{Mark};
        \node[font=\scriptsize] at (11cm,23.48cm) {PhD};
        \node[font=\scriptsize] at (7cm,22.95cm) 	{St. Vincent's Clinical School};
        \node[text width=13cm,align=left,text ragged,font=\scriptsize] at (5cm,22.4cm) 	{\thesisTitle{}};
        \node[font=\scriptsize] at (13cm,22.95cm)	{Medicine};
        \node[text width=13.5cm,align=left,font=\tiny] at (4.5cm,20.5cm)	{\setlength{\parskip}{2.5mm} \noindent \input{abstract}};
    \end{scope}
\end{tikzpicture}

\increaseBuild
\cleardoublepage

\begin{titlingpage}
    \begin{center}
        \vspace*{1cm}
        
        \Large
        \textbf{\thesisTitleMain{}}
        
        \vspace{1cm}
        \normalsize
        \textbf{\thesisTitleSUB{}}
        
        \vspace{2.25cm}
        
        \normalsize
        \textbf{Mark Pinese}
        
        \vfill
        
        A thesis in fulfilment of the requirements for the degree of\\
        Doctor of Philosophy
        
        \vspace{3cm}
        
        \includegraphics[width=0.25\textwidth]{resources/PortraitColourPos}

        \vspace{1.5cm}

        St. Vincent's Clinical School\\
        Faculty of Medicine\\

		\vspace{1.2cm}
        March 2015
    \end{center}
\end{titlingpage}


\cleardoublepage
\includepdf[pages={1},lastpage=1]{resources/originalitystatement_1.pdf}

\frontmatter

\cleardoublepage
\vspace*{\stretch{3}}
\begin{adjustwidth}{2em}{2em}
%\centering
\noindent
To Emma and Eva -- ~\\
\hspace{1cm}it's done now!
\end{adjustwidth}
\vspace*{\stretch{11}}

\chapter*{Acknowledgements}
\input{acknowledgements}


\thispagestyle{empty}
\clearpage

\begin{abstract}
\input{abstract}
\end{abstract}
\thispagestyle{empty}
\pagenumbering{gobble}
\clearpage

\OnehalfSpacing
%\DoubleSpacing

\hypersetup{pageanchor=true}		% Re-enable page numbering
\pagenumbering{roman}
\chapterstyle{brotherton}

\setcounter{tocdepth}{2}
\tableofcontents
\clearpage

\openany
\listoffigures
\clearpage

\listoftables
\clearpage

\addcontentsline{toc}{chapter}{List of Algorithms}
\listofalgorithms

\include{versions}

\include{conventions}

\mainmatter
\openright
\pagestyle{headings}

\subfile{introduction}
\subfile{signatures}
\subfile{nomogram}
\subfile{messina}
\subfile{conclusion}

\input{appendices}

\backmatter

\printglossary

\renewcommand{\bibname}{References}
\bibliographystyle{abbrv}
\bibliography{dissertation}

\end{document}
